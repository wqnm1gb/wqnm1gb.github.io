<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Day09 后端Web实战（员工管理） | 三狗子的博客</title>
<meta name=keywords content="java Web"><meta name=description content='新增员工


Controller层
    @PostMapping
    public Result add(@RequestBody Emp emp){
        // RequestBody用于接收Json格式的数据
        log.info("新增的员工数据是{}",emp);
        empService.add(emp);
        return Result.success();
    }
Controller层只负责接收前端传来的Json格式的信息，接收之后把信息发给Service层进行进一步的操作，这层中不需要分隔出基本员工信息和员工工作经历'><meta name=author content="冷漠三狗子丶"><link rel=canonical href=https://wqnm1gb.github.io/posts/day09%E5%90%8E%E7%AB%AFweb%E5%AE%9E%E6%88%98%E5%91%98%E5%B7%A5%E7%AE%A1%E7%90%86/><link crossorigin=anonymous href=/assets/css/stylesheet.3d688279d829dc24da48acd11f9e33ebea2f39c035e899e1bf4297d8b7aa89b9.css integrity="sha256-PWiCedgp3CTaSKzRH54z6+ovOcA16Jnhv0KX2Leqibk=" rel="preload stylesheet" as=style><link rel=icon href=https://wqnm1gb.github.io/images/favicon.png><link rel=icon type=image/png sizes=16x16 href=https://wqnm1gb.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://wqnm1gb.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://wqnm1gb.github.io/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://wqnm1gb.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh href=https://wqnm1gb.github.io/posts/day09%E5%90%8E%E7%AB%AFweb%E5%AE%9E%E6%88%98%E5%91%98%E5%B7%A5%E7%AE%A1%E7%90%86/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&display=swap" rel=stylesheet><script type=text/javascript async src="https://cdn.bootcss.com/mathjax/2.7.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML">MathJax.Hub.Config({tex2jax:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["[[","]]"]],processEscapes:!0,processEnvironments:!0,skipTags:["script","noscript","style","textarea","pre"],TeX:{equationNumbers:{autoNumber:"AMS"},extensions:["AMSmath.js","AMSsymbols.js"]}}}),MathJax.Hub.Queue(function(){var e,t=MathJax.Hub.getAllJax();for(e=0;e<t.length;e+=1)t[e].SourceElement().parentNode.className+=" has-jax"})</script><style>code.has-jax{font:inherit;font-size:100%;background:inherit;border:inherit;color:#515151}</style><meta property="og:title" content="Day09 后端Web实战（员工管理）"><meta property="og:description" content='新增员工


Controller层
    @PostMapping
    public Result add(@RequestBody Emp emp){
        // RequestBody用于接收Json格式的数据
        log.info("新增的员工数据是{}",emp);
        empService.add(emp);
        return Result.success();
    }
Controller层只负责接收前端传来的Json格式的信息，接收之后把信息发给Service层进行进一步的操作，这层中不需要分隔出基本员工信息和员工工作经历'><meta property="og:type" content="article"><meta property="og:url" content="https://wqnm1gb.github.io/posts/day09%E5%90%8E%E7%AB%AFweb%E5%AE%9E%E6%88%98%E5%91%98%E5%B7%A5%E7%AE%A1%E7%90%86/"><meta property="og:image" content="https://wqnm1gb.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-03-06T10:07:18+08:00"><meta property="article:modified_time" content="2025-03-06T10:07:18+08:00"><meta property="og:site_name" content="三狗子的博客"><meta property="fb:admins" content="your-facebook-admin-id"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://wqnm1gb.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Day09 后端Web实战（员工管理）","item":"https://wqnm1gb.github.io/posts/day09%E5%90%8E%E7%AB%AFweb%E5%AE%9E%E6%88%98%E5%91%98%E5%B7%A5%E7%AE%A1%E7%90%86/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Day09 后端Web实战（员工管理）","name":"Day09 后端Web实战（员工管理）","description":"新增员工 Controller层 @PostMapping public Result add(@RequestBody Emp emp){ // RequestBody用于接收Json格式的数据 log.info(\u0026#34;新增的员工数据是{}\u0026#34;,emp); empService.add(emp); return Result.success(); } Controller层只负责接收前端传来的Json格式的信息，接收之后把信息发给Service层进行进一步的操作，这层中不需要分隔出基本员工信息和员工工作经历\n","keywords":["java Web"],"articleBody":"新增员工 Controller层 @PostMapping public Result add(@RequestBody Emp emp){ // RequestBody用于接收Json格式的数据 log.info(\"新增的员工数据是{}\",emp); empService.add(emp); return Result.success(); } Controller层只负责接收前端传来的Json格式的信息，接收之后把信息发给Service层进行进一步的操作，这层中不需要分隔出基本员工信息和员工工作经历\nService层 @Override public void add(Emp emp) { // 因为有两张表，一个是员工工作经历，一个是员工信息，要保存到两张表中 // 1、保存员工信息 // 设置更新时间字段 emp.setCreateTime(LocalDateTime.now()); emp.setUpdateTime(LocalDateTime.now()); empMapper.insert(emp); // 2、保存员工工作经历，可以没有工作经历，所以需要判断 List\u003cEmpExpr\u003e exprlist = emp.getExprList(); if(!CollectionUtils.isEmpty(exprlist)){ // 遍历集合，为empId赋值 exprlist.forEach(expr-\u003eexpr.setEmpId(emp.getId())); empExprMapper.insertBatch(exprlist); } } Service层需要向Mapper层发送两个请求，一个需要保存员工的信息，另一个需要保存员工的工作经历，保存工作经历的时候需要判断员工是否有工作经历，如果没有工作经历可以不保存\n保存工作经历的时候需要存储员工的id，这个id是插入了员工才有的，所以需要在Mapper层获取插入后的员工的id后才可以先给对象中的id赋值，然后插入到员工工作经历表中，用的是@Options(useGeneratedKeys = true,keyProperty = “id”)\n进行获取，其中第一个参数指定获取主键，第二个参数指定赋值到的地方\n这里遇到的bug，无法获取主键id，我把SQL语句写到xml文件中了，重新写到Mapper文件中就恢复正常，应该是注解的定义出了问题\nMapper层 // 第一个参数是表示获取主键，第二个参数是给参数赋值到类中的id中 @Options(useGeneratedKeys = true,keyProperty = \"id\") @Insert(\" insert into emp(username,password,name,gender,phone,job,salary,image,entry_date,dept_id,create_time,update_time)\" + \" values(#{username},#{password},#{name},#{gender},#{phone},#{job},#{salary},#{image},#{entryDate},#{deptId},#{createTime},#{updateTime})\") void insert(Emp emp); @Mapper public interface EmpExprMapper { void insertBatch(List\u003cEmpExpr\u003e exprList); } 使用foreach语句 \u003cmapper namespace=\"com.zzzzyj.mapper.EmpExprMapper\"\u003e \u003cinsert id=\"insertBatch\"\u003e insert into emp_expr(emp_id, begin, end, company, job) values \u003cforeach collection=\"exprList\" item=\"expr\" separator=\",\"\u003e (#{expr.empId},#{expr.begin},#{expr.end},#{expr.company},#{expr.job}) \u003c/foreach\u003e \u003c/insert\u003e \u003c/mapper\u003e 属性说明：foreach可以用来批量保存数据，如果有数据会继续添加，如果没有就不添加\ncollection： 集合名称\nitem： 集合遍历出来的元素/项\nseparator：每一次遍历使用的分隔符\nopen：遍历开始前拼接的片段\nclose：遍历结束后拼接的片段\n事物 概念：事务 是一组操作的集合，它是一个不可分割的工作单位。事务会把所有的操作作为一个整体一起向系统提交或撤销操作请求，即这些操作 要么同时成功，要么同时失败。\n默认MySQL的事务是自动提交的，也就是说，当执行一条DML语句，MySQL会立即隐式的提交事务。\n-- 开启事务 start transaction; / begin; -- 1. 保存员工基本信息insert into emp values (39, 'Tom', '123456', '汤姆', 1, '13300001111', 1, 4000, '1.jpg', '2023-11-01', 1, now(), now()); -- 2. 保存员工的工作经历信息insert into emp_expr(emp_id, begin, end, company, job) values (39,'2019-01-01', '2020-01-01', '百度', '开发'), (39,'2020-01-10', '2022-02-01', '阿里', '架构'); -- 提交事务(全部成功) / 回滚事务(有一个失败) commit; / rollback; 事务的隔离性：为什么在表的显示中看不到事物执行没提交的数据，在select语句中却可以看到，因为事物的隔离性\n如何控制事务？\n• 开启事务：start transaction/begin；\n• 提交事务：commit；（全部成功）\n• 回滚事务：rollback；（只要有一项失败）\nSpring事物管理 注解：@Transactional\n默认是出现运行时异常RuntimeException才会回滚\n作用：将当前方法交给spring进行事务管理，方法执行前，开启事务；成功执行完毕，提交事务；出现异常，回滚事务\n位置：业务（service）层的方法上、类上、接口上\n@Transactional方法加在类上，表示类中的所有方法都需要进行事务控制，加在接口上，所有实现类都需要进行事务控制，推荐加在方法上，只对方法进行事务控制。\n这个方法要对数据库进行多次的增删改，如果是一次就没必要加，一次失败就失败了\n配置特定类的日志级别为debug，那么就能看到事物的执行\n事物进阶-rollbackFor rollbackFor属性，可以控制什么异常需要回滚，默认只有运行时异常会回滚\n@Transactional(rollbackFor = {Exception.class}) 这个的意思是所有的异常都需要回滚\n事务进阶-propagation rollbackFor和propagation都是@transactional的属性\npropagation属性控制的是-当一个事务方法被另一个事务方法调用时，这个事务方法应该如何进行事务控制\n一个事物里边调用了另一个事物\n属性值 含义 REQUIRED 【默认值】需要事务，有则加入，无则创建新事务 REQUIRES_NEW 需要新事务，无论有无，总是创建新事务 SUPPORTS 支持事务，有则加入，无则在无事务状态中运行 NOT_SUPPORTED 不支持事务，在无事务状态下运行,如果当前存在已有事务,则挂起当前事务 MANDATORY 必须有事务，否则抛异常 NEVER 必须没事务，否则抛异常 . . . 事物的四大特性（ACID） **原子性：**事务是不可分割的最小单元，要么全部成功，要么全部失败\n**一致性：**事务完成时，必须使所有的数据都保持一致状态\n**隔离性：**数据库系统提供的隔离机制，保证事务在不受外部并发操作影响的独立环境下运行\n**持久性：**事务一旦提交或回滚，它对数据库中的数据的改变就是永久的\n——、\n文件上传 **文件上传：**是指将本地图片、视频、音频等文件上传到服务器，供其他用户浏览或下载的过程。\n文件上传在项目中应用非常广泛，我们经常发微博、发微信朋友圈都用到了文件上传功能。\n这里边的文件需要用MultipartFile类型的参数接收，这个类型是Spring框架提供的，上传的文件只会是临时文件，因为没有定义接收到的地方，并且一定要有enctype这个属性，要不然无法上传文件内容\n上传文件到本地 @PostMapping(\"/upload\") public Result upload(String name, Integer age, MultipartFile file) throws IOException { log.info(\"接收参数{},{},{}\", name, age, file); // 获取文件扩展名 String originalFilename = file.getOriginalFilename(); // substring截取，给定一个索引就是从这个索引之后的都截取，最后一个.的索引 String extension = originalFilename.substring(originalFilename.lastIndexOf(\".\")); // 组合成一个新的名字 String fileName = UUID.randomUUID().toString() + extension; // 保存文件 file.transferTo(new File(\"/Users/lengshao/Desktop/study/开发学习/java-web/day09-后端开发（员工管理）/上传的文件/\"+fileName)); return Result.success(); } 用uuid不会重复\n调用file.transferTo()可以存储文件\n默认只能接受1MB的大小，可以在yml中进行修改\n最大请求大小（包括所有文件和表单数据）\nservlet: multipart: # 最大上传文件限制 max-file-size: 10MB # 最大请求文件（包括所有文件和表单数据） max-request-size: 100MB 阿里云OSS 阿里云对象存储OSS （Object Storage Service），是一款海量、安全、低成本、高可靠的云存储服务。使用OSS，您可以通过网络随时存储和调用包括文本、图片、音频和视频等在内的各种文件。\n第三方服务使用的通用思路 SDK: Software Development Kit 的缩写，软件开发工具包，包括辅助软件开发的依赖（jar包)、代码示例等，都可以叫做SDK。\n阿里云oss-使用步骤 Bucket：存储空间是用户用于存储对象（Object，就是文件）的容器，所有的对象都必须隶属于某个存储空间。\nbucket相当于是一个存储空间，上传的内容要存到bucket里边\npublic class Demo { public static void main(String[] args) throws Exception { // Endpoint以华东1（杭州）为例，其它Region请按实际情况填写。 String endpoint = \"https://oss-cn-beijing.aliyuncs.com\"; // 从环境变量中获取访问凭证。运行本代码示例之前，请确保已设置环境变量OSS_ACCESS_KEY_ID和OSS_ACCESS_KEY_SECRET。 EnvironmentVariableCredentialsProvider credentialsProvider = CredentialsProviderFactory.newEnvironmentVariableCredentialsProvider(); // 填写Bucket名称，例如examplebucket。 String bucketName = \"java-web-study01\"; // 填写Object完整路径，例如exampledir/exampleobject.txt。Object完整路径中不能包含Bucket名称。 String objectName = \"1.txt\"; // 填写Bucket所在地域。以华东1（杭州）为例，Region填写为cn-hangzhou。 String region = \"cn-beijing\"; // 创建OSSClient实例。 ClientBuilderConfiguration clientBuilderConfiguration = new ClientBuilderConfiguration(); clientBuilderConfiguration.setSignatureVersion(SignVersion.V4); OSS ossClient = OSSClientBuilder.create() .endpoint(endpoint) .credentialsProvider(credentialsProvider) .clientConfiguration(clientBuilderConfiguration) .region(region) .build(); try { File file = new File(\"/Users/lengshao/Desktop/study/开发学习/java-web/day09-后端开发（员工管理）/04. 文件上传/中国梦.txt\"); byte[] content = Files.readAllBytes(file.toPath()); ossClient.putObject(bucketName, objectName, new ByteArrayInputStream(content)); } catch (OSSException oe) { System.out.println(\"Caught an OSSException, which means your request made it to OSS, \" + \"but was rejected with an error response for some reason.\"); System.out.println(\"Error Message:\" + oe.getErrorMessage()); System.out.println(\"Error Code:\" + oe.getErrorCode()); System.out.println(\"Request ID:\" + oe.getRequestId()); System.out.println(\"Host ID:\" + oe.getHostId()); } catch (ClientException ce) { System.out.println(\"Caught an ClientException, which means the client encountered \" + \"a serious internal problem while trying to communicate with OSS, \" + \"such as not being able to access the network.\"); System.out.println(\"Error Message:\" + ce.getMessage()); } finally { if (ossClient != null) { ossClient.shutdown(); } } } } 案例集成 用value属性赋值，导包导的是Spring中的，不是Lombok的，可以拿到yml配置文件中的值\n优化1:参数化配置 指将一些需要灵活变化的参数，配置在配置文件中，然后通过@Value注解来注入外部配置的属性。 @Value(\"${key}\")\n使用@Value注解注入配置文件的配置项，如果配置项多，注入繁琐，不便于维护管理 和 复用。\n优化2:@ConfigurationProperties 再定义一个工具类，这个类用来存放配置参数，用@ConfigurationProperties修饰来获取yml配置中的数据，prefix的意思是前缀的意思\n1．注入外部配置文件中的配置项的两种方式？\n@Value：一个属性一个属性的注入 @ConfigurationProperties： 批量将多个属性注入到bean对象中 2. 两种方式各自的使用场景？\n如果属性较少，建议@value注入即可 如果属性较多，考虑复用，建议使用@ConfigurationProperties ","wordCount":"3722","inLanguage":"zh","image":"https://wqnm1gb.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E","datePublished":"2025-03-06T10:07:18+08:00","dateModified":"2025-03-06T10:07:18+08:00","author":{"@type":"Person","name":"冷漠三狗子丶"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://wqnm1gb.github.io/posts/day09%E5%90%8E%E7%AB%AFweb%E5%AE%9E%E6%88%98%E5%91%98%E5%B7%A5%E7%AE%A1%E7%90%86/"},"publisher":{"@type":"Organization","name":"三狗子的博客","logo":{"@type":"ImageObject","url":"https://wqnm1gb.github.io/images/favicon.png"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://wqnm1gb.github.io/ accesskey=h title="主页 (Alt + H)"><img src=https://wqnm1gb.github.io/apple-touch-icon.png alt aria-label=logo height=35>主页</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://wqnm1gb.github.io/ title=三狗子的博客><span>首页</span></a></li><li><a href=https://wqnm1gb.github.io/archives/ title=归档><span>归档</span></a></li><li><a href=https://wqnm1gb.github.io/categories/ title=Categories><span>分类</span></a></li><li><a href=https://wqnm1gb.github.io/tags/ title=Tags><span>标签</span></a></li><li><a href=https://wqnm1gb.github.io/search/ title=搜索><span>搜索</span></a></li><li><a href=https://wqnm1gb.github.io/about/ title=关于><span>关于</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://wqnm1gb.github.io/>主页</a>&nbsp;»&nbsp;<a href=https://wqnm1gb.github.io/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Day09 后端Web实战（员工管理）</h1><div class=post-meta><span title='2025-03-06 10:07:18 +0800 +0800'>三月 6, 2025</span>&nbsp;·&nbsp;8 分钟&nbsp;·&nbsp;3722 字&nbsp;·&nbsp;冷漠三狗子丶</div></header><div class=post-content><h1 id=新增员工>新增员工<a hidden class=anchor aria-hidden=true href=#新增员工>#</a></h1><p><img loading=lazy src=/images/Day09%e5%90%8e%e7%ab%afWeb%e5%ae%9e%e6%88%98%ef%bc%88%e5%91%98%e5%b7%a5%e7%ae%a1%e7%90%86%ef%bc%89.assets/1734051333476-6c2aeeae-d132-4863-84b7-12863c88958b.png alt></p><h2 id=controller层>Controller层<a hidden class=anchor aria-hidden=true href=#controller层>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=w>    </span><span class=nd>@PostMapping</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>Result</span><span class=w> </span><span class=nf>add</span><span class=p>(</span><span class=nd>@RequestBody</span><span class=w> </span><span class=n>Emp</span><span class=w> </span><span class=n>emp</span><span class=p>){</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// RequestBody用于接收Json格式的数据</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>log</span><span class=p>.</span><span class=na>info</span><span class=p>(</span><span class=s>&#34;新增的员工数据是{}&#34;</span><span class=p>,</span><span class=n>emp</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>empService</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>emp</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>Result</span><span class=p>.</span><span class=na>success</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>Controller层只负责接收前端传来的Json格式的信息，接收之后把信息发给Service层进行进一步的操作，这层中不需要分隔出基本员工信息和员工工作经历</p><h2 id=service层>Service层<a hidden class=anchor aria-hidden=true href=#service层>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>add</span><span class=p>(</span><span class=n>Emp</span><span class=w> </span><span class=n>emp</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 因为有两张表，一个是员工工作经历，一个是员工信息，要保存到两张表中</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 1、保存员工信息</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 设置更新时间字段</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>emp</span><span class=p>.</span><span class=na>setCreateTime</span><span class=p>(</span><span class=n>LocalDateTime</span><span class=p>.</span><span class=na>now</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>emp</span><span class=p>.</span><span class=na>setUpdateTime</span><span class=p>(</span><span class=n>LocalDateTime</span><span class=p>.</span><span class=na>now</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>empMapper</span><span class=p>.</span><span class=na>insert</span><span class=p>(</span><span class=n>emp</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 2、保存员工工作经历，可以没有工作经历，所以需要判断</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>List</span><span class=o>&lt;</span><span class=n>EmpExpr</span><span class=o>&gt;</span><span class=w> </span><span class=n>exprlist</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>emp</span><span class=p>.</span><span class=na>getExprList</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>CollectionUtils</span><span class=p>.</span><span class=na>isEmpty</span><span class=p>(</span><span class=n>exprlist</span><span class=p>)){</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 遍历集合，为empId赋值</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>exprlist</span><span class=p>.</span><span class=na>forEach</span><span class=p>(</span><span class=n>expr</span><span class=o>-&gt;</span><span class=n>expr</span><span class=p>.</span><span class=na>setEmpId</span><span class=p>(</span><span class=n>emp</span><span class=p>.</span><span class=na>getId</span><span class=p>()));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>empExprMapper</span><span class=p>.</span><span class=na>insertBatch</span><span class=p>(</span><span class=n>exprlist</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>Service层需要向Mapper层发送两个请求，一个需要保存员工的信息，另一个需要保存员工的工作经历，保存工作经历的时候需要判断员工是否有工作经历，如果没有工作经历可以不保存</p><p>保存工作经历的时候需要存储员工的id，这个id是插入了员工才有的，所以需要在Mapper层获取插入后的员工的id后才可以先给对象中的id赋值，然后插入到员工工作经历表中，用的是@Options(useGeneratedKeys = true,keyProperty = &ldquo;id&rdquo;)</p><p>进行获取，其中第一个参数指定获取主键，第二个参数指定赋值到的地方</p><p>这里遇到的bug，无法获取主键id，我把SQL语句写到xml文件中了，重新写到Mapper文件中就恢复正常，应该是注解的定义出了问题</p><h2 id=mapper层>Mapper层<a hidden class=anchor aria-hidden=true href=#mapper层>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=w>    </span><span class=c1>// 第一个参数是表示获取主键，第二个参数是给参数赋值到类中的id中</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Options</span><span class=p>(</span><span class=n>useGeneratedKeys</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>true</span><span class=p>,</span><span class=n>keyProperty</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;id&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Insert</span><span class=p>(</span><span class=s>&#34;        insert into emp(username,password,name,gender,phone,job,salary,image,entry_date,dept_id,create_time,update_time)&#34;</span><span class=w> </span><span class=o>+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=s>&#34;        values(#{username},#{password},#{name},#{gender},#{phone},#{job},#{salary},#{image},#{entryDate},#{deptId},#{createTime},#{updateTime})&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>void</span><span class=w> </span><span class=nf>insert</span><span class=p>(</span><span class=n>Emp</span><span class=w> </span><span class=n>emp</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Mapper</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>interface</span> <span class=nc>EmpExprMapper</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>void</span><span class=w> </span><span class=nf>insertBatch</span><span class=p>(</span><span class=n>List</span><span class=o>&lt;</span><span class=n>EmpExpr</span><span class=o>&gt;</span><span class=w> </span><span class=n>exprList</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>使用foreach语句</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>&lt;</span><span class=n>mapper</span><span class=w> </span><span class=n>namespace</span><span class=o>=</span><span class=s>&#34;com.zzzzyj.mapper.EmpExprMapper&#34;</span><span class=o>&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>&lt;</span><span class=n>insert</span><span class=w> </span><span class=n>id</span><span class=o>=</span><span class=s>&#34;insertBatch&#34;</span><span class=o>&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>insert</span><span class=w> </span><span class=n>into</span><span class=w> </span><span class=nf>emp_expr</span><span class=p>(</span><span class=n>emp_id</span><span class=p>,</span><span class=w> </span><span class=n>begin</span><span class=p>,</span><span class=w> </span><span class=n>end</span><span class=p>,</span><span class=w> </span><span class=n>company</span><span class=p>,</span><span class=w> </span><span class=n>job</span><span class=p>)</span><span class=w> </span><span class=n>values</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=o>&lt;</span><span class=n>foreach</span><span class=w> </span><span class=n>collection</span><span class=o>=</span><span class=s>&#34;exprList&#34;</span><span class=w> </span><span class=n>item</span><span class=o>=</span><span class=s>&#34;expr&#34;</span><span class=w> </span><span class=n>separator</span><span class=o>=</span><span class=s>&#34;,&#34;</span><span class=o>&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>(</span><span class=err>#</span><span class=p>{</span><span class=n>expr</span><span class=p>.</span><span class=na>empId</span><span class=p>},</span><span class=err>#</span><span class=p>{</span><span class=n>expr</span><span class=p>.</span><span class=na>begin</span><span class=p>},</span><span class=err>#</span><span class=p>{</span><span class=n>expr</span><span class=p>.</span><span class=na>end</span><span class=p>},</span><span class=err>#</span><span class=p>{</span><span class=n>expr</span><span class=p>.</span><span class=na>company</span><span class=p>},</span><span class=err>#</span><span class=p>{</span><span class=n>expr</span><span class=p>.</span><span class=na>job</span><span class=p>})</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=o>&lt;/</span><span class=n>foreach</span><span class=o>&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>&lt;/</span><span class=n>insert</span><span class=o>&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>&lt;/</span><span class=n>mapper</span><span class=o>&gt;</span><span class=w>
</span></span></span></code></pre></div><p>属性说明：foreach可以用来批量保存数据，如果有数据会继续添加，如果没有就不添加</p><ol><li><p>collection： 集合名称</p></li><li><p>item： 集合遍历出来的元素/项</p></li><li><p>separator：每一次遍历使用的分隔符</p></li><li><p>open：遍历开始前拼接的片段</p></li><li><p>close：遍历结束后拼接的片段</p></li></ol><h1 id=事物>事物<a hidden class=anchor aria-hidden=true href=#事物>#</a></h1><p><strong>概念：<strong>事务 是一组</strong>操作的集合</strong>，它是一个<strong>不可分割的工作单位</strong>。事务会把所有的操作作为一个整体一起向系统提交或撤销操作请求，即这些操作 要么同时成功，要么同时失败。</p><p>默认MySQL的事务是<strong>自动提交</strong>的，也就是说，当执行一条DML语句，MySQL会立即隐式的提交事务。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=o>--</span><span class=w> </span><span class=n>开启事务</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>start</span><span class=w> </span><span class=n>transaction</span><span class=p>;</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=n>begin</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>--</span><span class=w> </span><span class=n>1</span><span class=p>.</span><span class=w> </span><span class=n>保存员工基本信息insert</span><span class=w> </span><span class=n>into</span><span class=w> </span><span class=n>emp</span><span class=w> </span><span class=nf>values</span><span class=w> </span><span class=p>(</span><span class=n>39</span><span class=p>,</span><span class=w> </span><span class=err>&#39;</span><span class=n>Tom</span><span class=err>&#39;</span><span class=p>,</span><span class=w> </span><span class=err>&#39;</span><span class=n>123456</span><span class=err>&#39;</span><span class=p>,</span><span class=w> </span><span class=err>&#39;</span><span class=n>汤姆</span><span class=err>&#39;</span><span class=p>,</span><span class=w> </span><span class=n>1</span><span class=p>,</span><span class=w> </span><span class=err>&#39;</span><span class=n>13300001111</span><span class=err>&#39;</span><span class=p>,</span><span class=w> </span><span class=n>1</span><span class=p>,</span><span class=w> </span><span class=n>4000</span><span class=p>,</span><span class=w> </span><span class=err>&#39;</span><span class=n>1</span><span class=p>.</span><span class=na>jpg</span><span class=err>&#39;</span><span class=p>,</span><span class=w> </span><span class=err>&#39;</span><span class=n>2023</span><span class=o>-</span><span class=n>11</span><span class=o>-</span><span class=n>01</span><span class=err>&#39;</span><span class=p>,</span><span class=w> </span><span class=n>1</span><span class=p>,</span><span class=w> </span><span class=n>now</span><span class=p>(),</span><span class=w> </span><span class=n>now</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>--</span><span class=w> </span><span class=n>2</span><span class=p>.</span><span class=w> </span><span class=n>保存员工的工作经历信息insert</span><span class=w> </span><span class=n>into</span><span class=w> </span><span class=nf>emp_expr</span><span class=p>(</span><span class=n>emp_id</span><span class=p>,</span><span class=w> </span><span class=n>begin</span><span class=p>,</span><span class=w> </span><span class=n>end</span><span class=p>,</span><span class=w> </span><span class=n>company</span><span class=p>,</span><span class=w> </span><span class=n>job</span><span class=p>)</span><span class=w> </span><span class=n>values</span><span class=w> </span><span class=p>(</span><span class=n>39</span><span class=p>,</span><span class=err>&#39;</span><span class=n>2019</span><span class=o>-</span><span class=n>01</span><span class=o>-</span><span class=n>01</span><span class=err>&#39;</span><span class=p>,</span><span class=w> </span><span class=err>&#39;</span><span class=n>2020</span><span class=o>-</span><span class=n>01</span><span class=o>-</span><span class=n>01</span><span class=err>&#39;</span><span class=p>,</span><span class=w> </span><span class=err>&#39;</span><span class=n>百度</span><span class=err>&#39;</span><span class=p>,</span><span class=w> </span><span class=err>&#39;</span><span class=n>开发</span><span class=err>&#39;</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                                                                                        </span><span class=p>(</span><span class=n>39</span><span class=p>,</span><span class=err>&#39;</span><span class=n>2020</span><span class=o>-</span><span class=n>01</span><span class=o>-</span><span class=n>10</span><span class=err>&#39;</span><span class=p>,</span><span class=w> </span><span class=err>&#39;</span><span class=n>2022</span><span class=o>-</span><span class=n>02</span><span class=o>-</span><span class=n>01</span><span class=err>&#39;</span><span class=p>,</span><span class=w> </span><span class=err>&#39;</span><span class=n>阿里</span><span class=err>&#39;</span><span class=p>,</span><span class=w> </span><span class=err>&#39;</span><span class=n>架构</span><span class=err>&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>--</span><span class=w> </span><span class=n>提交事务</span><span class=p>(</span><span class=n>全部成功</span><span class=p>)</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=n>回滚事务</span><span class=p>(</span><span class=n>有一个失败</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>commit</span><span class=p>;</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=n>rollback</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><p>事务的隔离性：为什么在表的显示中看不到事物执行没提交的数据，在select语句中却可以看到，因为事物的隔离性</p><p><strong>如何控制事务？</strong></p><p>• 开启事务：start transaction/begin；</p><p>• 提交事务：commit；（全部成功）</p><p>• 回滚事务：rollback；（只要有一项失败）</p><h2 id=spring事物管理>Spring事物管理<a hidden class=anchor aria-hidden=true href=#spring事物管理>#</a></h2><p>注解：@Transactional</p><p>默认是出现运行时异常RuntimeException才会回滚</p><p>作用：将当前方法交给spring进行事务管理，方法执行前，开启事务；成功执行完毕，提交事务；出现异常，回滚事务</p><p>位置：业务（service）层的方法上、类上、接口上</p><p><img loading=lazy src=/images/Day09%e5%90%8e%e7%ab%afWeb%e5%ae%9e%e6%88%98%ef%bc%88%e5%91%98%e5%b7%a5%e7%ae%a1%e7%90%86%ef%bc%89.assets/1734060440915-57adec6a-acde-4122-9411-8533974f640e.png alt></p><p>@Transactional方法加在类上，表示类中的所有方法都需要进行事务控制，加在接口上，所有实现类都需要进行事务控制，推荐加在方法上，只对方法进行事务控制。</p><p>这个方法要对<strong>数据库进行多次的增删改</strong>，如果是一次就没必要加，一次失败就失败了</p><p>配置特定类的日志级别为debug，那么就能看到事物的执行</p><h3 id=事物进阶-rollbackfor>事物进阶-rollbackFor<a hidden class=anchor aria-hidden=true href=#事物进阶-rollbackfor>#</a></h3><p>rollbackFor属性，可以控制什么异常需要回滚，默认只有运行时异常会回滚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Transactional</span><span class=p>(</span><span class=n>rollbackFor</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span><span class=n>Exception</span><span class=p>.</span><span class=na>class</span><span class=p>})</span><span class=w>
</span></span></span></code></pre></div><p>这个的意思是所有的异常都需要回滚</p><h3 id=事务进阶-propagation>事务进阶-propagation<a hidden class=anchor aria-hidden=true href=#事务进阶-propagation>#</a></h3><p>rollbackFor和propagation都是@transactional的属性</p><p>propagation属性控制的是-当一个事务方法被另一个事务方法调用时，这个事务方法应该如何进行事务控制</p><p><img loading=lazy src=/images/Day09%e5%90%8e%e7%ab%afWeb%e5%ae%9e%e6%88%98%ef%bc%88%e5%91%98%e5%b7%a5%e7%ae%a1%e7%90%86%ef%bc%89.assets/1734074290913-5d756bba-25fd-498b-8955-e6d8e5da672e.png alt></p><p>一个事物里边调用了另一个事物</p><table><thead><tr><th style=text-align:center><strong>属性值</strong></th><th><strong>含义</strong></th></tr></thead><tbody><tr><td style=text-align:center>REQUIRED</td><td>【默认值】需要事务，有则加入，无则创建新事务</td></tr><tr><td style=text-align:center>REQUIRES_NEW</td><td>需要新事务，无论有无，总是创建新事务</td></tr><tr><td style=text-align:center>SUPPORTS</td><td>支持事务，有则加入，无则在无事务状态中运行</td></tr><tr><td style=text-align:center>NOT_SUPPORTED</td><td>不支持事务，在无事务状态下运行,如果当前存在已有事务,则挂起当前事务</td></tr><tr><td style=text-align:center>MANDATORY</td><td>必须有事务，否则抛异常</td></tr><tr><td style=text-align:center>NEVER</td><td>必须没事务，否则抛异常</td></tr><tr><td style=text-align:center>. . .</td><td></td></tr></tbody></table><h3 id=事物的四大特性acid>事物的四大特性（ACID）<a hidden class=anchor aria-hidden=true href=#事物的四大特性acid>#</a></h3><p>**原子性：**事务是不可分割的最小单元，要么全部成功，要么全部失败</p><p>**一致性：**事务完成时，必须使所有的数据都保持一致状态</p><p>**隔离性：**数据库系统提供的隔离机制，保证事务在不受外部并发操作影响的独立环境下运行</p><p>**持久性：**事务一旦提交或回滚，它对数据库中的数据的改变就是永久的</p><p><strong>——、</strong></p><h1 id=文件上传>文件上传<a hidden class=anchor aria-hidden=true href=#文件上传>#</a></h1><p>**文件上传：**是指将本地图片、视频、音频等文件上传到服务器，供其他用户浏览或下载的过程。</p><p>文件上传在项目中应用非常广泛，我们经常发微博、发微信朋友圈都用到了文件上传功能。</p><p><img loading=lazy src=/images/Day09%e5%90%8e%e7%ab%afWeb%e5%ae%9e%e6%88%98%ef%bc%88%e5%91%98%e5%b7%a5%e7%ae%a1%e7%90%86%ef%bc%89.assets/1734227782939-b79209dc-4a30-4466-872a-be05d865577e.png alt></p><p>这里边的文件需要用MultipartFile类型的参数接收，这个类型是Spring框架提供的，上传的文件只会是临时文件，因为没有定义接收到的地方，并且一定要有enctype这个属性，要不然无法上传文件内容</p><h2 id=上传文件到本地>上传文件到本地<a hidden class=anchor aria-hidden=true href=#上传文件到本地>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=w>    </span><span class=nd>@PostMapping</span><span class=p>(</span><span class=s>&#34;/upload&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>Result</span><span class=w> </span><span class=nf>upload</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>name</span><span class=p>,</span><span class=w> </span><span class=n>Integer</span><span class=w> </span><span class=n>age</span><span class=p>,</span><span class=w> </span><span class=n>MultipartFile</span><span class=w> </span><span class=n>file</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>IOException</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>log</span><span class=p>.</span><span class=na>info</span><span class=p>(</span><span class=s>&#34;接收参数{},{},{}&#34;</span><span class=p>,</span><span class=w> </span><span class=n>name</span><span class=p>,</span><span class=w> </span><span class=n>age</span><span class=p>,</span><span class=w> </span><span class=n>file</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 获取文件扩展名</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>originalFilename</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>file</span><span class=p>.</span><span class=na>getOriginalFilename</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// substring截取，给定一个索引就是从这个索引之后的都截取，最后一个.的索引</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>extension</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>originalFilename</span><span class=p>.</span><span class=na>substring</span><span class=p>(</span><span class=n>originalFilename</span><span class=p>.</span><span class=na>lastIndexOf</span><span class=p>(</span><span class=s>&#34;.&#34;</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 组合成一个新的名字</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>fileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>UUID</span><span class=p>.</span><span class=na>randomUUID</span><span class=p>().</span><span class=na>toString</span><span class=p>()</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>extension</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 保存文件</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>file</span><span class=p>.</span><span class=na>transferTo</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>File</span><span class=p>(</span><span class=s>&#34;/Users/lengshao/Desktop/study/开发学习/java-web/day09-后端开发（员工管理）/上传的文件/&#34;</span><span class=o>+</span><span class=n>fileName</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>Result</span><span class=p>.</span><span class=na>success</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>用uuid不会重复</p><p>调用file.transferTo()可以存储文件</p><p>默认只能接受1MB的大小，可以在yml中进行修改</p><p>最大请求大小（包括所有文件和表单数据）</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=w>  </span><span class=n>servlet</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>multipart</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>#</span><span class=w>      </span><span class=n>最大上传文件限制</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>max</span><span class=o>-</span><span class=n>file</span><span class=o>-</span><span class=n>size</span><span class=p>:</span><span class=w> </span><span class=n>10MB</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>#</span><span class=w>      </span><span class=n>最大请求文件</span><span class=err>（</span><span class=n>包括所有文件和表单数据</span><span class=err>）</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>max</span><span class=o>-</span><span class=n>request</span><span class=o>-</span><span class=n>size</span><span class=p>:</span><span class=w> </span><span class=n>100MB</span><span class=w>
</span></span></span></code></pre></div><h2 id=阿里云oss>阿里云OSS<a hidden class=anchor aria-hidden=true href=#阿里云oss>#</a></h2><p>阿里云对象存储OSS （Object Storage Service），是一款海量、安全、低成本、高可靠的云存储服务。使用OSS，您可以通过网络随时存储和调用包括文本、图片、音频和视频等在内的各种文件。</p><h3 id=第三方服务使用的通用思路>第三方服务使用的通用思路<a hidden class=anchor aria-hidden=true href=#第三方服务使用的通用思路>#</a></h3><p><img loading=lazy src=/images/Day09%e5%90%8e%e7%ab%afWeb%e5%ae%9e%e6%88%98%ef%bc%88%e5%91%98%e5%b7%a5%e7%ae%a1%e7%90%86%ef%bc%89.assets/1734317794296-8f4dde11-cca1-4449-8d06-7ecee7fc1bc6.png alt>
SDK: Software Development Kit 的缩写，软件开发工具包，包括辅助软件开发的依赖（jar包)、代码示例等，都可以叫做SDK。</p><h3 id=阿里云oss-使用步骤>阿里云oss-使用步骤<a hidden class=anchor aria-hidden=true href=#阿里云oss-使用步骤>#</a></h3><p><img loading=lazy src=/images/Day09%e5%90%8e%e7%ab%afWeb%e5%ae%9e%e6%88%98%ef%bc%88%e5%91%98%e5%b7%a5%e7%ae%a1%e7%90%86%ef%bc%89.assets/1734317878918-4e5ca440-43f5-4a01-a3a3-a3a1e0d9e9a7.png alt></p><p>Bucket：存储空间是用户用于存储对象（Object，就是文件）的容器，所有的对象都必须隶属于某个存储空间。</p><p>bucket相当于是一个存储空间，上传的内容要存到bucket里边</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>Demo</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span><span class=w> </span><span class=n>args</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Exception</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// Endpoint以华东1（杭州）为例，其它Region请按实际情况填写。</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>endpoint</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;https://oss-cn-beijing.aliyuncs.com&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 从环境变量中获取访问凭证。运行本代码示例之前，请确保已设置环境变量OSS_ACCESS_KEY_ID和OSS_ACCESS_KEY_SECRET。</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>EnvironmentVariableCredentialsProvider</span><span class=w> </span><span class=n>credentialsProvider</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>CredentialsProviderFactory</span><span class=p>.</span><span class=na>newEnvironmentVariableCredentialsProvider</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 填写Bucket名称，例如examplebucket。</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>bucketName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;java-web-study01&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 填写Object完整路径，例如exampledir/exampleobject.txt。Object完整路径中不能包含Bucket名称。</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>objectName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;1.txt&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 填写Bucket所在地域。以华东1（杭州）为例，Region填写为cn-hangzhou。</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>region</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;cn-beijing&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 创建OSSClient实例。</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>ClientBuilderConfiguration</span><span class=w> </span><span class=n>clientBuilderConfiguration</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ClientBuilderConfiguration</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>clientBuilderConfiguration</span><span class=p>.</span><span class=na>setSignatureVersion</span><span class=p>(</span><span class=n>SignVersion</span><span class=p>.</span><span class=na>V4</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>OSS</span><span class=w> </span><span class=n>ossClient</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>OSSClientBuilder</span><span class=p>.</span><span class=na>create</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>endpoint</span><span class=p>(</span><span class=n>endpoint</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>credentialsProvider</span><span class=p>(</span><span class=n>credentialsProvider</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>clientConfiguration</span><span class=p>(</span><span class=n>clientBuilderConfiguration</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>region</span><span class=p>(</span><span class=n>region</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>File</span><span class=w> </span><span class=n>file</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>File</span><span class=p>(</span><span class=s>&#34;/Users/lengshao/Desktop/study/开发学习/java-web/day09-后端开发（员工管理）/04. 文件上传/中国梦.txt&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=kt>byte</span><span class=o>[]</span><span class=w> </span><span class=n>content</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Files</span><span class=p>.</span><span class=na>readAllBytes</span><span class=p>(</span><span class=n>file</span><span class=p>.</span><span class=na>toPath</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>ossClient</span><span class=p>.</span><span class=na>putObject</span><span class=p>(</span><span class=n>bucketName</span><span class=p>,</span><span class=w> </span><span class=n>objectName</span><span class=p>,</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ByteArrayInputStream</span><span class=p>(</span><span class=n>content</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>OSSException</span><span class=w> </span><span class=n>oe</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;Caught an OSSException, which means your request made it to OSS, &#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=o>+</span><span class=w> </span><span class=s>&#34;but was rejected with an error response for some reason.&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;Error Message:&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>oe</span><span class=p>.</span><span class=na>getErrorMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;Error Code:&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>oe</span><span class=p>.</span><span class=na>getErrorCode</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;Request ID:&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>oe</span><span class=p>.</span><span class=na>getRequestId</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;Host ID:&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>oe</span><span class=p>.</span><span class=na>getHostId</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>ClientException</span><span class=w> </span><span class=n>ce</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;Caught an ClientException, which means the client encountered &#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=o>+</span><span class=w> </span><span class=s>&#34;a serious internal problem while trying to communicate with OSS, &#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=o>+</span><span class=w> </span><span class=s>&#34;such as not being able to access the network.&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;Error Message:&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>ce</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>finally</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>ossClient</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>ossClient</span><span class=p>.</span><span class=na>shutdown</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><h3 id=案例集成>案例集成<a hidden class=anchor aria-hidden=true href=#案例集成>#</a></h3><p><img loading=lazy src=/images/Day09%e5%90%8e%e7%ab%afWeb%e5%ae%9e%e6%88%98%ef%bc%88%e5%91%98%e5%b7%a5%e7%ae%a1%e7%90%86%ef%bc%89.assets/1734318816669-16d970b1-bdf4-430a-a2a8-4845475265cc.png alt></p><p>用value属性赋值，导包导的是Spring中的，不是Lombok的，可以拿到yml配置文件中的值</p><h3 id=优化1参数化配置>优化1:参数化配置<a hidden class=anchor aria-hidden=true href=#优化1参数化配置>#</a></h3><p>指将一些需要灵活变化的参数，配置在<strong>配置文件中</strong>，然后通过@Value注解来注入外部配置的属性。 @Value("${key}")</p><p><img loading=lazy src=/images/Day09%e5%90%8e%e7%ab%afWeb%e5%ae%9e%e6%88%98%ef%bc%88%e5%91%98%e5%b7%a5%e7%ae%a1%e7%90%86%ef%bc%89.assets/1734325424836-6b5c8dc3-ba3c-4440-90a2-4fcd70ded97e.png alt></p><p>使用@Value注解注入配置文件的配置项，如果配置项多，注入繁琐，不便于维护管理 和 复用。</p><p><img loading=lazy src=/images/Day09%e5%90%8e%e7%ab%afWeb%e5%ae%9e%e6%88%98%ef%bc%88%e5%91%98%e5%b7%a5%e7%ae%a1%e7%90%86%ef%bc%89.assets/1734325486009-301ba182-69ef-44ea-a760-72266fb1d2f7.png alt></p><h3 id=优化2configurationproperties>优化2:@ConfigurationProperties<a hidden class=anchor aria-hidden=true href=#优化2configurationproperties>#</a></h3><p><img loading=lazy src=/images/Day09%e5%90%8e%e7%ab%afWeb%e5%ae%9e%e6%88%98%ef%bc%88%e5%91%98%e5%b7%a5%e7%ae%a1%e7%90%86%ef%bc%89.assets/1734325564314-03ebaabb-1bd0-4d5a-8865-05ae5e9ab67b.png alt></p><p>再定义一个工具类，这个类用来存放配置参数，用@ConfigurationProperties修饰来获取yml配置中的数据，prefix的意思是前缀的意思</p><p><strong>1．注入外部配置文件中的配置项的两种方式？</strong></p><ul><li>@Value：一个属性一个属性的注入</li><li>@ConfigurationProperties： 批量将多个属性注入到bean对象中</li></ul><p><strong>2. 两种方式各自的使用场景？</strong></p><ul><li>如果属性较少，建议@value注入即可</li><li>如果属性较多，考虑复用，建议使用@ConfigurationProperties</li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://wqnm1gb.github.io/tags/java-web/>Java Web</a></li></ul><nav class=paginav><a class=prev href=https://wqnm1gb.github.io/posts/day10%E5%90%8E%E7%AB%AFweb%E5%AE%9E%E6%88%98%E5%91%98%E5%B7%A5%E7%AE%A1%E7%90%86/><span class=title>« 上一页</span><br><span>Day10 后端Web实战（员工管理）</span>
</a><a class=next href=https://wqnm1gb.github.io/posts/day08%E5%90%8E%E7%AB%AFweb%E5%AE%9E%E6%88%98%E5%91%98%E5%B7%A5%E7%AE%A1%E7%90%86/><span class=title>下一页 »</span><br><span>Day08 后端Web实战（员工管理）</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://wqnm1gb.github.io/>三狗子的博客</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="复制";function s(){t.innerHTML="已复制！",setTimeout(()=>{t.innerHTML="复制"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>