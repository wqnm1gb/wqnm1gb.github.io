<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Day03 菜品管理 | 三狗子的博客</title>
<meta name=keywords content="苍穹外卖"><meta name=description content="公共字段自动填充
AOP切面编程

  
      
          序号
          字段名
          含义
          数据类型
          操作类型
      
  
  
      
          1
          create_time
          创建时间
          datetime
          insert
      
      
          2
          create_user
          创建人id
          bigint
          
      
      
          3
          update_time
          修改时间
          datetime
          insert、update
      
      
          4
          update_user
          修改人id
          bigint
          
      
  

• 自定义注解AutoFill，用于标识需要进行公共字段自动填充的方法"><meta name=author content="冷漠三狗子丶"><link rel=canonical href=https://wqnm1gb.github.io/posts/day03%E8%8F%9C%E5%93%81%E7%AE%A1%E7%90%86/><link crossorigin=anonymous href=/assets/css/stylesheet.3d688279d829dc24da48acd11f9e33ebea2f39c035e899e1bf4297d8b7aa89b9.css integrity="sha256-PWiCedgp3CTaSKzRH54z6+ovOcA16Jnhv0KX2Leqibk=" rel="preload stylesheet" as=style><link rel=icon href=https://wqnm1gb.github.io/images/favicon.png><link rel=icon type=image/png sizes=16x16 href=https://wqnm1gb.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://wqnm1gb.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://wqnm1gb.github.io/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://wqnm1gb.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh href=https://wqnm1gb.github.io/posts/day03%E8%8F%9C%E5%93%81%E7%AE%A1%E7%90%86/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&display=swap" rel=stylesheet><script type=text/javascript async src="https://cdn.bootcss.com/mathjax/2.7.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML">MathJax.Hub.Config({tex2jax:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["[[","]]"]],processEscapes:!0,processEnvironments:!0,skipTags:["script","noscript","style","textarea","pre"],TeX:{equationNumbers:{autoNumber:"AMS"},extensions:["AMSmath.js","AMSsymbols.js"]}}}),MathJax.Hub.Queue(function(){var e,t=MathJax.Hub.getAllJax();for(e=0;e<t.length;e+=1)t[e].SourceElement().parentNode.className+=" has-jax"})</script><style>code.has-jax{font:inherit;font-size:100%;background:inherit;border:inherit;color:#515151}</style><meta property="og:title" content="Day03 菜品管理"><meta property="og:description" content="公共字段自动填充
AOP切面编程

  
      
          序号
          字段名
          含义
          数据类型
          操作类型
      
  
  
      
          1
          create_time
          创建时间
          datetime
          insert
      
      
          2
          create_user
          创建人id
          bigint
          
      
      
          3
          update_time
          修改时间
          datetime
          insert、update
      
      
          4
          update_user
          修改人id
          bigint
          
      
  

• 自定义注解AutoFill，用于标识需要进行公共字段自动填充的方法"><meta property="og:type" content="article"><meta property="og:url" content="https://wqnm1gb.github.io/posts/day03%E8%8F%9C%E5%93%81%E7%AE%A1%E7%90%86/"><meta property="og:image" content="https://wqnm1gb.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-03-20T11:06:04+08:00"><meta property="article:modified_time" content="2025-03-20T11:06:04+08:00"><meta property="og:site_name" content="三狗子的博客"><meta property="fb:admins" content="your-facebook-admin-id"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://wqnm1gb.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Day03 菜品管理","item":"https://wqnm1gb.github.io/posts/day03%E8%8F%9C%E5%93%81%E7%AE%A1%E7%90%86/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Day03 菜品管理","name":"Day03 菜品管理","description":"公共字段自动填充 AOP切面编程\n序号 字段名 含义 数据类型 操作类型 1 create_time 创建时间 datetime insert 2 create_user 创建人id bigint 3 update_time 修改时间 datetime insert、update 4 update_user 修改人id bigint • 自定义注解AutoFill，用于标识需要进行公共字段自动填充的方法\n","keywords":["苍穹外卖"],"articleBody":"公共字段自动填充 AOP切面编程\n序号 字段名 含义 数据类型 操作类型 1 create_time 创建时间 datetime insert 2 create_user 创建人id bigint 3 update_time 修改时间 datetime insert、update 4 update_user 修改人id bigint • 自定义注解AutoFill，用于标识需要进行公共字段自动填充的方法\n• 自定义切面类AutoFillAspect，统一拦截加入了AutoFill 注解的方法，通过反射为公共字段赋值\n• 在Mapper 的方法上加入AutoFill注解\n技术点：枚举、注解、AOP、反射\n开发步骤 自定义注解 AutoFill，用于标识需要进行公共字段自动填充的方法 // 自定义注解AutoFill @Target(ElementType.METHOD) @Retention(RetentionPolicy.RUNTIME) public @interface AutoFill { OperationType value(); } 这里边为什么是OperationType value();\n这其实是注解的规定，自定义注解的格式如下\npublic @interface 注解名称 { public 属性类型 属性名() default 默认值 ; } 在注解中定义的元素实际上是方法的声明，不是直接的字段（即变量）。注解的元素定义的形式很像方法签名，所有元素（即注解里的成员）都是方法，它们没有方法体，只声明返回值类型和方法名。\n在你的例子中，value() 声明的是一个返回类型为 OperationType 的方法。你在使用注解时，通过 () 来传递值给这个方法。 比如 @AutoFill(OperationType.UPDATE)，就是在调用 value() 方法，并传递了 OperationType.UPDATE 作为返回 自定义切面类 AutoFillAspect，统一拦截加入了 AutoFill 注解的方法，通过反射为公共字段赋值 @Aspect @Component @Slf4j public class AutoFillAspect { // 自定义切面，统一为公共字段赋值 // 该注解的作用是将公共的切点表达式抽取出来，需要用到时引用该切点表达式即可 @Pointcut(\"execution(* com.sky.mapper.*.*(..)) \u0026\u0026 @annotation(com.sky.mapper.AutoFill)\") public void autoFillPointCut(){} // 前置通知，在目标方法执行前执行，因为目标方法是插入数据库，所以需要在插入前为数据赋值 // 调用autoFillPointCut()这个方法可以获取到需要在哪里切入 @Before(\"autoFillPointCut()\") public void autoFill(JoinPoint joinPoint){ log.info(\"公共字段填充\"); // 1、获取到要操作的数据库类型，在注解中获取 // 1.1、先获取签名，并且强制转换为方法签名 MethodSignature signature = (MethodSignature)joinPoint.getSignature(); // 1.2、通过签名获取到注解 AutoFill annotation = signature.getMethod().getAnnotation(AutoFill.class); // 1.3、通过注解里边的value值，来判断操作数据库的类型 OperationType operationType = annotation.value(); // 2、获取到被拦截方法的实体对象，方法的参数 // 这样子获得了所有参数，做一个约定，如果想要实现自动填充，必须给到第一个参数是实体 Object[] args = joinPoint.getArgs(); if(args == null || args.length == 0){ return; } Object entity = args[0]; // 3、准备赋值的数据 // 赋值的时间 LocalDateTime now = LocalDateTime.now(); Long currentId = BaseContext.getCurrentId(); // 4、为对应的属性赋值 if(operationType == OperationType.INSERT){ // 插入操作，有四个数据都需要更改（创建人，创建时间，更新人，更新时间）用实体里的方法 try { // 反射的第一步都是拿到Class Method setCreateTime = entity.getClass().getDeclaredMethod(AutoFillConstant.SET_CREATE_TIME); Method setCreateUser = entity.getClass().getDeclaredMethod(AutoFillConstant.SET_CREATE_USER); Method setUpdateUser = entity.getClass().getDeclaredMethod(AutoFillConstant.SET_UPDATE_USER); Method setUpdateTime = entity.getClass().getDeclaredMethod(AutoFillConstant.SET_UPDATE_TIME); setCreateTime.invoke(entity,now); setCreateUser.invoke(entity,currentId); setUpdateTime.invoke(entity,now); setUpdateUser.invoke(entity,currentId); } catch (Exception e) { throw new RuntimeException(e); } }else if (operationType == OperationType.UPDATE){ try { Method setUpdateTime = entity.getClass().getDeclaredMethod(AutoFillConstant.SET_UPDATE_TIME); Method setUpdateUser = entity.getClass().getDeclaredMethod(AutoFillConstant.SET_UPDATE_USER); setUpdateTime.invoke(entity,now); setUpdateUser.invoke(entity,currentId); } catch (Exception e) { throw new RuntimeException(e); } } } } 这里遇到的错误\n@Pointcut(\"execution(* com.sky.mapper.*.*(..)) \u0026\u0026 @annotation(com.sky.mapper.AutoFill)\") 实际上应该是：\n@Pointcut(\"execution(* com.sky.mapper.*.*(..)) \u0026\u0026 @annotation(com.sky.annotation.AutoFill)\") 原因是@annotation里边写的是注解的全类名，这个全类名的作用是指定注解，如果方法上有这个注解，那么就会生效\n还有一个错误，使用getDeclaredMethod方法的时候，需要传递两个参数，一个是方法的名字，还有一个是方法包括参数的类\nMethod setCreateTime = entity.getClass().getDeclaredMethod(AutoFillConstant.SET_CREATE_TIME,LocalDateTime.class); Method setCreateUser = entity.getClass().getDeclaredMethod(AutoFillConstant.SET_CREATE_USER,Long.class); Method setUpdateUser = entity.getClass().getDeclaredMethod(AutoFillConstant.SET_UPDATE_USER,Long.class); Method setUpdateTime = entity.getClass().getDeclaredMethod(AutoFillConstant.SET_UPDATE_TIME,LocalDateTime.class); 在Mapper 的方法上加入 AutoFill注解 新增菜品 @Configuration\n配置类的注解，有了这个注解，在项目启动的时候，这个类就会被创建\n涉及到多表操作的时候，需要保证事物的一致性，需要加上@Transactional注解，保证事物要么都成功，要么都失败\n涉及的两个重要SQL操作知识\n1、新增口味的时候，用到的一次插入多条数据，使用foreach遍历\n\u003cinsert id=\"insert\"\u003e insert into dish_flavor(dish_id,name,value) values \u003cforeach collection=\"flavors\" item=\"flavor\" separator=\",\"\u003e (#{dishId},#{name},#{value}) \u003c/foreach\u003e \u003c/insert\u003e 注意这里写的代码是有问题的，原因是使用item遍历每个对象后需要flavor.dishId这样子来访问\n\u003cinsert id=\"insert\"\u003e insert into dish_flavor(dish_id,name,value) values \u003cforeach collection=\"flavors\" item=\"flavor\" separator=\",\"\u003e (#{flavor.dishId},#{flavor.name},#{flavor.value}) \u003c/foreach\u003e \u003c/insert\u003e 2、新增菜品的时候，需要把自增后的id带回来，用到的是useGeneratedKeys=“true” keyProperty=“id”\n\u003cinsert id=\"insert\" useGeneratedKeys=\"true\" keyProperty=\"id\" \u003e insert into dish(name,category_id,price,image,description,status,create_time,update_time,create_user,update_user) values (#{name},#{categoryId},#{price},#{image},#{description},#{status},#{createTime},#{updateTime},#{createUser},#{updateUser}) \u003c/insert\u003e DTO数据是前端传给后端\nVO数据是后端传给前端\n文件上传 首先需要在yml文件中配置\nalioss: endpoint: ${sky.alioss.endpoint} access-key-id: ${sky.alioss.access-key-id} access-key-secret: ${sky.alioss.access-key-secret} bucket-name: ${sky.alioss.bucket-name} endpoint是连接到那个地方的oss-cn-beijing.aliyuncs.com\naccess-key-id和secret是配置的账号和密码\nbucket-name是创建的bucket的名字\n${sky.alioss.endpoint} 之所以写成这样是因为，开发环境和生产环境的分离，Spring Boot 在启动时会按顺序加载所有配置文件（如 application.yml、bootstrap.yml、Profile-specific 文件等），并将所有属性合并到 Environment 对象中。这意味着：\n跨文件属性可见：不同文件中的属性会被集中管理。 优先级规则：后加载的配置会覆盖先加载的同名属性（如 Profile-specific 配置 \u003e application.yml \u003e bootstrap.yml）。 当配置中使用 ${key} 占位符时，Spring Boot 会从 Environment 中查找匹配的属性值，无论该属性来自哪个文件\nconfigure文件\n@Configuration @Slf4j public class OssConfiguration { // AliOssProperties是用来接收配置yml里边的信息AliOssUtil是阿里云oss的工具类 @Bean @ConditionalOnMissingBean public AliOssUtil aliOssUtil (AliOssProperties aliOssProperties){ log.info(\"开始创建阿里云工具类\"); return new AliOssUtil(aliOssProperties.getEndpoint(), aliOssProperties.getAccessKeyId(), aliOssProperties.getAccessKeySecret(), aliOssProperties.getBucketName()); } } 在 Spring 框架中，**@Configuration** 注解用于标记一个类为配置类，它的核心作用是定义和组装 Spring 容器中的 Bean，替代传统的 XML 配置方式\n通过结合 @Bean 注解，配置类中的方法可以显式声明 Bean，Spring 容器会将这些方法返回的对象注册为 Bean。\n虽然 @Configuration 也被 @ComponentScan 扫描，但它有特殊增强：\n普通 @Component 类中的 @Bean 方法不会被代理，多次调用会产生新实例。 @Configuration 类中的 @Bean 方法会被代理，确保单例。 Controller开发\n// 通用的Controller @RestController @RequestMapping(\"admin/common\") @Api(tags = \"通用接口\") @Slf4j public class CommonController { @Autowired AliOssUtil aliOssUtil; @PostMapping(\"/upload\") @ApiOperation(\"文件上传\") public Result\u003cString\u003e upload(MultipartFile file) { // 需要得到上传文件的名字，uuid拼接上后缀名 String originalFilename = file.getOriginalFilename(); String substring = originalFilename.substring(originalFilename.lastIndexOf(\".\")); String name = UUID.randomUUID()+substring; // 需要一个阿里云的工具类，在上边用Autowired引入 try { String url = aliOssUtil.upload(file.getBytes(), name); return Result.success(url); } catch (IOException e) { log.error(\"报错信息是{}\",e.getMessage()); } return Result.error(MessageConstant.UPLOAD_FAILED); } } 工具类的开发\npublic class AliOssUtil { private String endpoint; private String accessKeyId; private String accessKeySecret; private String bucketName; /** * 文件上传 * * @param bytes * @param objectName * @return */ public String upload(byte[] bytes, String objectName) { // 创建OSSClient实例。 OSS ossClient = new OSSClientBuilder().build(endpoint, accessKeyId, accessKeySecret); try { // 创建PutObject请求。 ossClient.putObject(bucketName, objectName, new ByteArrayInputStream(bytes)); } catch (OSSException oe) { System.out.println(\"Caught an OSSException, which means your request made it to OSS, \" + \"but was rejected with an error response for some reason.\"); System.out.println(\"Error Message:\" + oe.getErrorMessage()); System.out.println(\"Error Code:\" + oe.getErrorCode()); System.out.println(\"Request ID:\" + oe.getRequestId()); System.out.println(\"Host ID:\" + oe.getHostId()); } catch (ClientException ce) { System.out.println(\"Caught an ClientException, which means the client encountered \" + \"a serious internal problem while trying to communicate with OSS, \" + \"such as not being able to access the network.\"); System.out.println(\"Error Message:\" + ce.getMessage()); } finally { if (ossClient != null) { ossClient.shutdown(); } } //文件访问路径规则 https://BucketName.Endpoint/ObjectName StringBuilder stringBuilder = new StringBuilder(\"https://\"); stringBuilder .append(bucketName) .append(\".\") .append(endpoint) .append(\"/\") .append(objectName); log.info(\"文件上传到:{}\", stringBuilder.toString()); return stringBuilder.toString(); } } Query请求方式传参是在地址栏上?key=value的方式，不需要用@RequestBody注解\n当对名字进行查询的时候，习惯使用like concat (’%’,#{name},’%’) 拼接一个通配符\n当想要一次性删除多个的时候，前端传过来的参数是1,2,3这种类型，此时可以使用@RequestParam List ids来接收参数，Spring框架会自动把逗号分隔\n操作一张表，对应一个Mapper\n使用删除的时候，可以用where in 来一次性多删除几个数据\n修改信息不需要把VO数据返回回来，因为浏览器会重新发一个查询操作，不是通过数据返回来来更新页面的\n","wordCount":"2992","inLanguage":"zh","image":"https://wqnm1gb.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E","datePublished":"2025-03-20T11:06:04+08:00","dateModified":"2025-03-20T11:06:04+08:00","author":{"@type":"Person","name":"冷漠三狗子丶"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://wqnm1gb.github.io/posts/day03%E8%8F%9C%E5%93%81%E7%AE%A1%E7%90%86/"},"publisher":{"@type":"Organization","name":"三狗子的博客","logo":{"@type":"ImageObject","url":"https://wqnm1gb.github.io/images/favicon.png"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://wqnm1gb.github.io/ accesskey=h title="主页 (Alt + H)"><img src=https://wqnm1gb.github.io/apple-touch-icon.png alt aria-label=logo height=35>主页</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://wqnm1gb.github.io/ title=三狗子的博客><span>首页</span></a></li><li><a href=https://wqnm1gb.github.io/archives/ title=归档><span>归档</span></a></li><li><a href=https://wqnm1gb.github.io/categories/ title=Categories><span>分类</span></a></li><li><a href=https://wqnm1gb.github.io/tags/ title=Tags><span>标签</span></a></li><li><a href=https://wqnm1gb.github.io/search/ title=搜索><span>搜索</span></a></li><li><a href=https://wqnm1gb.github.io/about/ title=关于><span>关于</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://wqnm1gb.github.io/>主页</a>&nbsp;»&nbsp;<a href=https://wqnm1gb.github.io/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Day03 菜品管理</h1><div class=post-meta><span title='2025-03-20 11:06:04 +0800 +0800'>三月 20, 2025</span>&nbsp;·&nbsp;6 分钟&nbsp;·&nbsp;2992 字&nbsp;·&nbsp;冷漠三狗子丶</div></header><div class=post-content><h1 id=公共字段自动填充>公共字段自动填充<a hidden class=anchor aria-hidden=true href=#公共字段自动填充>#</a></h1><p>AOP切面编程</p><table><thead><tr><th style=text-align:left><strong>序号</strong></th><th style=text-align:left><strong>字段名</strong></th><th style=text-align:left><strong>含义</strong></th><th style=text-align:left><strong>数据类型</strong></th><th style=text-align:left><strong>操作类型</strong></th></tr></thead><tbody><tr><td style=text-align:left>1</td><td style=text-align:left>create_time</td><td style=text-align:left>创建时间</td><td style=text-align:left>datetime</td><td style=text-align:left>insert</td></tr><tr><td style=text-align:left>2</td><td style=text-align:left>create_user</td><td style=text-align:left>创建人id</td><td style=text-align:left>bigint</td><td style=text-align:left></td></tr><tr><td style=text-align:left>3</td><td style=text-align:left>update_time</td><td style=text-align:left>修改时间</td><td style=text-align:left>datetime</td><td style=text-align:left>insert、update</td></tr><tr><td style=text-align:left>4</td><td style=text-align:left>update_user</td><td style=text-align:left>修改人id</td><td style=text-align:left>bigint</td><td style=text-align:left></td></tr></tbody></table><p>• 自定义注解AutoFill，用于标识需要进行公共字段自动填充的方法</p><p>• 自定义切面类AutoFillAspect，统一拦截加入了AutoFill 注解的方法，通过反射为公共字段赋值</p><p>• 在Mapper 的方法上加入AutoFill注解</p><p>技术点：枚举、注解、AOP、反射</p><h2 id=开发步骤>开发步骤<a hidden class=anchor aria-hidden=true href=#开发步骤>#</a></h2><h3 id=自定义注解-autofill用于标识需要进行公共字段自动填充的方法>自定义注解 AutoFill，用于标识需要进行公共字段自动填充的方法<a hidden class=anchor aria-hidden=true href=#自定义注解-autofill用于标识需要进行公共字段自动填充的方法>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 自定义注解AutoFill</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Target</span><span class=p>(</span><span class=n>ElementType</span><span class=p>.</span><span class=na>METHOD</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Retention</span><span class=p>(</span><span class=n>RetentionPolicy</span><span class=p>.</span><span class=na>RUNTIME</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=nd>@interface</span><span class=w> </span><span class=n>AutoFill</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>OperationType</span><span class=w> </span><span class=nf>value</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>这里边为什么是OperationType value();</p><p>这其实是注解的规定，自定义注解的格式如下</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=nd>@interface</span><span class=w> </span><span class=n>注解名称</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>属性类型</span><span class=w> </span><span class=nf>属性名</span><span class=p>()</span><span class=w> </span><span class=k>default</span><span class=w> </span><span class=n>默认值</span><span class=w> </span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>在注解中定义的元素实际上是方法的声明，不是直接的字段（即变量）。注解的元素定义的形式很像方法签名，所有元素（即注解里的成员）都是方法，它们没有方法体，只声明返回值类型和方法名。</p><ul><li>在你的例子中，<code>&lt;font style="color:rgb(0, 0, 0);">value()&lt;/font></code> 声明的是一个返回类型为 <code>&lt;font style="color:rgb(0, 0, 0);">OperationType&lt;/font></code> 的方法。你在使用注解时，通过 <code>&lt;font style="color:rgb(0, 0, 0);">()&lt;/font></code> 来传递值给这个方法。</li><li>比如 <code>&lt;font style="color:rgb(0, 0, 0);">@AutoFill(OperationType.UPDATE)&lt;/font></code>，就是在调用 <code>&lt;font style="color:rgb(0, 0, 0);">value()&lt;/font></code> 方法，并传递了 <code>&lt;font style="color:rgb(0, 0, 0);">OperationType.UPDATE&lt;/font></code> 作为返回</li></ul><h3 id=自定义切面类-autofillaspect统一拦截加入了-autofill-注解的方法通过反射为公共字段赋值>自定义切面类 AutoFillAspect，统一拦截加入了 AutoFill 注解的方法，通过反射为公共字段赋值<a hidden class=anchor aria-hidden=true href=#自定义切面类-autofillaspect统一拦截加入了-autofill-注解的方法通过反射为公共字段赋值>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Aspect</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Component</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Slf4j</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>AutoFillAspect</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 自定义切面，统一为公共字段赋值</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 该注解的作用是将公共的切点表达式抽取出来，需要用到时引用该切点表达式即可</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Pointcut</span><span class=p>(</span><span class=s>&#34;execution(* com.sky.mapper.*.*(..)) &amp;&amp; @annotation(com.sky.mapper.AutoFill)&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>autoFillPointCut</span><span class=p>(){}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 前置通知，在目标方法执行前执行，因为目标方法是插入数据库，所以需要在插入前为数据赋值</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 调用autoFillPointCut()这个方法可以获取到需要在哪里切入</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Before</span><span class=p>(</span><span class=s>&#34;autoFillPointCut()&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>autoFill</span><span class=p>(</span><span class=n>JoinPoint</span><span class=w> </span><span class=n>joinPoint</span><span class=p>){</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>log</span><span class=p>.</span><span class=na>info</span><span class=p>(</span><span class=s>&#34;公共字段填充&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 1、获取到要操作的数据库类型，在注解中获取</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 1.1、先获取签名，并且强制转换为方法签名</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>MethodSignature</span><span class=w> </span><span class=n>signature</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>MethodSignature</span><span class=p>)</span><span class=n>joinPoint</span><span class=p>.</span><span class=na>getSignature</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 1.2、通过签名获取到注解</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>AutoFill</span><span class=w> </span><span class=n>annotation</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>signature</span><span class=p>.</span><span class=na>getMethod</span><span class=p>().</span><span class=na>getAnnotation</span><span class=p>(</span><span class=n>AutoFill</span><span class=p>.</span><span class=na>class</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 1.3、通过注解里边的value值，来判断操作数据库的类型</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>OperationType</span><span class=w> </span><span class=n>operationType</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>annotation</span><span class=p>.</span><span class=na>value</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 2、获取到被拦截方法的实体对象，方法的参数</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 这样子获得了所有参数，做一个约定，如果想要实现自动填充，必须给到第一个参数是实体</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Object</span><span class=o>[]</span><span class=w> </span><span class=n>args</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>joinPoint</span><span class=p>.</span><span class=na>getArgs</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=p>(</span><span class=n>args</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=n>args</span><span class=p>.</span><span class=na>length</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>0</span><span class=p>){</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Object</span><span class=w> </span><span class=n>entity</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>args</span><span class=o>[</span><span class=n>0</span><span class=o>]</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 3、准备赋值的数据</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 赋值的时间</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>LocalDateTime</span><span class=w> </span><span class=n>now</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>LocalDateTime</span><span class=p>.</span><span class=na>now</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Long</span><span class=w> </span><span class=n>currentId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>BaseContext</span><span class=p>.</span><span class=na>getCurrentId</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 4、为对应的属性赋值</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=p>(</span><span class=n>operationType</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>OperationType</span><span class=p>.</span><span class=na>INSERT</span><span class=p>){</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 插入操作，有四个数据都需要更改（创建人，创建时间，更新人，更新时间）用实体里的方法</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 反射的第一步都是拿到Class</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>Method</span><span class=w> </span><span class=n>setCreateTime</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>entity</span><span class=p>.</span><span class=na>getClass</span><span class=p>().</span><span class=na>getDeclaredMethod</span><span class=p>(</span><span class=n>AutoFillConstant</span><span class=p>.</span><span class=na>SET_CREATE_TIME</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>Method</span><span class=w> </span><span class=n>setCreateUser</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>entity</span><span class=p>.</span><span class=na>getClass</span><span class=p>().</span><span class=na>getDeclaredMethod</span><span class=p>(</span><span class=n>AutoFillConstant</span><span class=p>.</span><span class=na>SET_CREATE_USER</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>Method</span><span class=w> </span><span class=n>setUpdateUser</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>entity</span><span class=p>.</span><span class=na>getClass</span><span class=p>().</span><span class=na>getDeclaredMethod</span><span class=p>(</span><span class=n>AutoFillConstant</span><span class=p>.</span><span class=na>SET_UPDATE_USER</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>Method</span><span class=w> </span><span class=n>setUpdateTime</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>entity</span><span class=p>.</span><span class=na>getClass</span><span class=p>().</span><span class=na>getDeclaredMethod</span><span class=p>(</span><span class=n>AutoFillConstant</span><span class=p>.</span><span class=na>SET_UPDATE_TIME</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>setCreateTime</span><span class=p>.</span><span class=na>invoke</span><span class=p>(</span><span class=n>entity</span><span class=p>,</span><span class=n>now</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>setCreateUser</span><span class=p>.</span><span class=na>invoke</span><span class=p>(</span><span class=n>entity</span><span class=p>,</span><span class=n>currentId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>setUpdateTime</span><span class=p>.</span><span class=na>invoke</span><span class=p>(</span><span class=n>entity</span><span class=p>,</span><span class=n>now</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>setUpdateUser</span><span class=p>.</span><span class=na>invoke</span><span class=p>(</span><span class=n>entity</span><span class=p>,</span><span class=n>currentId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Exception</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>RuntimeException</span><span class=p>(</span><span class=n>e</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=k>else</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>operationType</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>OperationType</span><span class=p>.</span><span class=na>UPDATE</span><span class=p>){</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>Method</span><span class=w> </span><span class=n>setUpdateTime</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>entity</span><span class=p>.</span><span class=na>getClass</span><span class=p>().</span><span class=na>getDeclaredMethod</span><span class=p>(</span><span class=n>AutoFillConstant</span><span class=p>.</span><span class=na>SET_UPDATE_TIME</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>Method</span><span class=w> </span><span class=n>setUpdateUser</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>entity</span><span class=p>.</span><span class=na>getClass</span><span class=p>().</span><span class=na>getDeclaredMethod</span><span class=p>(</span><span class=n>AutoFillConstant</span><span class=p>.</span><span class=na>SET_UPDATE_USER</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>setUpdateTime</span><span class=p>.</span><span class=na>invoke</span><span class=p>(</span><span class=n>entity</span><span class=p>,</span><span class=n>now</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>setUpdateUser</span><span class=p>.</span><span class=na>invoke</span><span class=p>(</span><span class=n>entity</span><span class=p>,</span><span class=n>currentId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Exception</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>RuntimeException</span><span class=p>(</span><span class=n>e</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>这里遇到的错误</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Pointcut</span><span class=p>(</span><span class=s>&#34;execution(* com.sky.mapper.*.*(..)) &amp;&amp; @annotation(com.sky.mapper.AutoFill)&#34;</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></div><p>实际上应该是：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Pointcut</span><span class=p>(</span><span class=s>&#34;execution(* com.sky.mapper.*.*(..)) &amp;&amp; @annotation(com.sky.annotation.AutoFill)&#34;</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></div><p>原因是@annotation里边写的是注解的全类名，这个全类名的作用是指定注解，如果方法上有这个注解，那么就会生效</p><p><strong>还有一个错误，使用getDeclaredMethod方法的时候，需要传递两个参数，一个是方法的名字，还有一个是方法包括参数的类</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=w>                </span><span class=n>Method</span><span class=w> </span><span class=n>setCreateTime</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>entity</span><span class=p>.</span><span class=na>getClass</span><span class=p>().</span><span class=na>getDeclaredMethod</span><span class=p>(</span><span class=n>AutoFillConstant</span><span class=p>.</span><span class=na>SET_CREATE_TIME</span><span class=p>,</span><span class=n>LocalDateTime</span><span class=p>.</span><span class=na>class</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>Method</span><span class=w> </span><span class=n>setCreateUser</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>entity</span><span class=p>.</span><span class=na>getClass</span><span class=p>().</span><span class=na>getDeclaredMethod</span><span class=p>(</span><span class=n>AutoFillConstant</span><span class=p>.</span><span class=na>SET_CREATE_USER</span><span class=p>,</span><span class=n>Long</span><span class=p>.</span><span class=na>class</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>Method</span><span class=w> </span><span class=n>setUpdateUser</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>entity</span><span class=p>.</span><span class=na>getClass</span><span class=p>().</span><span class=na>getDeclaredMethod</span><span class=p>(</span><span class=n>AutoFillConstant</span><span class=p>.</span><span class=na>SET_UPDATE_USER</span><span class=p>,</span><span class=n>Long</span><span class=p>.</span><span class=na>class</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>Method</span><span class=w> </span><span class=n>setUpdateTime</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>entity</span><span class=p>.</span><span class=na>getClass</span><span class=p>().</span><span class=na>getDeclaredMethod</span><span class=p>(</span><span class=n>AutoFillConstant</span><span class=p>.</span><span class=na>SET_UPDATE_TIME</span><span class=p>,</span><span class=n>LocalDateTime</span><span class=p>.</span><span class=na>class</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></div><h3 id=在mapper-的方法上加入-autofill注解>在Mapper 的方法上加入 AutoFill注解<a hidden class=anchor aria-hidden=true href=#在mapper-的方法上加入-autofill注解>#</a></h3><h1 id=新增菜品>新增菜品<a hidden class=anchor aria-hidden=true href=#新增菜品>#</a></h1><p>@Configuration</p><p>配置类的注解，有了这个注解，在项目启动的时候，这个类就会被创建</p><p>涉及到多表操作的时候，需要保证事物的一致性，需要加上@Transactional注解，保证事物要么都成功，要么都失败</p><p>涉及的两个重要SQL操作知识</p><p>1、新增口味的时候，用到的一次插入多条数据，使用foreach遍历</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=w>    </span><span class=o>&lt;</span><span class=n>insert</span><span class=w> </span><span class=n>id</span><span class=o>=</span><span class=s>&#34;insert&#34;</span><span class=o>&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>insert</span><span class=w> </span><span class=n>into</span><span class=w> </span><span class=nf>dish_flavor</span><span class=p>(</span><span class=n>dish_id</span><span class=p>,</span><span class=n>name</span><span class=p>,</span><span class=n>value</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>values</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=o>&lt;</span><span class=n>foreach</span><span class=w> </span><span class=n>collection</span><span class=o>=</span><span class=s>&#34;flavors&#34;</span><span class=w> </span><span class=n>item</span><span class=o>=</span><span class=s>&#34;flavor&#34;</span><span class=w> </span><span class=n>separator</span><span class=o>=</span><span class=s>&#34;,&#34;</span><span class=o>&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>(</span><span class=err>#</span><span class=p>{</span><span class=n>dishId</span><span class=p>},</span><span class=err>#</span><span class=p>{</span><span class=n>name</span><span class=p>},</span><span class=err>#</span><span class=p>{</span><span class=n>value</span><span class=p>})</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=o>&lt;/</span><span class=n>foreach</span><span class=o>&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>&lt;/</span><span class=n>insert</span><span class=o>&gt;</span><span class=w>
</span></span></span></code></pre></div><p>注意这里写的代码是有问题的，原因是使用item遍历每个对象后需要flavor.dishId这样子来访问</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=w>    </span><span class=o>&lt;</span><span class=n>insert</span><span class=w> </span><span class=n>id</span><span class=o>=</span><span class=s>&#34;insert&#34;</span><span class=o>&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>insert</span><span class=w> </span><span class=n>into</span><span class=w> </span><span class=nf>dish_flavor</span><span class=p>(</span><span class=n>dish_id</span><span class=p>,</span><span class=n>name</span><span class=p>,</span><span class=n>value</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>values</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=o>&lt;</span><span class=n>foreach</span><span class=w> </span><span class=n>collection</span><span class=o>=</span><span class=s>&#34;flavors&#34;</span><span class=w> </span><span class=n>item</span><span class=o>=</span><span class=s>&#34;flavor&#34;</span><span class=w> </span><span class=n>separator</span><span class=o>=</span><span class=s>&#34;,&#34;</span><span class=o>&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>(</span><span class=err>#</span><span class=p>{</span><span class=n>flavor</span><span class=p>.</span><span class=na>dishId</span><span class=p>},</span><span class=err>#</span><span class=p>{</span><span class=n>flavor</span><span class=p>.</span><span class=na>name</span><span class=p>},</span><span class=err>#</span><span class=p>{</span><span class=n>flavor</span><span class=p>.</span><span class=na>value</span><span class=p>})</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=o>&lt;/</span><span class=n>foreach</span><span class=o>&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>&lt;/</span><span class=n>insert</span><span class=o>&gt;</span><span class=w>
</span></span></span></code></pre></div><p>2、新增菜品的时候，需要把自增后的id带回来，用到的是<strong>useGeneratedKeys=&ldquo;true&rdquo; keyProperty=&ldquo;id&rdquo;</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=o>&lt;</span><span class=n>insert</span><span class=w> </span><span class=n>id</span><span class=o>=</span><span class=s>&#34;insert&#34;</span><span class=w> </span><span class=n>useGeneratedKeys</span><span class=o>=</span><span class=s>&#34;true&#34;</span><span class=w> </span><span class=n>keyProperty</span><span class=o>=</span><span class=s>&#34;id&#34;</span><span class=w> </span><span class=o>&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>insert</span><span class=w> </span><span class=n>into</span><span class=w> </span><span class=nf>dish</span><span class=p>(</span><span class=n>name</span><span class=p>,</span><span class=n>category_id</span><span class=p>,</span><span class=n>price</span><span class=p>,</span><span class=n>image</span><span class=p>,</span><span class=n>description</span><span class=p>,</span><span class=n>status</span><span class=p>,</span><span class=n>create_time</span><span class=p>,</span><span class=n>update_time</span><span class=p>,</span><span class=n>create_user</span><span class=p>,</span><span class=n>update_user</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>values</span><span class=w> </span><span class=p>(</span><span class=err>#</span><span class=p>{</span><span class=n>name</span><span class=p>},</span><span class=err>#</span><span class=p>{</span><span class=n>categoryId</span><span class=p>},</span><span class=err>#</span><span class=p>{</span><span class=n>price</span><span class=p>},</span><span class=err>#</span><span class=p>{</span><span class=n>image</span><span class=p>},</span><span class=err>#</span><span class=p>{</span><span class=n>description</span><span class=p>},</span><span class=err>#</span><span class=p>{</span><span class=n>status</span><span class=p>},</span><span class=err>#</span><span class=p>{</span><span class=n>createTime</span><span class=p>},</span><span class=err>#</span><span class=p>{</span><span class=n>updateTime</span><span class=p>},</span><span class=err>#</span><span class=p>{</span><span class=n>createUser</span><span class=p>},</span><span class=err>#</span><span class=p>{</span><span class=n>updateUser</span><span class=p>})</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>&lt;/</span><span class=n>insert</span><span class=o>&gt;</span><span class=w>
</span></span></span></code></pre></div><p><strong>DTO数据是前端传给后端</strong></p><p><strong>VO数据是后端传给前端</strong></p><h1 id=文件上传>文件上传<a hidden class=anchor aria-hidden=true href=#文件上传>#</a></h1><p>首先需要在yml文件中配置</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=w>  </span><span class=n>alioss</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>endpoint</span><span class=p>:</span><span class=w> </span><span class=n>$</span><span class=p>{</span><span class=n>sky</span><span class=p>.</span><span class=na>alioss</span><span class=p>.</span><span class=na>endpoint</span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>access</span><span class=o>-</span><span class=n>key</span><span class=o>-</span><span class=n>id</span><span class=p>:</span><span class=w> </span><span class=n>$</span><span class=p>{</span><span class=n>sky</span><span class=p>.</span><span class=na>alioss</span><span class=p>.</span><span class=na>access</span><span class=o>-</span><span class=n>key</span><span class=o>-</span><span class=n>id</span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>access</span><span class=o>-</span><span class=n>key</span><span class=o>-</span><span class=n>secret</span><span class=p>:</span><span class=w> </span><span class=n>$</span><span class=p>{</span><span class=n>sky</span><span class=p>.</span><span class=na>alioss</span><span class=p>.</span><span class=na>access</span><span class=o>-</span><span class=n>key</span><span class=o>-</span><span class=n>secret</span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>bucket</span><span class=o>-</span><span class=n>name</span><span class=p>:</span><span class=w> </span><span class=n>$</span><span class=p>{</span><span class=n>sky</span><span class=p>.</span><span class=na>alioss</span><span class=p>.</span><span class=na>bucket</span><span class=o>-</span><span class=n>name</span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>endpoint是连接到那个地方的oss-cn-beijing.aliyuncs.com</p><p>access-key-id和secret是配置的账号和密码</p><p>bucket-name是创建的bucket的名字</p><hr><p><strong>${sky.alioss.endpoint} 之所以写成这样是因为</strong>，开发环境和生产环境的分离，Spring Boot 在启动时会按顺序加载所有配置文件（如 application.yml、bootstrap.yml、Profile-specific 文件等），并将所有属性合并到 <strong>Environment</strong> 对象中。这意味着：</p><ul><li><strong>跨文件属性可见</strong>：不同文件中的属性会被集中管理。</li><li><strong>优先级规则</strong>：后加载的配置会覆盖先加载的同名属性（如 Profile-specific 配置 > application.yml > bootstrap.yml）。</li></ul><p>当配置中使用 <code>&lt;font style="color:rgb(64, 64, 64);">${key}&lt;/font></code> 占位符时，Spring Boot 会从 <strong>Environment</strong> 中查找匹配的属性值，无论该属性来自哪个文件</p><p>configure文件</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Configuration</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Slf4j</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>OssConfiguration</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// AliOssProperties是用来接收配置yml里边的信息AliOssUtil是阿里云oss的工具类</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Bean</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@ConditionalOnMissingBean</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>AliOssUtil</span><span class=w> </span><span class=nf>aliOssUtil</span><span class=w> </span><span class=p>(</span><span class=n>AliOssProperties</span><span class=w> </span><span class=n>aliOssProperties</span><span class=p>){</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>log</span><span class=p>.</span><span class=na>info</span><span class=p>(</span><span class=s>&#34;开始创建阿里云工具类&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>AliOssUtil</span><span class=p>(</span><span class=n>aliOssProperties</span><span class=p>.</span><span class=na>getEndpoint</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>aliOssProperties</span><span class=p>.</span><span class=na>getAccessKeyId</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>aliOssProperties</span><span class=p>.</span><span class=na>getAccessKeySecret</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>aliOssProperties</span><span class=p>.</span><span class=na>getBucketName</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>在 Spring 框架中，<code>**&lt;font style="color:rgb(64, 64, 64);">@Configuration&lt;/font>**</code> 注解用于标记一个类为<strong>配置类</strong>，它的核心作用是<strong>定义和组装 Spring 容器中的 Bean</strong>，替代传统的 XML 配置方式</p><p>通过结合 <code>&lt;font style="color:rgb(64, 64, 64);">@Bean&lt;/font></code> 注解，配置类中的方法可以显式声明 Bean，Spring 容器会将这些方法返回的对象注册为 Bean。</p><p>虽然 <code>&lt;font style="color:rgb(64, 64, 64);">@Configuration&lt;/font></code> 也被 <code>&lt;font style="color:rgb(64, 64, 64);">@ComponentScan&lt;/font></code> 扫描，但它有<strong>特殊增强</strong>：</p><ul><li>普通 <code>&lt;font style="color:rgb(64, 64, 64);">@Component&lt;/font></code> 类中的 <code>&lt;font style="color:rgb(64, 64, 64);">@Bean&lt;/font></code> 方法<strong>不会</strong>被代理，多次调用会产生新实例。</li><li><code>&lt;font style="color:rgb(64, 64, 64);">@Configuration&lt;/font></code> 类中的 <code>&lt;font style="color:rgb(64, 64, 64);">@Bean&lt;/font></code> 方法会被代理，确保<strong>单例</strong>。</li></ul><p>Controller开发</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 通用的Controller</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@RestController</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@RequestMapping</span><span class=p>(</span><span class=s>&#34;admin/common&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Api</span><span class=p>(</span><span class=n>tags</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;通用接口&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Slf4j</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>CommonController</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Autowired</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>AliOssUtil</span><span class=w> </span><span class=n>aliOssUtil</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@PostMapping</span><span class=p>(</span><span class=s>&#34;/upload&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@ApiOperation</span><span class=p>(</span><span class=s>&#34;文件上传&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>Result</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span><span class=w> </span><span class=nf>upload</span><span class=p>(</span><span class=n>MultipartFile</span><span class=w> </span><span class=n>file</span><span class=p>)</span><span class=w>  </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 需要得到上传文件的名字，uuid拼接上后缀名</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>originalFilename</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>file</span><span class=p>.</span><span class=na>getOriginalFilename</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>substring</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>originalFilename</span><span class=p>.</span><span class=na>substring</span><span class=p>(</span><span class=n>originalFilename</span><span class=p>.</span><span class=na>lastIndexOf</span><span class=p>(</span><span class=s>&#34;.&#34;</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>UUID</span><span class=p>.</span><span class=na>randomUUID</span><span class=p>()</span><span class=o>+</span><span class=n>substring</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 需要一个阿里云的工具类，在上边用Autowired引入</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>String</span><span class=w> </span><span class=n>url</span><span class=w> </span><span class=o>=</span><span class=w>  </span><span class=n>aliOssUtil</span><span class=p>.</span><span class=na>upload</span><span class=p>(</span><span class=n>file</span><span class=p>.</span><span class=na>getBytes</span><span class=p>(),</span><span class=w> </span><span class=n>name</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>Result</span><span class=p>.</span><span class=na>success</span><span class=p>(</span><span class=n>url</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>IOException</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>           </span><span class=n>log</span><span class=p>.</span><span class=na>error</span><span class=p>(</span><span class=s>&#34;报错信息是{}&#34;</span><span class=p>,</span><span class=n>e</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>Result</span><span class=p>.</span><span class=na>error</span><span class=p>(</span><span class=n>MessageConstant</span><span class=p>.</span><span class=na>UPLOAD_FAILED</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p><strong>工具类的开发</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>AliOssUtil</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>endpoint</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>accessKeyId</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>accessKeySecret</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>bucketName</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 文件上传
</span></span></span><span class=line><span class=cl><span class=cm>     *
</span></span></span><span class=line><span class=cl><span class=cm>     * @param bytes
</span></span></span><span class=line><span class=cl><span class=cm>     * @param objectName
</span></span></span><span class=line><span class=cl><span class=cm>     * @return
</span></span></span><span class=line><span class=cl><span class=cm>     */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>upload</span><span class=p>(</span><span class=kt>byte</span><span class=o>[]</span><span class=w> </span><span class=n>bytes</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>objectName</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 创建OSSClient实例。</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>OSS</span><span class=w> </span><span class=n>ossClient</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>OSSClientBuilder</span><span class=p>().</span><span class=na>build</span><span class=p>(</span><span class=n>endpoint</span><span class=p>,</span><span class=w> </span><span class=n>accessKeyId</span><span class=p>,</span><span class=w> </span><span class=n>accessKeySecret</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 创建PutObject请求。</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>ossClient</span><span class=p>.</span><span class=na>putObject</span><span class=p>(</span><span class=n>bucketName</span><span class=p>,</span><span class=w> </span><span class=n>objectName</span><span class=p>,</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ByteArrayInputStream</span><span class=p>(</span><span class=n>bytes</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>OSSException</span><span class=w> </span><span class=n>oe</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;Caught an OSSException, which means your request made it to OSS, &#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=o>+</span><span class=w> </span><span class=s>&#34;but was rejected with an error response for some reason.&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;Error Message:&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>oe</span><span class=p>.</span><span class=na>getErrorMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;Error Code:&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>oe</span><span class=p>.</span><span class=na>getErrorCode</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;Request ID:&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>oe</span><span class=p>.</span><span class=na>getRequestId</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;Host ID:&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>oe</span><span class=p>.</span><span class=na>getHostId</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>ClientException</span><span class=w> </span><span class=n>ce</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;Caught an ClientException, which means the client encountered &#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=o>+</span><span class=w> </span><span class=s>&#34;a serious internal problem while trying to communicate with OSS, &#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=o>+</span><span class=w> </span><span class=s>&#34;such as not being able to access the network.&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;Error Message:&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>ce</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>finally</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>ossClient</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>ossClient</span><span class=p>.</span><span class=na>shutdown</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>//文件访问路径规则 https://BucketName.Endpoint/ObjectName</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>StringBuilder</span><span class=w> </span><span class=n>stringBuilder</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>StringBuilder</span><span class=p>(</span><span class=s>&#34;https://&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>stringBuilder</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=n>bucketName</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=s>&#34;.&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=n>endpoint</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=s>&#34;/&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=n>objectName</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>log</span><span class=p>.</span><span class=na>info</span><span class=p>(</span><span class=s>&#34;文件上传到:{}&#34;</span><span class=p>,</span><span class=w> </span><span class=n>stringBuilder</span><span class=p>.</span><span class=na>toString</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>stringBuilder</span><span class=p>.</span><span class=na>toString</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><hr><p>Query请求方式传参是在地址栏上?key=value的方式，不需要用@RequestBody注解</p><p>当对名字进行查询的时候，习惯使用like concat (&rsquo;%&rsquo;,#{name},&rsquo;%&rsquo;) 拼接一个通配符</p><p>当想要一次性删除多个的时候，前端传过来的参数是1,2,3这种类型，此时可以使用@RequestParam List ids来接收参数，Spring框架会自动把逗号分隔</p><p>操作一张表，对应一个Mapper</p><p>使用删除的时候，可以用where in 来一次性多删除几个数据</p><p><strong>修改信息不需要把VO数据返回回来，因为浏览器会重新发一个查询操作，不是通过数据返回来来更新页面的</strong></p></div><footer class=post-footer><ul class=post-tags><li><a href=https://wqnm1gb.github.io/tags/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96/>苍穹外卖</a></li></ul><nav class=paginav><a class=prev href=https://wqnm1gb.github.io/posts/day04%E5%A5%97%E9%A4%90%E7%AE%A1%E7%90%86/><span class=title>« 上一页</span><br><span>Day04 套餐管理</span>
</a><a class=next href=https://wqnm1gb.github.io/posts/day02%E5%91%98%E5%B7%A5%E7%AE%A1%E7%90%86/><span class=title>下一页 »</span><br><span>Day02 员工管理</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://wqnm1gb.github.io/>三狗子的博客</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="复制";function s(){t.innerHTML="已复制！",setTimeout(()=>{t.innerHTML="复制"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>