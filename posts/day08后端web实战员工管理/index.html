<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Day08 后端Web实战（员工管理） | 三狗子的博客</title>
<meta name=keywords content="java Web"><meta name=description content="多表关系
项目开发中，在进行数据库表结构设计时，会根据业务需求及业务模块之间的关系，分析并设计表结构。由于业务之间相互关联，所以各个表结构之间也存在着各种联系。"><meta name=author content="冷漠三狗子丶"><link rel=canonical href=https://wqnm1gb.github.io/posts/day08%E5%90%8E%E7%AB%AFweb%E5%AE%9E%E6%88%98%E5%91%98%E5%B7%A5%E7%AE%A1%E7%90%86/><link crossorigin=anonymous href=/assets/css/stylesheet.3d688279d829dc24da48acd11f9e33ebea2f39c035e899e1bf4297d8b7aa89b9.css integrity="sha256-PWiCedgp3CTaSKzRH54z6+ovOcA16Jnhv0KX2Leqibk=" rel="preload stylesheet" as=style><link rel=icon href=https://wqnm1gb.github.io/images/favicon.png><link rel=icon type=image/png sizes=16x16 href=https://wqnm1gb.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://wqnm1gb.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://wqnm1gb.github.io/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://wqnm1gb.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh href=https://wqnm1gb.github.io/posts/day08%E5%90%8E%E7%AB%AFweb%E5%AE%9E%E6%88%98%E5%91%98%E5%B7%A5%E7%AE%A1%E7%90%86/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&display=swap" rel=stylesheet><script type=text/javascript async src="https://cdn.bootcss.com/mathjax/2.7.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML">MathJax.Hub.Config({tex2jax:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["[[","]]"]],processEscapes:!0,processEnvironments:!0,skipTags:["script","noscript","style","textarea","pre"],TeX:{equationNumbers:{autoNumber:"AMS"},extensions:["AMSmath.js","AMSsymbols.js"]}}}),MathJax.Hub.Queue(function(){var e,t=MathJax.Hub.getAllJax();for(e=0;e<t.length;e+=1)t[e].SourceElement().parentNode.className+=" has-jax"})</script><style>code.has-jax{font:inherit;font-size:100%;background:inherit;border:inherit;color:#515151}</style><meta property="og:title" content="Day08 后端Web实战（员工管理）"><meta property="og:description" content="多表关系
项目开发中，在进行数据库表结构设计时，会根据业务需求及业务模块之间的关系，分析并设计表结构。由于业务之间相互关联，所以各个表结构之间也存在着各种联系。"><meta property="og:type" content="article"><meta property="og:url" content="https://wqnm1gb.github.io/posts/day08%E5%90%8E%E7%AB%AFweb%E5%AE%9E%E6%88%98%E5%91%98%E5%B7%A5%E7%AE%A1%E7%90%86/"><meta property="og:image" content="https://wqnm1gb.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-03-06T10:06:07+08:00"><meta property="article:modified_time" content="2025-03-06T10:06:07+08:00"><meta property="og:site_name" content="三狗子的博客"><meta property="fb:admins" content="your-facebook-admin-id"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://wqnm1gb.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Day08 后端Web实战（员工管理）","item":"https://wqnm1gb.github.io/posts/day08%E5%90%8E%E7%AB%AFweb%E5%AE%9E%E6%88%98%E5%91%98%E5%B7%A5%E7%AE%A1%E7%90%86/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Day08 后端Web实战（员工管理）","name":"Day08 后端Web实战（员工管理）","description":"多表关系 项目开发中，在进行数据库表结构设计时，会根据业务需求及业务模块之间的关系，分析并设计表结构。由于业务之间相互关联，所以各个表结构之间也存在着各种联系。\n","keywords":["java Web"],"articleBody":"多表关系 项目开发中，在进行数据库表结构设计时，会根据业务需求及业务模块之间的关系，分析并设计表结构。由于业务之间相互关联，所以各个表结构之间也存在着各种联系。\n多表关系分为三种： 一对一（多对一） 一对一 多对多 一对多 一对多的关系，只需要在多的一方增加一个字段，关联一的主键即可\n现象：部门数据可以直接删除，然而还有部分员工归属于该部门下，此时就出现了数据的不完整、不一致问题\n原因：目前上述的两张表，在数据库层面，并未建立关联，所以是无法保证数据的一致性和完整性的\n解决方案：外键约束\n创建表的时候增加外键约束：\n-- 创建表时指定 create table 表名( 字段名 数据类型, ... [constraint] [外键名称] foreign key (外键字段名) references 主表 (字段名)\t); 创建表后，修改表增加外键约束\n-- 建完表后，添加外键 alter table 表名 add constraint 外键名称 foreign key (外键字段名) references 主表(字段名); 物理外键：\n概念：使用 foreign key 定义外键关联另外一张表。\n缺点：\n影响增、删、改的效率（需要检查外键关系） 仅用于单节点数据库，不适用与分布式、集群场景 容易引发数据库的死锁问题，消耗性能 逻辑外键：\n概念：在业务层逻辑中，解决外键关联\n通过逻辑外键，就可以很方便的解决上述问题\n现在的项目中，基本不用物理外键了\n一对一 案例：用户 与 身份证信息 的关系\n关系：一对一关系，多用于单表拆分，将一张表的基础字段放在一张表中，其他字段放在另一张表中，以提升操作效率\n实现：在任意一方加入外键，关联另外一方的主键，并且设置外键为唯一的（UNIQUE）\n一对一的外键可以加在任意一方\n多对多 案例：学生 与 课程的关系\n关系：一个学生可以选修多门课程，一门课程也可以供多个学生选择\n实现：建立第三张中间表，中间表至少包含两个外键，分别关联两方主键\n案例 员工工作经历属于附表信息，他的createtime和updatetime是跟随主表（员工表）走的，所以可以不用这两个字段，但是id必须有的\n多表查询 多表查询：指从多张表中查询数据\n笛卡尔积：所有组合的结果\n要根据条件，消除无效的笛卡尔积\n查询的分类：\n连接查询 内连接：相当于查询A、B交集部分数据（内连接，查询到的是两个表的交集的信息）\n外连接\n- 左外连接：查询左表所有数据（包括两张表交集部分数据） - 右外连接：查询右表所有数据（包括两张表交集部分数据） 子查询 内连接 内连接查询的是两张表交集部分的数据。具体语法为：\n-- 1.隐式内连接 (常见) select 字段列表 from 表1 , 表2 where 连接条件 ...; -- 2.显式内连接 select 字段列表 from 表1 [inner] join 表2 on 连接条件 ... ; -- 1.给表起别名,来简化书写 select 字段列表 from 表1 [as] 别名1, 表2 [as] 别名2 where 条件 ...; inner（可以省略） join表示的是显式内连接，on表示的是联查的条件\n一旦为了表起别名，就不能用表名了，必须得用别名\n外连接 外连接分为左外连接和右外连接。具体语法为：\n-- 1.左外连接 (常见) select 字段列表 from 表1 left [outer] join 表2 on 连接条件 ...; -- 2.右外连接 select 字段列表 from 表1 right [outer] join 表2 on 连接条件 ...; 左外连接会包含左表的所有数据（用的比较多），右外连接会包含右表的所有数据\n左外连接和右外连接可以互相替换的\n对于外连接，常用的是左外连接，因为右外连接的SQL也可以改造成为左外连接（两张表调换个顺序）。\n子查询 介绍：SQL语句中嵌套select语句，称为嵌套查询，又称子查询。\n形式：select * from t1 where column1 = （select columnl from t2 ..）；\n说明：子查询外部的语句可以是insert / update / delete / select 的任何一个，最常见的是 select。\n分类：\n标量子查询：子查询返回的结果为单个值 列子查询：子查询返回的结果为一列 行子查询：子查询返回的结果为一行 select * from emp where (salary,job) = (select salary,job from emp where name = \"李忠\"); 注意这种写法，同时判断两个值相同，可以不写两个select语句（性能差），可以直接写一个括号来表示\n表子查询：子查询返回的结果多行多列 子查询的要点是，先对需求做拆分，明确具体的步骤，然后再逐步编写SQL语句。\n注意在SQL中出现的中文，请使用’‘包裹，不要使用\"\"\n一个表中的所有信息，可以是e.*\n员工列表查询 准备工作 1．准备数据库表emp、emp_expr\n2．准备实体类 Emp、EmpExpr\n3． 准备三层架构的基本代码结构：EmpController、EmpService/EmpServiceImpl、EmpMapper\n分页查询 limit 需要跟着两个参数 起始索引和每页展示记录数，起始索引从0开始\n需要专门定义一个分页结果的封装类来接收数据，一个用来封装总记录数，一个给定数据，在类上定义一个泛型，可以把这个泛型传递到定义的实例对象上\n原始方式 Controller层 // 这里只需要通过调用Service层来获取参数 @GetMapping public Result page(@RequestParam(defaultValue = \"1\") Integer page, @RequestParam(defaultValue = \"10\") Integer pageSize){ log.info(\"请求的参数{}{}\",page,pageSize); PageResult\u003cEmp\u003e pageResult = empService.page(page,pageSize); return Result.success(pageResult); } 注意，如果要指定不传入的时候的默认参数，需要使用的是**@RequestParam(defaultValue = “1”)这个参数，这是SpringBoot框架提供的**\nService层 public PageResult\u003cEmp\u003e page(Integer page, Integer pageSize) { Long total = empMapper.count(); Integer start = (page-1)*pageSize; List\u003cEmp\u003e list = empMapper.list(start,pageSize); PageResult\u003cEmp\u003e pageResult = new PageResult\u003c\u003e(total,list); return pageResult; } 注意page和start的换算，需要(page-1)*pageSize\nMapper层 @Mapper public interface EmpMapper { /** * 查询总共记录数 */ @Select(\"select count(*) from emp e left join dept d on e.dept_id = d.id\") public Long count(); /** * 查询结果列表 */ @Select(\"select e.*,d.name deptName from emp e left join dept d on e.dept_id = d.id limit #{start},#{size}\") public List\u003cEmp\u003e list(Integer start,Integer size); } PageHelper方法 Service层 @Override public PageResult\u003cEmp\u003e page(Integer page, Integer pageSize) { //1、设置分页参数 PageHelper.startPage(page,pageSize); // 2、调用Mapper方法 List\u003cEmp\u003e list = empMapper.list(); //3、解析结果并封装 Page\u003cEmp\u003e p = (Page\u003cEmp\u003e) list; return new PageResult\u003c\u003e(p.getTotal(),p.getResult()); } 第一步是设置参数，给PageHelper设置参数之后，执行的SQL语句才能返回正确的结果\n第二步是接收结果，通过调用Mapper层的函数实现接收结果\n第三步是解析结果，因为Page继承了List，所以可以用强转为Page，利用了多态，最后再调用Page里的方法，返回相应的参数\n为什么要强转为Page格式？\n因为直接输出list集合不可以，里边包括的数据不只有查询到的数据，还有其他的相关信息，所以需要强转为Page格式，通过里边的函数输出想要的信息\nPageHelper的实现机制 PageHelper会拦截SQL语句，会对这个SQL语句进行改造\n注意事项\n1、SQL语句结尾不要加分号（；），会导致拼接错误，实际上的改造就是拼接上了limit语句，如果加上了分号，就会拼接错误\n2、PageHelper只会对紧跟在其后的第一条SQL语句进行分页处理\n分页条件查询 @DateTimeFormat注解指定前端传递的日期格式\n@DateTimeFormat(pattern = “yyyy-MM-dd”) 用LocalDateTime来接收时间参数\n？不能出现在’‘之内，不然会被认为是字符串的一部分，对应于Mybatis中是在’‘之内，不能使用#{}，可以使用${}进行拼接，但是这种方法性能不好，所以更推荐采用concat函数，是MySQL中提供的字符串拼接函数\nxml需要同包同名\n@RequestParam注解的使用场景？\n• @RequestParam 接收请求参数，参数名不一致时\n• @RequestParam 设置请求参数的默认值\n@DateTimeFormat的使用场景？\n• 用于接收日期时间类型的参数，指定日期格式\n• @DateTimeFormat（pattern=“yyyy-MM-dd”）\n程序优化之把传递的参数指定一个对象接收 如果controller方法的参数较多，且未来可能继续增加，这会使得方法签名变得复杂难以维护，此时可以考虑将多个请求参数封装为一个对象。\n请求参数：/emps?name=张\u0026gender=1\u0026begin=2007-09-01\u0026end=2022-09-01\u0026page=1\u0026pagesize=10\n@Data public class EmpQueryParam { private Integer page = 1; private Integer pageSize = 10; private String name; private Integer gender; @DateTimeFormat(pattern = \"yyyy-MM-dd\") private LocalDate begin; @DateTimeFormat(pattern = \"yyyy-MM-dd\") private LocalDate end; } 注意：\n参数名一定要和对象的成员变量名相同，如果有赋初值的需要，可以直接在对象里写上他的初始值\n如果是传进来一个对象，SQL语句会自动去找对象里边的同名参数\n如果请求参数少，可以在Controller方法中定义一个一个的形参接收\n如果请求参数多，可以在Controller方法中定义一个对象接收\n程序优化之动态SQL \u003cmapper namespace=\"com.zzzzyj.mapper.EmpMapper\"\u003e \u003cselect id=\"list\" resultType=\"com.zzzzyj.pojo.Emp\"\u003e select e.*,d.name from emp e left join dept d on e.dept_id = d.id \u003cwhere\u003e -- 字符串要确定不是空串也不是null \u003cif test=\"name != null and name != ''\"\u003e e.name like concat('%',#{name},'%') \u003c/if\u003e \u003cif test=\"gender != null\"\u003e and e.gender = #{gender} \u003c/if\u003e \u003cif test=\"begin != null and end != null\"\u003e and e.entry_date between #{begin} and #{end} \u003c/if\u003e \u003c/where\u003e order by update_time desc \u003c/select\u003e \u003c/mapper\u003e 随着用户的输入或外部条件的变化而变化的SQL语句，我们称为 动态SQL。\n：判断条件是否成立，如果条件为true，则拼接SQL。\n：根据查询条件，来生成where关键字，并会自动去除条件前面多余的and或or。请注意，并不能删除and或者or，一定得要有and或or\n这里遇到的bug，怎么查都查不出来，重写了xml文件中的sql语句\n","wordCount":"3716","inLanguage":"zh","image":"https://wqnm1gb.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E","datePublished":"2025-03-06T10:06:07+08:00","dateModified":"2025-03-06T10:06:07+08:00","author":{"@type":"Person","name":"冷漠三狗子丶"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://wqnm1gb.github.io/posts/day08%E5%90%8E%E7%AB%AFweb%E5%AE%9E%E6%88%98%E5%91%98%E5%B7%A5%E7%AE%A1%E7%90%86/"},"publisher":{"@type":"Organization","name":"三狗子的博客","logo":{"@type":"ImageObject","url":"https://wqnm1gb.github.io/images/favicon.png"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://wqnm1gb.github.io/ accesskey=h title="主页 (Alt + H)"><img src=https://wqnm1gb.github.io/apple-touch-icon.png alt aria-label=logo height=35>主页</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://wqnm1gb.github.io/ title=三狗子的博客><span>首页</span></a></li><li><a href=https://wqnm1gb.github.io/archives/ title=归档><span>归档</span></a></li><li><a href=https://wqnm1gb.github.io/categories/ title=Categories><span>分类</span></a></li><li><a href=https://wqnm1gb.github.io/tags/ title=Tags><span>标签</span></a></li><li><a href=https://wqnm1gb.github.io/search/ title=搜索><span>搜索</span></a></li><li><a href=https://wqnm1gb.github.io/about/ title=关于><span>关于</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://wqnm1gb.github.io/>主页</a>&nbsp;»&nbsp;<a href=https://wqnm1gb.github.io/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Day08 后端Web实战（员工管理）</h1><div class=post-meta><span title='2025-03-06 10:06:07 +0800 +0800'>三月 6, 2025</span>&nbsp;·&nbsp;8 分钟&nbsp;·&nbsp;3716 字&nbsp;·&nbsp;冷漠三狗子丶</div></header><div class=post-content><h1 id=多表关系>多表关系<a hidden class=anchor aria-hidden=true href=#多表关系>#</a></h1><p>项目开发中，在进行数据库表结构设计时，会根据业务需求及业务模块之间的关系，分析并设计表结构。由于业务之间相互关联，所以各个表结构之间也存在着各种联系。</p><h2 id=多表关系分为三种>多表关系分为三种：<a hidden class=anchor aria-hidden=true href=#多表关系分为三种>#</a></h2><ul><li>一对一（多对一）</li><li>一对一</li><li>多对多</li></ul><h3 id=一对多>一对多<a hidden class=anchor aria-hidden=true href=#一对多>#</a></h3><p>一对多的关系，只需要在多的一方增加一个字段，关联一的主键即可</p><p>现象：部门数据可以直接删除，然而还有部分员工归属于该部门下，此时就出现了数据的不完整、不一致问题</p><p>原因：目前上述的两张表，在数据库层面，并未建立关联，所以是无法保证数据的一致性和完整性的</p><p>解决方案：外键约束</p><p>创建表的时候增加外键约束：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=o>--</span><span class=w> </span><span class=n>创建表时指定</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>create</span><span class=w> </span><span class=n>table</span><span class=w> </span><span class=nf>表名</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>字段名</span><span class=w> </span><span class=n>数据类型</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>[</span><span class=n>constraint</span><span class=o>]</span><span class=w> </span><span class=o>[</span><span class=n>外键名称</span><span class=o>]</span><span class=w> </span><span class=n>foreign</span><span class=w> </span><span class=nf>key</span><span class=w> </span><span class=p>(</span><span class=n>外键字段名</span><span class=p>)</span><span class=w> </span><span class=n>references</span><span class=w> </span><span class=nf>主表</span><span class=w> </span><span class=p>(</span><span class=n>字段名</span><span class=p>)</span><span class=w>	
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>);</span><span class=w>
</span></span></span></code></pre></div><p>创建表后，修改表增加外键约束</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=o>--</span><span class=w> </span><span class=n>建完表后</span><span class=err>，</span><span class=n>添加外键</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>alter</span><span class=w> </span><span class=n>table</span><span class=w> </span><span class=n>表名</span><span class=w> </span><span class=n>add</span><span class=w> </span><span class=n>constraint</span><span class=w> </span><span class=n>外键名称</span><span class=w> </span><span class=n>foreign</span><span class=w> </span><span class=nf>key</span><span class=w> </span><span class=p>(</span><span class=n>外键字段名</span><span class=p>)</span><span class=w> </span><span class=n>references</span><span class=w> </span><span class=nf>主表</span><span class=p>(</span><span class=n>字段名</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></div><p><strong>物理外键：</strong></p><p>概念：使用 foreign key 定义外键关联另外一张表。</p><p>缺点：</p><ol><li>影响增、删、改的效率（需要检查外键关系）</li><li>仅用于单节点数据库，不适用与分布式、集群场景</li><li>容易引发数据库的死锁问题，消耗性能</li></ol><p><strong>逻辑外键：</strong></p><p>概念：在业务层逻辑中，解决外键关联</p><p>通过逻辑外键，就可以很方便的解决上述问题</p><p>现在的项目中，基本不用物理外键了</p><h3 id=一对一>一对一<a hidden class=anchor aria-hidden=true href=#一对一>#</a></h3><p>案例：用户 与 身份证信息 的关系</p><p>关系：一对一关系，多用于单表拆分，将一张表的基础字段放在一张表中，其他字段放在另一张表中，以提升操作效率</p><p>实现：在任意一方加入外键，关联另外一方的主键，并且设置外键为唯一的（UNIQUE）</p><p>一对一的外键可以加在任意一方</p><h3 id=多对多>多对多<a hidden class=anchor aria-hidden=true href=#多对多>#</a></h3><p>案例：学生 与 课程的关系</p><p>关系：一个学生可以选修多门课程，一门课程也可以供多个学生选择</p><p>实现：建立第三张中间表，中间表至少包含两个外键，分别关联两方主键</p><p><img loading=lazy src=/images/Day08%e5%90%8e%e7%ab%afWeb%e5%ae%9e%e6%88%98%ef%bc%88%e5%91%98%e5%b7%a5%e7%ae%a1%e7%90%86%ef%bc%89.assets/1733794927881-b2907b06-926f-4b2f-ac06-2bd1e541db2e.png alt></p><h3 id=案例>案例<a hidden class=anchor aria-hidden=true href=#案例>#</a></h3><p>员工工作经历属于附表信息，他的createtime和updatetime是跟随主表（员工表）走的，所以可以不用这两个字段，但是id必须有的</p><h2 id=多表查询>多表查询<a hidden class=anchor aria-hidden=true href=#多表查询>#</a></h2><p>多表查询：指从多张表中查询数据</p><p>笛卡尔积：所有组合的结果</p><p>要根据条件，消除无效的笛卡尔积</p><p><strong>查询的分类：</strong></p><ul><li>连接查询</li></ul><p>内连接：相当于查询A、B交集部分数据（内连接，查询到的是两个表的交集的信息）</p><p>外连接</p><pre><code>- 左外连接：查询&lt;font style=&quot;background-color:#FBDE28;&quot;&gt;左表&lt;/font&gt;所有数据（包括两张表交集部分数据）
- 右外连接：查询&lt;font style=&quot;background-color:#FBDE28;&quot;&gt;右表&lt;/font&gt;所有数据（包括两张表交集部分数据）
</code></pre><p><img loading=lazy src=/images/Day08%e5%90%8e%e7%ab%afWeb%e5%ae%9e%e6%88%98%ef%bc%88%e5%91%98%e5%b7%a5%e7%ae%a1%e7%90%86%ef%bc%89.assets/1733811133863-6bad2529-3aa7-4233-8c07-40651c82d5a1.png alt></p><ul><li>子查询</li></ul><h3 id=内连接>内连接<a hidden class=anchor aria-hidden=true href=#内连接>#</a></h3><p>内连接查询的是两张表交集部分的数据。具体语法为：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=o>--</span><span class=w> </span><span class=n>1</span><span class=p>.</span><span class=na>隐式内连接</span><span class=w> </span><span class=p>(</span><span class=n>常见</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>select</span><span class=w> </span><span class=n>字段列表</span><span class=w> </span><span class=n>from</span><span class=w> </span><span class=n>表1</span><span class=w> </span><span class=p>,</span><span class=w> </span><span class=n>表2</span><span class=w> </span><span class=n>where</span><span class=w> </span><span class=n>连接条件</span><span class=w> </span><span class=p>...;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>--</span><span class=w> </span><span class=n>2</span><span class=p>.</span><span class=na>显式内连接</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>select</span><span class=w> </span><span class=n>字段列表</span><span class=w> </span><span class=n>from</span><span class=w> </span><span class=n>表1</span><span class=w> </span><span class=o>[</span><span class=n>inner</span><span class=o>]</span><span class=w> </span><span class=n>join</span><span class=w> </span><span class=n>表2</span><span class=w> </span><span class=n>on</span><span class=w> </span><span class=n>连接条件</span><span class=w> </span><span class=p>...</span><span class=w> </span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=o>--</span><span class=w> </span><span class=n>1</span><span class=p>.</span><span class=na>给表起别名</span><span class=p>,</span><span class=n>来简化书写</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>select</span><span class=w> </span><span class=n>字段列表</span><span class=w> </span><span class=n>from</span><span class=w> </span><span class=n>表1</span><span class=w> </span><span class=o>[</span><span class=n>as</span><span class=o>]</span><span class=w> </span><span class=n>别名1</span><span class=p>,</span><span class=w> </span><span class=n>表2</span><span class=w> </span><span class=o>[</span><span class=n>as</span><span class=o>]</span><span class=w> </span><span class=n>别名2</span><span class=w> </span><span class=n>where</span><span class=w> </span><span class=n>条件</span><span class=w> </span><span class=p>...;</span><span class=w>
</span></span></span></code></pre></div><p>inner（可以省略） join表示的是显式内连接，on表示的是联查的条件</p><p><strong>一旦为了表起别名，就不能用表名了，必须得用别名</strong></p><hr><h3 id=外连接>外连接<a hidden class=anchor aria-hidden=true href=#外连接>#</a></h3><p>外连接分为左外连接和右外连接。具体语法为：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=o>--</span><span class=w> </span><span class=n>1</span><span class=p>.</span><span class=na>左外连接</span><span class=w> </span><span class=p>(</span><span class=n>常见</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>select</span><span class=w> </span><span class=n>字段列表</span><span class=w> </span><span class=n>from</span><span class=w> </span><span class=n>表1</span><span class=w> </span><span class=n>left</span><span class=w> </span><span class=o>[</span><span class=n>outer</span><span class=o>]</span><span class=w> </span><span class=n>join</span><span class=w> </span><span class=n>表2</span><span class=w> </span><span class=n>on</span><span class=w> </span><span class=n>连接条件</span><span class=w> </span><span class=p>...;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>--</span><span class=w> </span><span class=n>2</span><span class=p>.</span><span class=na>右外连接</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>select</span><span class=w> </span><span class=n>字段列表</span><span class=w> </span><span class=n>from</span><span class=w> </span><span class=n>表1</span><span class=w> </span><span class=n>right</span><span class=w> </span><span class=o>[</span><span class=n>outer</span><span class=o>]</span><span class=w> </span><span class=n>join</span><span class=w> </span><span class=n>表2</span><span class=w> </span><span class=n>on</span><span class=w> </span><span class=n>连接条件</span><span class=w> </span><span class=p>...;</span><span class=w>
</span></span></span></code></pre></div><p>左外连接会包含左表的所有数据（用的比较多），右外连接会包含右表的所有数据</p><p>左外连接和右外连接可以互相替换的</p><p>对于外连接，常用的是左外连接，因为右外连接的SQL也可以改造成为左外连接（两张表调换个顺序）。</p><h3 id=子查询>子查询<a hidden class=anchor aria-hidden=true href=#子查询>#</a></h3><p>介绍：SQL语句中嵌套select语句，称为嵌套查询，又称子查询。</p><p>形式：select * from t1 where column1 = （select columnl from t2 ..）；</p><p>说明：子查询外部的语句可以是insert / update / delete / select 的任何一个，最常见的是 select。</p><p>分类：</p><ol><li>标量子查询：子查询返回的结果为单个值</li><li>列子查询：子查询返回的结果为一列</li><li>行子查询：子查询返回的结果为一行</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>from</span><span class=w> </span><span class=n>emp</span><span class=w> </span><span class=nf>where</span><span class=w> </span><span class=p>(</span><span class=n>salary</span><span class=p>,</span><span class=n>job</span><span class=p>)</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>select</span><span class=w> </span><span class=n>salary</span><span class=p>,</span><span class=n>job</span><span class=w> </span><span class=n>from</span><span class=w> </span><span class=n>emp</span><span class=w> </span><span class=n>where</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;李忠&#34;</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></div><p>注意这种写法，同时判断两个值相同，可以不写两个select语句（性能差），可以直接写一个括号来表示</p><ol start=4><li>表子查询：子查询返回的结果多行多列</li></ol><p>子查询的要点是，先对需求做拆分，明确具体的步骤，然后再逐步编写SQL语句。</p><p>注意在SQL中出现的中文，请使用&rsquo;&lsquo;包裹，不要使用""</p><p>一个表中的所有信息，可以是e.*</p><h1 id=员工列表查询>员工列表查询<a hidden class=anchor aria-hidden=true href=#员工列表查询>#</a></h1><h2 id=准备工作>准备工作<a hidden class=anchor aria-hidden=true href=#准备工作>#</a></h2><p>1．准备数据库表emp、emp_expr</p><p>2．准备实体类 Emp、EmpExpr</p><p>3． 准备三层架构的基本代码结构：EmpController、EmpService/EmpServiceImpl、EmpMapper</p><h2 id=分页查询>分页查询<a hidden class=anchor aria-hidden=true href=#分页查询>#</a></h2><p>limit 需要跟着两个参数 起始索引和每页展示记录数，起始索引从0开始</p><p><img loading=lazy src=/images/Day08%e5%90%8e%e7%ab%afWeb%e5%ae%9e%e6%88%98%ef%bc%88%e5%91%98%e5%b7%a5%e7%ae%a1%e7%90%86%ef%bc%89.assets/1733885401405-7709f488-b5fc-412b-9e46-f03614d99833.png alt></p><p>需要专门定义一个分页结果的封装类来接收数据，一个用来封装总记录数，一个给定数据，在类上定义一个泛型，可以把这个泛型传递到定义的实例对象上</p><h3 id=原始方式>原始方式<a hidden class=anchor aria-hidden=true href=#原始方式>#</a></h3><p><img loading=lazy src=/images/Day08%e5%90%8e%e7%ab%afWeb%e5%ae%9e%e6%88%98%ef%bc%88%e5%91%98%e5%b7%a5%e7%ae%a1%e7%90%86%ef%bc%89.assets/1733886804346-8742cb6b-6e94-439d-824a-1790e3e4cdaa.png alt></p><h3 id=controller层>Controller层<a hidden class=anchor aria-hidden=true href=#controller层>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=w>    </span><span class=c1>// 这里只需要通过调用Service层来获取参数</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@GetMapping</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>Result</span><span class=w> </span><span class=nf>page</span><span class=p>(</span><span class=nd>@RequestParam</span><span class=p>(</span><span class=n>defaultValue</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;1&#34;</span><span class=p>)</span><span class=w> </span><span class=n>Integer</span><span class=w> </span><span class=n>page</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                       </span><span class=nd>@RequestParam</span><span class=p>(</span><span class=n>defaultValue</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;10&#34;</span><span class=p>)</span><span class=w> </span><span class=n>Integer</span><span class=w> </span><span class=n>pageSize</span><span class=p>){</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>log</span><span class=p>.</span><span class=na>info</span><span class=p>(</span><span class=s>&#34;请求的参数{}{}&#34;</span><span class=p>,</span><span class=n>page</span><span class=p>,</span><span class=n>pageSize</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>PageResult</span><span class=o>&lt;</span><span class=n>Emp</span><span class=o>&gt;</span><span class=w> </span><span class=n>pageResult</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>empService</span><span class=p>.</span><span class=na>page</span><span class=p>(</span><span class=n>page</span><span class=p>,</span><span class=n>pageSize</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>Result</span><span class=p>.</span><span class=na>success</span><span class=p>(</span><span class=n>pageResult</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>注意，如果要指定不传入的时候的默认参数，需要使用的是**@RequestParam(defaultValue = &ldquo;1&rdquo;)<strong>这个参数，这是</strong>SpringBoot框架提供的**</p><h3 id=service层>Service层<a hidden class=anchor aria-hidden=true href=#service层>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>PageResult</span><span class=o>&lt;</span><span class=n>Emp</span><span class=o>&gt;</span><span class=w> </span><span class=nf>page</span><span class=p>(</span><span class=n>Integer</span><span class=w> </span><span class=n>page</span><span class=p>,</span><span class=w> </span><span class=n>Integer</span><span class=w> </span><span class=n>pageSize</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Long</span><span class=w> </span><span class=n>total</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>empMapper</span><span class=p>.</span><span class=na>count</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Integer</span><span class=w> </span><span class=n>start</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>page</span><span class=o>-</span><span class=n>1</span><span class=p>)</span><span class=o>*</span><span class=n>pageSize</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>List</span><span class=o>&lt;</span><span class=n>Emp</span><span class=o>&gt;</span><span class=w> </span><span class=n>list</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>empMapper</span><span class=p>.</span><span class=na>list</span><span class=p>(</span><span class=n>start</span><span class=p>,</span><span class=n>pageSize</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>PageResult</span><span class=o>&lt;</span><span class=n>Emp</span><span class=o>&gt;</span><span class=w> </span><span class=n>pageResult</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>PageResult</span><span class=o>&lt;&gt;</span><span class=p>(</span><span class=n>total</span><span class=p>,</span><span class=n>list</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>pageResult</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>注意page和start的换算，需要(page-1)*pageSize</p><h3 id=mapper层>Mapper层<a hidden class=anchor aria-hidden=true href=#mapper层>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Mapper</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>interface</span> <span class=nc>EmpMapper</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     *  查询总共记录数
</span></span></span><span class=line><span class=cl><span class=cm>     */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Select</span><span class=p>(</span><span class=s>&#34;select count(*) from emp e left join dept d on e.dept_id = d.id&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>Long</span><span class=w> </span><span class=nf>count</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 查询结果列表
</span></span></span><span class=line><span class=cl><span class=cm>     */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Select</span><span class=p>(</span><span class=s>&#34;select e.*,d.name deptName from emp e left join dept d on e.dept_id = d.id limit #{start},#{size}&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>List</span><span class=o>&lt;</span><span class=n>Emp</span><span class=o>&gt;</span><span class=w> </span><span class=nf>list</span><span class=p>(</span><span class=n>Integer</span><span class=w> </span><span class=n>start</span><span class=p>,</span><span class=n>Integer</span><span class=w> </span><span class=n>size</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><h3 id=pagehelper方法>PageHelper方法<a hidden class=anchor aria-hidden=true href=#pagehelper方法>#</a></h3><h3 id=service层-1>Service层<a hidden class=anchor aria-hidden=true href=#service层-1>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>PageResult</span><span class=o>&lt;</span><span class=n>Emp</span><span class=o>&gt;</span><span class=w> </span><span class=nf>page</span><span class=p>(</span><span class=n>Integer</span><span class=w> </span><span class=n>page</span><span class=p>,</span><span class=w> </span><span class=n>Integer</span><span class=w> </span><span class=n>pageSize</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>//1、设置分页参数</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>PageHelper</span><span class=p>.</span><span class=na>startPage</span><span class=p>(</span><span class=n>page</span><span class=p>,</span><span class=n>pageSize</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 2、调用Mapper方法</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>List</span><span class=o>&lt;</span><span class=n>Emp</span><span class=o>&gt;</span><span class=w> </span><span class=n>list</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>empMapper</span><span class=p>.</span><span class=na>list</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>//3、解析结果并封装</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Page</span><span class=o>&lt;</span><span class=n>Emp</span><span class=o>&gt;</span><span class=w> </span><span class=n>p</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>Page</span><span class=o>&lt;</span><span class=n>Emp</span><span class=o>&gt;</span><span class=p>)</span><span class=w> </span><span class=n>list</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>PageResult</span><span class=o>&lt;&gt;</span><span class=p>(</span><span class=n>p</span><span class=p>.</span><span class=na>getTotal</span><span class=p>(),</span><span class=n>p</span><span class=p>.</span><span class=na>getResult</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>第一步是设置参数，给PageHelper设置参数之后，执行的SQL语句才能返回正确的结果</p><p>第二步是接收结果，通过调用Mapper层的函数实现接收结果</p><p>第三步是解析结果，因为Page继承了List，所以可以用强转为Page，利用了多态，最后再调用Page里的方法，返回相应的参数</p><p><strong>为什么要强转为Page格式？</strong></p><p>因为直接输出list集合不可以，里边包括的数据不只有查询到的数据，还有其他的相关信息，所以需要强转为Page格式，通过里边的函数输出想要的信息</p><p><img loading=lazy src=/images/Day08%e5%90%8e%e7%ab%afWeb%e5%ae%9e%e6%88%98%ef%bc%88%e5%91%98%e5%b7%a5%e7%ae%a1%e7%90%86%ef%bc%89.assets/1733966040785-2cbbb2c2-cf4e-4997-b5cf-008c04e43288.png alt></p><h3 id=pagehelper的实现机制>PageHelper的实现机制<a hidden class=anchor aria-hidden=true href=#pagehelper的实现机制>#</a></h3><p>PageHelper会拦截SQL语句，会对这个SQL语句进行改造</p><p><img loading=lazy src=/images/Day08%e5%90%8e%e7%ab%afWeb%e5%ae%9e%e6%88%98%ef%bc%88%e5%91%98%e5%b7%a5%e7%ae%a1%e7%90%86%ef%bc%89.assets/1733965598072-5351d49a-aa55-480e-b99a-2e153f096697.png alt></p><p><strong>注意事项</strong></p><p>1、SQL语句结尾不要加分号（；），会导致拼接错误，实际上的改造就是拼接上了limit语句，如果加上了分号，就会拼接错误</p><p>2、PageHelper只会对紧跟在其后的第一条SQL语句进行分页处理</p><p><img loading=lazy src=/images/Day08%e5%90%8e%e7%ab%afWeb%e5%ae%9e%e6%88%98%ef%bc%88%e5%91%98%e5%b7%a5%e7%ae%a1%e7%90%86%ef%bc%89.assets/1733965828024-1cba626a-8845-4a89-b0f5-9af9c3e9f07b.png alt></p><h2 id=分页条件查询>分页条件查询<a hidden class=anchor aria-hidden=true href=#分页条件查询>#</a></h2><p><img loading=lazy src=/images/Day08%e5%90%8e%e7%ab%afWeb%e5%ae%9e%e6%88%98%ef%bc%88%e5%91%98%e5%b7%a5%e7%ae%a1%e7%90%86%ef%bc%89.assets/1733967724637-ca066c97-a49b-4483-a114-42c72c9b71f2.png alt></p><p>@DateTimeFormat注解指定前端传递的日期格式</p><p>@DateTimeFormat(pattern = &ldquo;yyyy-MM-dd&rdquo;) 用LocalDateTime来接收时间参数</p><p>？不能出现在&rsquo;&lsquo;之内，不然会被认为是字符串的一部分，对应于Mybatis中是在&rsquo;&lsquo;之内，不能使用#{}，可以使用${}进行拼接，但是这种方法性能不好，所以更推荐采用<strong>concat函数，是MySQL中提供的字符串拼接函数</strong></p><p><img loading=lazy src=/images/Day08%e5%90%8e%e7%ab%afWeb%e5%ae%9e%e6%88%98%ef%bc%88%e5%91%98%e5%b7%a5%e7%ae%a1%e7%90%86%ef%bc%89.assets/1733970828329-0bd47092-05e8-4c00-b4e9-9acf58af549b.png alt></p><p>xml需要同包同名</p><p><strong>@RequestParam注解的使用场景？</strong></p><p>• @RequestParam 接收请求参数，参数名不一致时</p><p>• @RequestParam 设置请求参数的默认值</p><p><strong>@DateTimeFormat的使用场景？</strong></p><p>• 用于接收日期时间类型的参数，指定日期格式</p><p>• @DateTimeFormat（pattern=&ldquo;yyyy-MM-dd&rdquo;）</p><h3 id=程序优化之把传递的参数指定一个对象接收>程序优化之把传递的参数指定一个对象接收<a hidden class=anchor aria-hidden=true href=#程序优化之把传递的参数指定一个对象接收>#</a></h3><p>如果controller方法的参数较多，且未来可能继续增加，这会使得方法签名变得复杂难以维护，此时可以考虑将多个请求参数封装为一个对象。</p><p>请求参数：/emps?name=张&amp;gender=1&amp;begin=2007-09-01&amp;end=2022-09-01&amp;page=1&amp;pagesize=10</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>EmpQueryParam</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>Integer</span><span class=w> </span><span class=n>page</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>1</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>Integer</span><span class=w> </span><span class=n>pageSize</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>10</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>name</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>Integer</span><span class=w> </span><span class=n>gender</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@DateTimeFormat</span><span class=p>(</span><span class=n>pattern</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;yyyy-MM-dd&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>LocalDate</span><span class=w> </span><span class=n>begin</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@DateTimeFormat</span><span class=p>(</span><span class=n>pattern</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;yyyy-MM-dd&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>LocalDate</span><span class=w> </span><span class=n>end</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>注意：</p><p><strong>参数名一定要和对象的成员变量名相同，如果有赋初值的需要，可以直接在对象里写上他的初始值</strong></p><p><strong>如果是传进来一个对象，SQL语句会自动去找对象里边的同名参数</strong></p><p><strong>如果请求参数少，可以在Controller方法中定义一个一个的形参接收</strong></p><p><strong>如果请求参数多，可以在Controller方法中定义一个对象接收</strong></p><h3 id=程序优化之动态sql>程序优化之动态SQL<a hidden class=anchor aria-hidden=true href=#程序优化之动态sql>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=o>&lt;</span><span class=n>mapper</span><span class=w> </span><span class=n>namespace</span><span class=o>=</span><span class=s>&#34;com.zzzzyj.mapper.EmpMapper&#34;</span><span class=o>&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>&lt;</span><span class=n>select</span><span class=w> </span><span class=n>id</span><span class=o>=</span><span class=s>&#34;list&#34;</span><span class=w> </span><span class=n>resultType</span><span class=o>=</span><span class=s>&#34;com.zzzzyj.pojo.Emp&#34;</span><span class=o>&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>select</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=o>*</span><span class=p>,</span><span class=n>d</span><span class=p>.</span><span class=na>name</span><span class=w> </span><span class=n>from</span><span class=w> </span><span class=n>emp</span><span class=w> </span><span class=n>e</span><span class=w> </span><span class=n>left</span><span class=w> </span><span class=n>join</span><span class=w> </span><span class=n>dept</span><span class=w> </span><span class=n>d</span><span class=w> </span><span class=n>on</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=na>dept_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>d</span><span class=p>.</span><span class=na>id</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=o>&lt;</span><span class=n>where</span><span class=o>&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>--</span><span class=w>  </span><span class=n>字符串要确定不是空串也不是null</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=o>&lt;</span><span class=k>if</span><span class=w> </span><span class=n>test</span><span class=o>=</span><span class=s>&#34;name != null and name != &#39;&#39;&#34;</span><span class=o>&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>e</span><span class=p>.</span><span class=na>name</span><span class=w> </span><span class=n>like</span><span class=w> </span><span class=nf>concat</span><span class=p>(</span><span class=sc>&#39;%&#39;</span><span class=p>,</span><span class=err>#</span><span class=p>{</span><span class=n>name</span><span class=p>},</span><span class=sc>&#39;%&#39;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=o>&lt;/</span><span class=k>if</span><span class=o>&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=o>&lt;</span><span class=k>if</span><span class=w> </span><span class=n>test</span><span class=o>=</span><span class=s>&#34;gender != null&#34;</span><span class=o>&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                   </span><span class=n>and</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=na>gender</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=err>#</span><span class=p>{</span><span class=n>gender</span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=o>&lt;/</span><span class=k>if</span><span class=o>&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=o>&lt;</span><span class=k>if</span><span class=w> </span><span class=n>test</span><span class=o>=</span><span class=s>&#34;begin != null and end != null&#34;</span><span class=o>&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                   </span><span class=n>and</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=na>entry_date</span><span class=w> </span><span class=n>between</span><span class=w> </span><span class=err>#</span><span class=p>{</span><span class=n>begin</span><span class=p>}</span><span class=w> </span><span class=n>and</span><span class=w> </span><span class=err>#</span><span class=p>{</span><span class=n>end</span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=o>&lt;/</span><span class=k>if</span><span class=o>&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=o>&lt;/</span><span class=n>where</span><span class=o>&gt;</span><span class=w> </span><span class=n>order</span><span class=w> </span><span class=n>by</span><span class=w> </span><span class=n>update_time</span><span class=w> </span><span class=n>desc</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>&lt;/</span><span class=n>select</span><span class=o>&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>&lt;/</span><span class=n>mapper</span><span class=o>&gt;</span><span class=w>
</span></span></span></code></pre></div><p>随着<strong>用户的输入或外部条件的变化而变化</strong>的SQL语句，我们称为 动态SQL。</p><p>：判断条件是否成立，如果条件为true，则拼接SQL。</p><p>：根据查询条件，来生成where关键字，并会自动<strong>去除条件前面多余的and或or</strong>。请注意，并不能删除and或者or，一定得要有and或or</p><p></p><p>这里遇到的bug，怎么查都查不出来，重写了xml文件中的sql语句</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://wqnm1gb.github.io/tags/java-web/>Java Web</a></li></ul><nav class=paginav><a class=prev href=https://wqnm1gb.github.io/posts/day09%E5%90%8E%E7%AB%AFweb%E5%AE%9E%E6%88%98%E5%91%98%E5%B7%A5%E7%AE%A1%E7%90%86/><span class=title>« 上一页</span><br><span>Day09 后端Web实战（员工管理）</span>
</a><a class=next href=https://wqnm1gb.github.io/posts/day07%E5%90%8E%E7%AB%AFweb%E5%AE%9E%E6%88%98%E9%83%A8%E9%97%A8%E7%AE%A1%E7%90%86/><span class=title>下一页 »</span><br><span>Day07 后端Web实战（部门管理）</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://wqnm1gb.github.io/>三狗子的博客</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="复制";function s(){t.innerHTML="已复制！",setTimeout(()=>{t.innerHTML="复制"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>