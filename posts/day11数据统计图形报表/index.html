<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Day11 数据统计、图形报表 | 三狗子的博客</title>
<meta name=keywords content="苍穹外卖"><meta name=description content="Apache ECharts
Apache ECharts是一款基于JavaScript的数据可视化图表库，提供直观，生动，可交互，可个性化定制的数据可视化图表。
Echarts也称为数据可视化技术"><meta name=author content="冷漠三狗子丶"><link rel=canonical href=https://wqnm1gb.github.io/posts/day11%E6%95%B0%E6%8D%AE%E7%BB%9F%E8%AE%A1%E5%9B%BE%E5%BD%A2%E6%8A%A5%E8%A1%A8/><link crossorigin=anonymous href=/assets/css/stylesheet.3d688279d829dc24da48acd11f9e33ebea2f39c035e899e1bf4297d8b7aa89b9.css integrity="sha256-PWiCedgp3CTaSKzRH54z6+ovOcA16Jnhv0KX2Leqibk=" rel="preload stylesheet" as=style><link rel=icon href=https://wqnm1gb.github.io/images/favicon.png><link rel=icon type=image/png sizes=16x16 href=https://wqnm1gb.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://wqnm1gb.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://wqnm1gb.github.io/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://wqnm1gb.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh href=https://wqnm1gb.github.io/posts/day11%E6%95%B0%E6%8D%AE%E7%BB%9F%E8%AE%A1%E5%9B%BE%E5%BD%A2%E6%8A%A5%E8%A1%A8/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&display=swap" rel=stylesheet><script type=text/javascript async src="https://cdn.bootcss.com/mathjax/2.7.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML">MathJax.Hub.Config({tex2jax:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["[[","]]"]],processEscapes:!0,processEnvironments:!0,skipTags:["script","noscript","style","textarea","pre"],TeX:{equationNumbers:{autoNumber:"AMS"},extensions:["AMSmath.js","AMSsymbols.js"]}}}),MathJax.Hub.Queue(function(){var e,t=MathJax.Hub.getAllJax();for(e=0;e<t.length;e+=1)t[e].SourceElement().parentNode.className+=" has-jax"})</script><style>code.has-jax{font:inherit;font-size:100%;background:inherit;border:inherit;color:#515151}</style><meta property="og:title" content="Day11 数据统计、图形报表"><meta property="og:description" content="Apache ECharts
Apache ECharts是一款基于JavaScript的数据可视化图表库，提供直观，生动，可交互，可个性化定制的数据可视化图表。
Echarts也称为数据可视化技术"><meta property="og:type" content="article"><meta property="og:url" content="https://wqnm1gb.github.io/posts/day11%E6%95%B0%E6%8D%AE%E7%BB%9F%E8%AE%A1%E5%9B%BE%E5%BD%A2%E6%8A%A5%E8%A1%A8/"><meta property="og:image" content="https://wqnm1gb.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-03-20T11:09:20+08:00"><meta property="article:modified_time" content="2025-03-20T11:09:20+08:00"><meta property="og:site_name" content="三狗子的博客"><meta property="fb:admins" content="your-facebook-admin-id"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://wqnm1gb.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Day11 数据统计、图形报表","item":"https://wqnm1gb.github.io/posts/day11%E6%95%B0%E6%8D%AE%E7%BB%9F%E8%AE%A1%E5%9B%BE%E5%BD%A2%E6%8A%A5%E8%A1%A8/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Day11 数据统计、图形报表","name":"Day11 数据统计、图形报表","description":"Apache ECharts Apache ECharts是一款基于JavaScript的数据可视化图表库，提供直观，生动，可交互，可个性化定制的数据可视化图表。\nEcharts也称为数据可视化技术\n","keywords":["苍穹外卖"],"articleBody":"Apache ECharts Apache ECharts是一款基于JavaScript的数据可视化图表库，提供直观，生动，可交互，可个性化定制的数据可视化图表。\nEcharts也称为数据可视化技术\n总结：使用Echarts，重点在于研究当前图表所需的数据格式。通常是需要后端提供符合格式要求的动态数据，然后响应给前端来展示图表。\n营业额统计 业务规则：\n营业额指订单状态为已完成的订单金额合计 基于可视化报表的折线图展示营业额数据，X轴为日期，Y轴为营业额 根据时间选择区间，展示每天的营业额数据 Controller层 /** * 营业额统计 * @param begin * @param end * @return */ @GetMapping(\"/turnoverStatistics\") @ApiOperation(\"营业额统计\") public Result\u003cTurnoverReportVO\u003e turnoverStatistics ( @DateTimeFormat(pattern = \"yyyy-MM-dd\") LocalDate begin , @DateTimeFormat(pattern = \"yyyy-MM-dd\") LocalDate end){ log.info(\"营业额统计{}-{}\",begin,end); TurnoverReportVO turnoverReportVO = reportService.turnoverStatistics(begin, end); return Result.success(turnoverReportVO); } Service层 /** * 营业额统计 * @param begin * @param end * @return */ @Override public TurnoverReportVO turnoverStatistics(LocalDate begin, LocalDate end) { // 先拼接日期数据 List\u003cLocalDate\u003e dataList = new ArrayList\u003c\u003e(); dataList.add(begin); while (!begin.equals(end)){ // 如果日期没有到end，那么就加上begin+1 begin = begin.plusDays(1); dataList.add(begin); } List\u003cDouble\u003e sum = new ArrayList\u003c\u003e(); // 统计每天的营业额总和 for (LocalDate localDate : dataList) { // 先把时间转换成LocalDateTime类型 LocalDateTime beginTime = LocalDateTime.of(localDate, LocalTime.MIN); LocalDateTime endTime = LocalDateTime.of(localDate, LocalTime.MAX); // 需要统计的是，指定时间，已完成状态的金额总和数据 Map map = new HashMap(); map.put(\"begin\",beginTime); map.put(\"end\",endTime); map.put(\"type\", Orders.COMPLETED); Double amount = orderMapper.sumByMap(map); // 如果没有统计到数据，会返回null，这时候我们要把null改成0.0 amount = amount == null ? 0.0 : amount; sum.add(amount); } return TurnoverReportVO.builder() // 把数据转换成字符串StringUtils lang3这个包里边的 .dateList(StringUtils.join(dataList,\",\")) .turnoverList(StringUtils.join(sum,\",\")) .build(); } 实现的思路就是根据现在日期，和一共查询的天数构造出来，构造成一个集合，遍历这个集合，查询每天的具体数据\n用Query参数接收日期参数的时候，需要指定日期的格式，\n一天的开始是0点0分0秒 ，一天的结束是23点59分59秒\n把LocalTime转化成LocalDateTime，同时是最早的时间\nLocalDateTime beginTime = LocalDateTime.of(localDate, LocalTime.MIN); LocalTime.MIN 这里边是Time时间的最小值\nLocatDate.MIN 这里是Date日期的最小值\n把List集合转换成字符串\nStringUtils.join(dataList,\",\") StringUtils lang3这个包里边的，转换成字符串，每个集合间用,分隔\nMyBatis 在处理 Map 参数时，会直接通过键名（如 begin）访问 Map 中的值，而不是通过原始变量名\n什么时候适合用Map什么时候适合直接传参\n场景 直接传参 使用** ****Map** 参数数量固定 适合（需 @Param 注解） 适合，但略微冗余 参数数量动态变化 不灵活（需传 null 或修改方法签名） 灵活（动态增减键值对） 代码简洁性 参数多时冗长 统一管理，代码简洁 参数名与字段名不一致 需 @Param 注解调整 直接通过键名映射 在xml文件中的sql语句，大于写成**\u003e，大于等于写成\u003e=，小于写成\u003c**\n用户数据统计 /** * 用户信息统计 * @param begin * @param end * @return */ @Override public UserReportVO userStatistics(LocalDate begin, LocalDate end) { // 先拼接日期数据 List\u003cLocalDate\u003e dataList = new ArrayList\u003c\u003e(); dataList.add(begin); while (!begin.equals(end)){ // 如果日期没有到end，那么就加上begin+1 begin = begin.plusDays(1); dataList.add(begin); } // 获取新增用户数据和总的用户数据 List\u003cInteger\u003e newUser = new ArrayList\u003c\u003e(); List\u003cInteger\u003e totalUser = new ArrayList\u003c\u003e(); for (LocalDate localDate : dataList) { // 把每一天的日期都封装一下 LocalDateTime beginTime = LocalDateTime.of(localDate, LocalTime.MIN); LocalDateTime endTime = LocalDateTime.of(localDate, LocalTime.MAX); // 构造一个Map集合，来查询数据 Map map = new HashMap(); map.put(\"end\",endTime); // 先put end字段，这样可以只用一个map先查询总的用户数，然后再添加上begin字段，查询出当天新增的用户 Integer totalCount = userMapper.countUser(map); map.put(\"begin\",beginTime); Integer newCount = userMapper.countUser(map); newUser.add(newCount); totalUser.add(totalCount); } return UserReportVO.builder() .dateList(StringUtils.join(dataList,\",\")) .newUserList(StringUtils.join(newUser,\",\")) .totalUserList(StringUtils.join(totalUser,\",\")) .build(); } 实现思路都是一样的，构造动态SQL拼接条件来查询，这里有个巧妙的地方是，先给map集合里边put结束时间，那么就会查出所有从开始到现在的所有数据，然后再put一个开始时间，就可以查出开始时间到结束时间的内容\n订单统计 /** * 订单统计 * @param begin * @param end * @return */ @Override public OrderReportVO ordersStatistics(LocalDate begin, LocalDate end) { // 先拼接日期数据 List\u003cLocalDate\u003e dataList = new ArrayList\u003c\u003e(); dataList.add(begin); while (!begin.equals(end)){ // 如果日期没有到end，那么就加上begin+1 begin = begin.plusDays(1); dataList.add(begin); } // 记录所有订单数 List\u003cInteger\u003e allSum = new ArrayList\u003c\u003e(); // 记录有效订单数 List\u003cInteger\u003e validSum = new ArrayList\u003c\u003e(); for (LocalDate localDate : dataList) { // 获取每一天的订单数和有效订单数 LocalDateTime beginTime = LocalDateTime.of(localDate, LocalTime.MIN); LocalDateTime endTime = LocalDateTime.of(localDate, LocalTime.MAX); // select count(id) from orders where order_time \u003e and order_time \u003c and ordertime Map map = new HashMap(); map.put(\"begin\",beginTime); map.put(\"end\",endTime); // 没有状态的时候可以查询所有订单数目 Integer allCount = orderMapper.countByMap(map); allCount = allCount == null ? 0 : allCount; map.put(\"status\",Orders.COMPLETED); Integer validCount = orderMapper.countByMap(map); validCount = validCount == null ? 0 : validCount; allSum.add(allCount); validSum.add(validCount); } // 再通过一次遍历，查询出所有订单数，和所有有效订单数和订单完成率 Integer sumOrder = allSum.stream().reduce(Integer::sum).get(); Integer sumValid = validSum.stream().reduce(Integer::sum).get(); Double orderCompleteRate = 0.0; if(sumOrder != 0) { orderCompleteRate = (sumValid.doubleValue() / sumOrder); } return OrderReportVO.builder().dateList(StringUtils.join(dataList,\",\")) .orderCountList(StringUtils.join(allSum,\",\")) .orderCompletionRate(orderCompleteRate) .totalOrderCount(sumOrder) .validOrderCount(sumValid) .validOrderCountList(StringUtils.join(validSum,\",\")) .build(); } 通过Stream流来收集所有元素的和\n// 再通过一次遍历，查询出所有订单数，和所有有效订单数和订单完成率 Integer sumOrder = allSum.stream().reduce(Integer::sum).get(); Integer sumValid = validSum.stream().reduce(Integer::sum).get(); Double orderCompleteRate = 0.0; if(sumOrder != 0) { orderCompleteRate = (sumValid.doubleValue() / sumOrder); } 有用doubleValue()来转换，不能直接把计算后的结果转换为double这样会有误差\n用户下单后取消订单，份数是不算的，但是详情表不会删除，只会更改订单表里边的字段，所以这个时候需要连接两张表查询\nselect count(*) from order_detail od ,orders o where od.order_id = o.id\ncount是用来统计的，比如这句就是统计出一共有几条数据，不是用来分类的\nTOP10统计 /** * Top10统计 * @param begin * @param end * @return */ @Override public SalesTop10ReportVO top10Statistics(LocalDate begin, LocalDate end) { // 先拼接日期数据 // List dataList = new ArrayList\u003c\u003e(); // dataList.add(begin); // while (!begin.equals(end)){ // // 如果日期没有到end，那么就加上begin+1 // begin = begin.plusDays(1); // dataList.add(begin); // } // 不需要遍历每一天，因为只是统计7天内的销量 LocalDateTime beginTime = LocalDateTime.of(begin, LocalTime.MIN); LocalDateTime endTime = LocalDateTime.of(end, LocalTime.MAX); List\u003cGoodsSalesDTO\u003e goodsSalesDTOList = orderMapper.top10Statistics(beginTime,endTime); log.info(\"{}\",goodsSalesDTOList); List\u003cString\u003e nameList = goodsSalesDTOList.stream().map(GoodsSalesDTO::getName).collect(Collectors.toList()); List\u003cInteger\u003e numberList = goodsSalesDTOList.stream().map(GoodsSalesDTO::getNumber).collect(Collectors.toList()); return SalesTop10ReportVO.builder().nameList(StringUtils.join(nameList,\",\")).numberList(StringUtils.join(numberList,\",\")).build(); } ","wordCount":"2025","inLanguage":"zh","image":"https://wqnm1gb.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E","datePublished":"2025-03-20T11:09:20+08:00","dateModified":"2025-03-20T11:09:20+08:00","author":{"@type":"Person","name":"冷漠三狗子丶"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://wqnm1gb.github.io/posts/day11%E6%95%B0%E6%8D%AE%E7%BB%9F%E8%AE%A1%E5%9B%BE%E5%BD%A2%E6%8A%A5%E8%A1%A8/"},"publisher":{"@type":"Organization","name":"三狗子的博客","logo":{"@type":"ImageObject","url":"https://wqnm1gb.github.io/images/favicon.png"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://wqnm1gb.github.io/ accesskey=h title="主页 (Alt + H)"><img src=https://wqnm1gb.github.io/apple-touch-icon.png alt aria-label=logo height=35>主页</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://wqnm1gb.github.io/ title=三狗子的博客><span>首页</span></a></li><li><a href=https://wqnm1gb.github.io/archives/ title=归档><span>归档</span></a></li><li><a href=https://wqnm1gb.github.io/categories/ title=Categories><span>分类</span></a></li><li><a href=https://wqnm1gb.github.io/tags/ title=Tags><span>标签</span></a></li><li><a href=https://wqnm1gb.github.io/search/ title=搜索><span>搜索</span></a></li><li><a href=https://wqnm1gb.github.io/about/ title=关于><span>关于</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://wqnm1gb.github.io/>主页</a>&nbsp;»&nbsp;<a href=https://wqnm1gb.github.io/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Day11 数据统计、图形报表</h1><div class=post-meta><span title='2025-03-20 11:09:20 +0800 +0800'>三月 20, 2025</span>&nbsp;·&nbsp;5 分钟&nbsp;·&nbsp;2025 字&nbsp;·&nbsp;冷漠三狗子丶</div></header><div class=post-content><h1 id=apache-echarts>Apache ECharts<a hidden class=anchor aria-hidden=true href=#apache-echarts>#</a></h1><p>Apache ECharts是一款基于JavaScript的数据可视化图表库，提供直观，生动，可交互，可个性化定制的数据可视化图表。</p><p>Echarts也称为数据可视化技术</p><p>总结：使用Echarts，重点在于<strong>研究当前图表所需的数据格式</strong>。通常是需要后端提供符合格式要求的动态数据，然后响应给前端来展示图表。</p><h1 id=营业额统计>营业额统计<a hidden class=anchor aria-hidden=true href=#营业额统计>#</a></h1><p>业务规则：</p><ul><li>营业额指订单状态为已完成的订单金额合计</li><li>基于可视化报表的折线图展示营业额数据，X轴为日期，Y轴为营业额</li><li>根据时间选择区间，展示每天的营业额数据</li></ul><h2 id=controller层>Controller层<a hidden class=anchor aria-hidden=true href=#controller层>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=w> </span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 营业额统计
</span></span></span><span class=line><span class=cl><span class=cm>     * @param begin
</span></span></span><span class=line><span class=cl><span class=cm>     * @param end
</span></span></span><span class=line><span class=cl><span class=cm>     * @return
</span></span></span><span class=line><span class=cl><span class=cm>     */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@GetMapping</span><span class=p>(</span><span class=s>&#34;/turnoverStatistics&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@ApiOperation</span><span class=p>(</span><span class=s>&#34;营业额统计&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>Result</span><span class=o>&lt;</span><span class=n>TurnoverReportVO</span><span class=o>&gt;</span><span class=w> </span><span class=nf>turnoverStatistics</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nd>@DateTimeFormat</span><span class=p>(</span><span class=n>pattern</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;yyyy-MM-dd&#34;</span><span class=p>)</span><span class=w> </span><span class=n>LocalDate</span><span class=w> </span><span class=n>begin</span><span class=w> </span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nd>@DateTimeFormat</span><span class=p>(</span><span class=n>pattern</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;yyyy-MM-dd&#34;</span><span class=p>)</span><span class=w> </span><span class=n>LocalDate</span><span class=w> </span><span class=n>end</span><span class=p>){</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>log</span><span class=p>.</span><span class=na>info</span><span class=p>(</span><span class=s>&#34;营业额统计{}-{}&#34;</span><span class=p>,</span><span class=n>begin</span><span class=p>,</span><span class=n>end</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>TurnoverReportVO</span><span class=w> </span><span class=n>turnoverReportVO</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>reportService</span><span class=p>.</span><span class=na>turnoverStatistics</span><span class=p>(</span><span class=n>begin</span><span class=p>,</span><span class=w> </span><span class=n>end</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>Result</span><span class=p>.</span><span class=na>success</span><span class=p>(</span><span class=n>turnoverReportVO</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><h2 id=service层>Service层<a hidden class=anchor aria-hidden=true href=#service层>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=w>    </span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 营业额统计
</span></span></span><span class=line><span class=cl><span class=cm>     * @param begin
</span></span></span><span class=line><span class=cl><span class=cm>     * @param end
</span></span></span><span class=line><span class=cl><span class=cm>     * @return
</span></span></span><span class=line><span class=cl><span class=cm>     */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>TurnoverReportVO</span><span class=w> </span><span class=nf>turnoverStatistics</span><span class=p>(</span><span class=n>LocalDate</span><span class=w> </span><span class=n>begin</span><span class=p>,</span><span class=w> </span><span class=n>LocalDate</span><span class=w> </span><span class=n>end</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 先拼接日期数据</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>List</span><span class=o>&lt;</span><span class=n>LocalDate</span><span class=o>&gt;</span><span class=w> </span><span class=n>dataList</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ArrayList</span><span class=o>&lt;&gt;</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>dataList</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>begin</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>begin</span><span class=p>.</span><span class=na>equals</span><span class=p>(</span><span class=n>end</span><span class=p>)){</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 如果日期没有到end，那么就加上begin+1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>begin</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>begin</span><span class=p>.</span><span class=na>plusDays</span><span class=p>(</span><span class=n>1</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>dataList</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>begin</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>List</span><span class=o>&lt;</span><span class=n>Double</span><span class=o>&gt;</span><span class=w> </span><span class=n>sum</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ArrayList</span><span class=o>&lt;&gt;</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 统计每天的营业额总和</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=n>LocalDate</span><span class=w> </span><span class=n>localDate</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>dataList</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 先把时间转换成LocalDateTime类型</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>LocalDateTime</span><span class=w> </span><span class=n>beginTime</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>LocalDateTime</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=n>localDate</span><span class=p>,</span><span class=w> </span><span class=n>LocalTime</span><span class=p>.</span><span class=na>MIN</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>LocalDateTime</span><span class=w> </span><span class=n>endTime</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>LocalDateTime</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=n>localDate</span><span class=p>,</span><span class=w> </span><span class=n>LocalTime</span><span class=p>.</span><span class=na>MAX</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 需要统计的是，指定时间，已完成状态的金额总和数据</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Map</span><span class=w> </span><span class=n>map</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>HashMap</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>map</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&#34;begin&#34;</span><span class=p>,</span><span class=n>beginTime</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>map</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&#34;end&#34;</span><span class=p>,</span><span class=n>endTime</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>map</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&#34;type&#34;</span><span class=p>,</span><span class=w> </span><span class=n>Orders</span><span class=p>.</span><span class=na>COMPLETED</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Double</span><span class=w> </span><span class=n>amount</span><span class=w> </span><span class=o>=</span><span class=w>  </span><span class=n>orderMapper</span><span class=p>.</span><span class=na>sumByMap</span><span class=p>(</span><span class=n>map</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 如果没有统计到数据，会返回null，这时候我们要把null改成0.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>amount</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>amount</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=n>0</span><span class=p>.</span><span class=na>0</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>amount</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>sum</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>amount</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>TurnoverReportVO</span><span class=p>.</span><span class=na>builder</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 把数据转换成字符串StringUtils lang3这个包里边的</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>dateList</span><span class=p>(</span><span class=n>StringUtils</span><span class=p>.</span><span class=na>join</span><span class=p>(</span><span class=n>dataList</span><span class=p>,</span><span class=s>&#34;,&#34;</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>turnoverList</span><span class=p>(</span><span class=n>StringUtils</span><span class=p>.</span><span class=na>join</span><span class=p>(</span><span class=n>sum</span><span class=p>,</span><span class=s>&#34;,&#34;</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>实现的思路就是根据现在日期，和一共查询的天数构造出来，构造成一个集合，遍历这个集合，查询每天的具体数据</p><p>用Query参数接收日期参数的时候，需要指定日期的格式，</p><p>一天的开始是0点0分0秒 ，一天的结束是23点59分59秒</p><p>把LocalTime转化成LocalDateTime，同时是最早的时间</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>LocalDateTime</span><span class=w> </span><span class=n>beginTime</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>LocalDateTime</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=n>localDate</span><span class=p>,</span><span class=w> </span><span class=n>LocalTime</span><span class=p>.</span><span class=na>MIN</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></div><p>LocalTime.MIN 这里边是Time时间的最小值</p><p>LocatDate.MIN 这里是Date日期的最小值</p><p>把List集合转换成字符串</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>StringUtils</span><span class=p>.</span><span class=na>join</span><span class=p>(</span><span class=n>dataList</span><span class=p>,</span><span class=s>&#34;,&#34;</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></div><p>StringUtils lang3这个包里边的，转换成字符串，每个集合间用,分隔</p><p>MyBatis 在处理 <code>&lt;font style="color:rgb(64, 64, 64);">Map&lt;/font></code> 参数时，会直接通过键名（如 <code>&lt;font style="color:rgb(64, 64, 64);">begin&lt;/font></code>）访问 <code>&lt;font style="color:rgb(64, 64, 64);">Map&lt;/font></code> 中的值，而不是通过原始变量名</p><p>什么时候适合用Map什么时候适合直接传参</p><table><thead><tr><th><strong>场景</strong></th><th><strong>直接传参</strong></th><th><strong>使用</strong>** **<code>**Map**</code></th></tr></thead><tbody><tr><td>参数数量固定</td><td>适合（需 <code>&lt;font style="color:rgb(64, 64, 64);">@Param&lt;/font></code> 注解）</td><td>适合，但略微冗余</td></tr><tr><td>参数数量动态变化</td><td>不灵活（需传 <code>&lt;font style="color:rgb(64, 64, 64);">null&lt;/font></code> 或修改方法签名）</td><td>灵活（动态增减键值对）</td></tr><tr><td>代码简洁性</td><td>参数多时冗长</td><td>统一管理，代码简洁</td></tr><tr><td>参数名与字段名不一致</td><td>需 <code>&lt;font style="color:rgb(64, 64, 64);">@Param&lt;/font></code> 注解调整</td><td>直接通过键名映射</td></tr></tbody></table><p>在xml文件中的sql语句，大于写成**><strong>，大于等于写成</strong>>=<strong>，小于写成</strong>&lt;**</p><h1 id=用户数据统计>用户数据统计<a hidden class=anchor aria-hidden=true href=#用户数据统计>#</a></h1><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=w> </span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 用户信息统计
</span></span></span><span class=line><span class=cl><span class=cm>     * @param begin
</span></span></span><span class=line><span class=cl><span class=cm>     * @param end
</span></span></span><span class=line><span class=cl><span class=cm>     * @return
</span></span></span><span class=line><span class=cl><span class=cm>     */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>UserReportVO</span><span class=w> </span><span class=nf>userStatistics</span><span class=p>(</span><span class=n>LocalDate</span><span class=w> </span><span class=n>begin</span><span class=p>,</span><span class=w> </span><span class=n>LocalDate</span><span class=w> </span><span class=n>end</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 先拼接日期数据</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>List</span><span class=o>&lt;</span><span class=n>LocalDate</span><span class=o>&gt;</span><span class=w> </span><span class=n>dataList</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ArrayList</span><span class=o>&lt;&gt;</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>dataList</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>begin</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>begin</span><span class=p>.</span><span class=na>equals</span><span class=p>(</span><span class=n>end</span><span class=p>)){</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 如果日期没有到end，那么就加上begin+1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>begin</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>begin</span><span class=p>.</span><span class=na>plusDays</span><span class=p>(</span><span class=n>1</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>dataList</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>begin</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 获取新增用户数据和总的用户数据</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>List</span><span class=o>&lt;</span><span class=n>Integer</span><span class=o>&gt;</span><span class=w> </span><span class=n>newUser</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ArrayList</span><span class=o>&lt;&gt;</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>List</span><span class=o>&lt;</span><span class=n>Integer</span><span class=o>&gt;</span><span class=w> </span><span class=n>totalUser</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ArrayList</span><span class=o>&lt;&gt;</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=n>LocalDate</span><span class=w> </span><span class=n>localDate</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>dataList</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 把每一天的日期都封装一下</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>LocalDateTime</span><span class=w> </span><span class=n>beginTime</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>LocalDateTime</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=n>localDate</span><span class=p>,</span><span class=w> </span><span class=n>LocalTime</span><span class=p>.</span><span class=na>MIN</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>LocalDateTime</span><span class=w> </span><span class=n>endTime</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>LocalDateTime</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=n>localDate</span><span class=p>,</span><span class=w> </span><span class=n>LocalTime</span><span class=p>.</span><span class=na>MAX</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 构造一个Map集合，来查询数据</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Map</span><span class=w> </span><span class=n>map</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>HashMap</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>map</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&#34;end&#34;</span><span class=p>,</span><span class=n>endTime</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 先put end字段，这样可以只用一个map先查询总的用户数，然后再添加上begin字段，查询出当天新增的用户</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Integer</span><span class=w> </span><span class=n>totalCount</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>userMapper</span><span class=p>.</span><span class=na>countUser</span><span class=p>(</span><span class=n>map</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>map</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&#34;begin&#34;</span><span class=p>,</span><span class=n>beginTime</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Integer</span><span class=w> </span><span class=n>newCount</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>userMapper</span><span class=p>.</span><span class=na>countUser</span><span class=p>(</span><span class=n>map</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>newUser</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>newCount</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>totalUser</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>totalCount</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>UserReportVO</span><span class=p>.</span><span class=na>builder</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>dateList</span><span class=p>(</span><span class=n>StringUtils</span><span class=p>.</span><span class=na>join</span><span class=p>(</span><span class=n>dataList</span><span class=p>,</span><span class=s>&#34;,&#34;</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>newUserList</span><span class=p>(</span><span class=n>StringUtils</span><span class=p>.</span><span class=na>join</span><span class=p>(</span><span class=n>newUser</span><span class=p>,</span><span class=s>&#34;,&#34;</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>totalUserList</span><span class=p>(</span><span class=n>StringUtils</span><span class=p>.</span><span class=na>join</span><span class=p>(</span><span class=n>totalUser</span><span class=p>,</span><span class=s>&#34;,&#34;</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>实现思路都是一样的，构造动态SQL拼接条件来查询，这里有个巧妙的地方是，先给map集合里边put结束时间，那么就会查出所有从开始到现在的所有数据，然后再put一个开始时间，就可以查出开始时间到结束时间的内容</p><h1 id=订单统计>订单统计<a hidden class=anchor aria-hidden=true href=#订单统计>#</a></h1><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=w>    </span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 订单统计
</span></span></span><span class=line><span class=cl><span class=cm>     * @param begin
</span></span></span><span class=line><span class=cl><span class=cm>     * @param end
</span></span></span><span class=line><span class=cl><span class=cm>     * @return
</span></span></span><span class=line><span class=cl><span class=cm>     */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>OrderReportVO</span><span class=w> </span><span class=nf>ordersStatistics</span><span class=p>(</span><span class=n>LocalDate</span><span class=w> </span><span class=n>begin</span><span class=p>,</span><span class=w> </span><span class=n>LocalDate</span><span class=w> </span><span class=n>end</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 先拼接日期数据</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>List</span><span class=o>&lt;</span><span class=n>LocalDate</span><span class=o>&gt;</span><span class=w> </span><span class=n>dataList</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ArrayList</span><span class=o>&lt;&gt;</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>dataList</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>begin</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>begin</span><span class=p>.</span><span class=na>equals</span><span class=p>(</span><span class=n>end</span><span class=p>)){</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 如果日期没有到end，那么就加上begin+1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>begin</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>begin</span><span class=p>.</span><span class=na>plusDays</span><span class=p>(</span><span class=n>1</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>dataList</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>begin</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 记录所有订单数</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>List</span><span class=o>&lt;</span><span class=n>Integer</span><span class=o>&gt;</span><span class=w> </span><span class=n>allSum</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ArrayList</span><span class=o>&lt;&gt;</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 记录有效订单数</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>List</span><span class=o>&lt;</span><span class=n>Integer</span><span class=o>&gt;</span><span class=w> </span><span class=n>validSum</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ArrayList</span><span class=o>&lt;&gt;</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=n>LocalDate</span><span class=w> </span><span class=n>localDate</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>dataList</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 获取每一天的订单数和有效订单数</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>LocalDateTime</span><span class=w> </span><span class=n>beginTime</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>LocalDateTime</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=n>localDate</span><span class=p>,</span><span class=w> </span><span class=n>LocalTime</span><span class=p>.</span><span class=na>MIN</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>LocalDateTime</span><span class=w> </span><span class=n>endTime</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>LocalDateTime</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=n>localDate</span><span class=p>,</span><span class=w> </span><span class=n>LocalTime</span><span class=p>.</span><span class=na>MAX</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// select count(id) from orders where order_time &gt; and order_time &lt; and ordertime</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Map</span><span class=w> </span><span class=n>map</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>HashMap</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>map</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&#34;begin&#34;</span><span class=p>,</span><span class=n>beginTime</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>map</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&#34;end&#34;</span><span class=p>,</span><span class=n>endTime</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 没有状态的时候可以查询所有订单数目</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Integer</span><span class=w> </span><span class=n>allCount</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>orderMapper</span><span class=p>.</span><span class=na>countByMap</span><span class=p>(</span><span class=n>map</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>allCount</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>allCount</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=n>0</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>allCount</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>map</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&#34;status&#34;</span><span class=p>,</span><span class=n>Orders</span><span class=p>.</span><span class=na>COMPLETED</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Integer</span><span class=w> </span><span class=n>validCount</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>orderMapper</span><span class=p>.</span><span class=na>countByMap</span><span class=p>(</span><span class=n>map</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>validCount</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>validCount</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=n>0</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>validCount</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>allSum</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>allCount</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>validSum</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>validCount</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 再通过一次遍历，查询出所有订单数，和所有有效订单数和订单完成率</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Integer</span><span class=w> </span><span class=n>sumOrder</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>allSum</span><span class=p>.</span><span class=na>stream</span><span class=p>().</span><span class=na>reduce</span><span class=p>(</span><span class=n>Integer</span><span class=p>::</span><span class=n>sum</span><span class=p>).</span><span class=na>get</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Integer</span><span class=w> </span><span class=n>sumValid</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>validSum</span><span class=p>.</span><span class=na>stream</span><span class=p>().</span><span class=na>reduce</span><span class=p>(</span><span class=n>Integer</span><span class=p>::</span><span class=n>sum</span><span class=p>).</span><span class=na>get</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Double</span><span class=w> </span><span class=n>orderCompleteRate</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>0</span><span class=p>.</span><span class=na>0</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=p>(</span><span class=n>sumOrder</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=n>0</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>orderCompleteRate</span><span class=w> </span><span class=o>=</span><span class=w>  </span><span class=p>(</span><span class=n>sumValid</span><span class=p>.</span><span class=na>doubleValue</span><span class=p>()</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=n>sumOrder</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>OrderReportVO</span><span class=p>.</span><span class=na>builder</span><span class=p>().</span><span class=na>dateList</span><span class=p>(</span><span class=n>StringUtils</span><span class=p>.</span><span class=na>join</span><span class=p>(</span><span class=n>dataList</span><span class=p>,</span><span class=s>&#34;,&#34;</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>orderCountList</span><span class=p>(</span><span class=n>StringUtils</span><span class=p>.</span><span class=na>join</span><span class=p>(</span><span class=n>allSum</span><span class=p>,</span><span class=s>&#34;,&#34;</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>orderCompletionRate</span><span class=p>(</span><span class=n>orderCompleteRate</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>totalOrderCount</span><span class=p>(</span><span class=n>sumOrder</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>validOrderCount</span><span class=p>(</span><span class=n>sumValid</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>validOrderCountList</span><span class=p>(</span><span class=n>StringUtils</span><span class=p>.</span><span class=na>join</span><span class=p>(</span><span class=n>validSum</span><span class=p>,</span><span class=s>&#34;,&#34;</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>通过Stream流来收集所有元素的和</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 再通过一次遍历，查询出所有订单数，和所有有效订单数和订单完成率</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Integer</span><span class=w> </span><span class=n>sumOrder</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>allSum</span><span class=p>.</span><span class=na>stream</span><span class=p>().</span><span class=na>reduce</span><span class=p>(</span><span class=n>Integer</span><span class=p>::</span><span class=n>sum</span><span class=p>).</span><span class=na>get</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Integer</span><span class=w> </span><span class=n>sumValid</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>validSum</span><span class=p>.</span><span class=na>stream</span><span class=p>().</span><span class=na>reduce</span><span class=p>(</span><span class=n>Integer</span><span class=p>::</span><span class=n>sum</span><span class=p>).</span><span class=na>get</span><span class=p>();</span><span class=w>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>Double</span><span class=w> </span><span class=n>orderCompleteRate</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>0</span><span class=p>.</span><span class=na>0</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>if</span><span class=p>(</span><span class=n>sumOrder</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=n>0</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>orderCompleteRate</span><span class=w> </span><span class=o>=</span><span class=w>  </span><span class=p>(</span><span class=n>sumValid</span><span class=p>.</span><span class=na>doubleValue</span><span class=p>()</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=n>sumOrder</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>有用doubleValue()来转换，不能直接把计算后的结果转换为double这样会有误差</p><p>用户下单后取消订单，份数是不算的，但是详情表不会删除，只会更改订单表里边的字段，所以这个时候需要连接两张表查询</p><p>select count(*) from order_detail od ,orders o where od.order_id = o.id</p><p>count是用来统计的，比如这句就是统计出一共有几条数据，不是用来分类的</p><h1 id=top10统计>TOP10统计<a hidden class=anchor aria-hidden=true href=#top10统计>#</a></h1><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=w> </span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * Top10统计
</span></span></span><span class=line><span class=cl><span class=cm>     * @param begin
</span></span></span><span class=line><span class=cl><span class=cm>     * @param end
</span></span></span><span class=line><span class=cl><span class=cm>     * @return
</span></span></span><span class=line><span class=cl><span class=cm>     */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>SalesTop10ReportVO</span><span class=w> </span><span class=nf>top10Statistics</span><span class=p>(</span><span class=n>LocalDate</span><span class=w> </span><span class=n>begin</span><span class=p>,</span><span class=w> </span><span class=n>LocalDate</span><span class=w> </span><span class=n>end</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 先拼接日期数据</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>//        List&lt;LocalDate&gt; dataList = new ArrayList&lt;&gt;();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>//        dataList.add(begin);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>//        while (!begin.equals(end)){</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>//            // 如果日期没有到end，那么就加上begin+1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>//            begin = begin.plusDays(1);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>//            dataList.add(begin);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>//        }</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 不需要遍历每一天，因为只是统计7天内的销量</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>LocalDateTime</span><span class=w> </span><span class=n>beginTime</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>LocalDateTime</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=n>begin</span><span class=p>,</span><span class=w> </span><span class=n>LocalTime</span><span class=p>.</span><span class=na>MIN</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>LocalDateTime</span><span class=w> </span><span class=n>endTime</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>LocalDateTime</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=n>end</span><span class=p>,</span><span class=w> </span><span class=n>LocalTime</span><span class=p>.</span><span class=na>MAX</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>List</span><span class=o>&lt;</span><span class=n>GoodsSalesDTO</span><span class=o>&gt;</span><span class=w> </span><span class=n>goodsSalesDTOList</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>orderMapper</span><span class=p>.</span><span class=na>top10Statistics</span><span class=p>(</span><span class=n>beginTime</span><span class=p>,</span><span class=n>endTime</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>log</span><span class=p>.</span><span class=na>info</span><span class=p>(</span><span class=s>&#34;{}&#34;</span><span class=p>,</span><span class=n>goodsSalesDTOList</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>List</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span><span class=w> </span><span class=n>nameList</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>goodsSalesDTOList</span><span class=p>.</span><span class=na>stream</span><span class=p>().</span><span class=na>map</span><span class=p>(</span><span class=n>GoodsSalesDTO</span><span class=p>::</span><span class=n>getName</span><span class=p>).</span><span class=na>collect</span><span class=p>(</span><span class=n>Collectors</span><span class=p>.</span><span class=na>toList</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>List</span><span class=o>&lt;</span><span class=n>Integer</span><span class=o>&gt;</span><span class=w> </span><span class=n>numberList</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>goodsSalesDTOList</span><span class=p>.</span><span class=na>stream</span><span class=p>().</span><span class=na>map</span><span class=p>(</span><span class=n>GoodsSalesDTO</span><span class=p>::</span><span class=n>getNumber</span><span class=p>).</span><span class=na>collect</span><span class=p>(</span><span class=n>Collectors</span><span class=p>.</span><span class=na>toList</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>SalesTop10ReportVO</span><span class=p>.</span><span class=na>builder</span><span class=p>().</span><span class=na>nameList</span><span class=p>(</span><span class=n>StringUtils</span><span class=p>.</span><span class=na>join</span><span class=p>(</span><span class=n>nameList</span><span class=p>,</span><span class=s>&#34;,&#34;</span><span class=p>)).</span><span class=na>numberList</span><span class=p>(</span><span class=n>StringUtils</span><span class=p>.</span><span class=na>join</span><span class=p>(</span><span class=n>numberList</span><span class=p>,</span><span class=s>&#34;,&#34;</span><span class=p>)).</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://wqnm1gb.github.io/tags/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96/>苍穹外卖</a></li></ul><nav class=paginav><a class=prev href=https://wqnm1gb.github.io/posts/day12%E6%95%B0%E6%8D%AE%E7%BB%9F%E8%AE%A1excel%E6%8A%A5%E8%A1%A8/><span class=title>« 上一页</span><br><span>Day12 数据统计、Excel报表</span>
</a><a class=next href=https://wqnm1gb.github.io/posts/day10%E8%AE%A2%E5%8D%95%E7%8A%B6%E6%80%81%E5%AE%9A%E6%97%B6%E5%A4%84%E7%90%86%E6%9D%A5%E5%8D%95%E6%8F%90%E9%86%92%E5%92%8C%E5%AE%A2%E6%88%B7%E5%82%AC%E5%8D%95/><span class=title>下一页 »</span><br><span>Day10 订单状态定时处理、来单提醒和客户催单</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://wqnm1gb.github.io/>三狗子的博客</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="复制";function s(){t.innerHTML="已复制！",setTimeout(()=>{t.innerHTML="复制"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>