<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Day06 Java操作数据库 | 三狗子的博客</title>
<meta name=keywords content="java Web"><meta name=description content="

JDBC介绍
JDBC：（Java DataBase Connectivity），就是使用Java语言操作关系型数据库的一套API。




本质：
• sun公司官方定义的一套操作所有关系型数据库的规范，即接口。"><meta name=author content="冷漠三狗子丶"><link rel=canonical href=https://wqnm1gb.github.io/posts/day06java%E6%93%8D%E4%BD%9C%E6%95%B0%E6%8D%AE%E5%BA%93/><link crossorigin=anonymous href=/assets/css/stylesheet.3d688279d829dc24da48acd11f9e33ebea2f39c035e899e1bf4297d8b7aa89b9.css integrity="sha256-PWiCedgp3CTaSKzRH54z6+ovOcA16Jnhv0KX2Leqibk=" rel="preload stylesheet" as=style><link rel=icon href=https://wqnm1gb.github.io/images/favicon.png><link rel=icon type=image/png sizes=16x16 href=https://wqnm1gb.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://wqnm1gb.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://wqnm1gb.github.io/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://wqnm1gb.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh href=https://wqnm1gb.github.io/posts/day06java%E6%93%8D%E4%BD%9C%E6%95%B0%E6%8D%AE%E5%BA%93/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&display=swap" rel=stylesheet><script type=text/javascript async src="https://cdn.bootcss.com/mathjax/2.7.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML">MathJax.Hub.Config({tex2jax:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["[[","]]"]],processEscapes:!0,processEnvironments:!0,skipTags:["script","noscript","style","textarea","pre"],TeX:{equationNumbers:{autoNumber:"AMS"},extensions:["AMSmath.js","AMSsymbols.js"]}}}),MathJax.Hub.Queue(function(){var e,t=MathJax.Hub.getAllJax();for(e=0;e<t.length;e+=1)t[e].SourceElement().parentNode.className+=" has-jax"})</script><style>code.has-jax{font:inherit;font-size:100%;background:inherit;border:inherit;color:#515151}</style><meta property="og:title" content="Day06 Java操作数据库"><meta property="og:description" content="

JDBC介绍
JDBC：（Java DataBase Connectivity），就是使用Java语言操作关系型数据库的一套API。




本质：
• sun公司官方定义的一套操作所有关系型数据库的规范，即接口。"><meta property="og:type" content="article"><meta property="og:url" content="https://wqnm1gb.github.io/posts/day06java%E6%93%8D%E4%BD%9C%E6%95%B0%E6%8D%AE%E5%BA%93/"><meta property="og:image" content="https://wqnm1gb.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-03-06T10:04:18+08:00"><meta property="article:modified_time" content="2025-03-06T10:04:18+08:00"><meta property="og:site_name" content="三狗子的博客"><meta property="fb:admins" content="your-facebook-admin-id"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://wqnm1gb.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Day06 Java操作数据库","item":"https://wqnm1gb.github.io/posts/day06java%E6%93%8D%E4%BD%9C%E6%95%B0%E6%8D%AE%E5%BA%93/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Day06 Java操作数据库","name":"Day06 Java操作数据库","description":" JDBC介绍 JDBC：（Java DataBase Connectivity），就是使用Java语言操作关系型数据库的一套API。\n本质：\n• sun公司官方定义的一套操作所有关系型数据库的规范，即接口。\n","keywords":["java Web"],"articleBody":" JDBC介绍 JDBC：（Java DataBase Connectivity），就是使用Java语言操作关系型数据库的一套API。\n本质：\n• sun公司官方定义的一套操作所有关系型数据库的规范，即接口。\n• 各个数据库厂商去实现这套接口，提供数据库驱动jar包。\n• 我们可以使用这套接口（JDBC）编程，真正执行的代码是驱动jar包中的实现类。\nJDBC入门程序 例子：更新数据库中的内容\n@Test public void testJdbc() throws Exception { // 1 注册驱动 这个是固定的 Class.forName(\"com.mysql.cj.jdbc.Driver\"); // 2 获取连接 String url = \"jdbc:mysql://localhost:3306/web01\"; String user = \"root\"; String password = \"wsnbb1234\"; Connection connection = DriverManager.getConnection(url, user, password); // 3 获取SQL语句执行对象 statement对象才能执行SQL语句 Statement statement = connection.createStatement(); // 4 执行SQL语句 这里边的i是用来收取影响的行数 int i =statement.executeUpdate(\"update user set age = 25 where id = 1\"); // 5 释放资源 statement.close(); connection.close(); } 注册驱动相当于告知应用程序是那一套jdbc的实现\nJDBC查询数据 需求：基于JDBC执行如下select语句，将查询结果封装到User对象中。\nSQL:select * from user where username = ‘daqiao’and password = ‘123456’\n执行查询语句之后会返回一个结果集对象：\nResultSet（结果集对象）：ResultSet rs = statement.executeQuery（）\nnext（）：将光标从当前位置向前移动一行，并判断当前行是否为有效行，返回值为boolean。 true：有效行，当前行有数据 false：无效行，当前行没有数据 getXxx（..）：获取数据，可以根据列的编号获取，也可以根据列名获取（推荐）。 while (resultSet.next()) { int id = resultSet.getInt(\"id\"); //...省略 } prepareStatement可以为占位符赋值的SQL语句执行对象\n占位符的起始是从1开始的\n@Test public void testQuery() throws Exception { // 获取连接 Connection conn = DriverManager.getConnection(\"jdbc:mysql://localhost:3306/web01\", \"root\", \"wsnbb1234\"); // 创建预编译的PreparedStatement对象 PreparedStatement pstmt = conn.prepareStatement(\"SELECT * FROM user WHERE username = ? AND password = ?\"); // 设置参数 pstmt.setString(1, \"daqiao\"); // 第一个问号对应的参数 pstmt.setString(2, \"123456\"); // 第二个问号对应的参数 // 执行查询 ResultSet rs = pstmt.executeQuery(); // 处理结果集 while (rs.next()) { int id = rs.getInt(\"id\"); String uName = rs.getString(\"username\"); String pwd = rs.getString(\"password\"); String name = rs.getString(\"name\"); int age = rs.getInt(\"age\"); System.out.println(\"ID: \" + id + \", Username: \" + uName + \", Password: \" + pwd + \", Name: \" + name + \", Age: \" + age); } // 关闭资源 rs.close(); pstmt.close(); conn.close(); } 预编译SQL 静态SQL（参数预编码）\nStatement statement = connection.createStatement(); int i = statement.executeUpdate(\"update user set age = 25 where id = 1\"); System.out.println(\"SQL执行完毕, 影响的记录数为: \" + i); 预编译SQL（参数动态传递）\nPreparedStatement pstmt = conn.prepareStatement(\"SELECT * FROM user WHERE username = ? AND password = ?\"); pstmt.setString(1, \"daqiao\"); pstmt.setString(2, \"123456\"); ResultSet resultSet = pstmt.executeQuery(); 优势 1、可以防止SQL注入，更安全\nSQL注入：通过控制输入来修改事先定义好的SQL语句，以达到执行代码对服务器进行攻击的方法。\n2、性能高\nMybatis Mybatis入门程序 配置连接信息\n#数据库访问的url地址 spring.datasource.url=jdbc:mysql://localhost:3306/web01 #数据库驱动类类名 spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver #访问数据库-用户名 spring.datasource.username=root #访问数据库-密码 spring.datasource.password=wsnbb1234 编写Mybatis程序：编写Mybatis的持久层接口，定义SQL语句（注解）\n在创建出来的springboot工程中，在引导类所在包下，在创建一个包 mapper。\nUserMapper，这是一个持久层接口（Mybatis的持久层接口规范一般都叫 XxxMapper）。\nUserMapper接口的内容如下： 包下创建一个接口\nimport com.itheima.pojo.User; import org.apache.ibatis.annotations.Mapper; import org.apache.ibatis.annotations.Select; import java.util.List; @Mapper public interface UserMapper { /** * 查询全部 */ @Select(\"select * from user\") public List\u003cUser\u003e findAll(); } 注解说明：\n@Mapper注解：表示是mybatis中的Mapper接口 程序运行时，框架会自动生成接口的实现类对象（代理对象），并给交Spring的IOC容器管理\n@Select注解：代表的就是select查询，用于书写select查询语句 单元测试\n在创建出来的SpringBoot工程中，在src下的test目录下，已经自动帮我们创建好了测试类，并且在测试类上已经添加了注解 @SpringBootTest，代表该测试类已经与SpringBoot整合。\n该测试类在运行时，会自动通过引导类加载Spring的环境（IOC容器）。我们要测试那个bean对象，就可以直接通过@Autowired 注解直接将其注入进行，然后就可以测试了。\n这里一定要注意IOC容器的生效的地方，要想生效，还需要被组件扫描注解@ComponentScan扫描。\n该注解虽然没有显式配置，但是实际上已经包含在了启动类声明注解@SpringBootAppljcatjon 中，默认扫描的范围是启动类所在包及其子包。 @SpringBootTest class SpringbootMybatisQuickstartApplicationTests { @Autowired private UserMapper userMapper; @Test public void testFindAll(){ List\u003cUser\u003e userList = userMapper.findAll(); for (User user : userList) { System.out.println(user); } } } 辅助配置-配置Mybatis的日志输出 默认情况下，在Mybatis中，SQL语句执行时，我们并看不到SQL语句的执行日志。加入如下配置，即可查看日志：\n#mybatis的配置mybatis.configuration.log-impl=org.apache.ibatis.logging.stdout.StdOutImpl JDBC vs Mybatis Mybatis解决硬编码：把连接数据库的信息放置在单独的配置文件中，不用改java代码，改java代码需要重新编译，改配置文件不需要\nMybatis解决获取资源繁琐：自动会解析数据到对象中\nMybatis解决频繁连接，释放连接，资源浪费性能降低：用到了数据库连接池\n数据库连接池 数据库连接池是个容器，负责分配、管理数据库连接（Connection）。 它允许应用程序重复使用一个现有的数据库连接，而不是再重新建立一个。 释放空闲时间超过最大空闲时间的连接，来避免因为没有释放连接而引起的数据库连接遗漏。（数据库连接池会检测客户端连接的空闲时间，如果空闲时间超过了规定的最大空闲时间，会让连接归还给数据库连接池，解决数据库连接遗漏的问题） 优势：\n资源重用 提升系统响应速度 避免数据库连接遗漏 标准接口：DataSource\n官方（sun）提供的数据库连接池接口，由第三方组织实现此接口（一定要实现） 功能：获取连接 Connection getConnection（） throws SQLException； 后两个是比较常用的\nDruid（德鲁伊）\nDruid连接池是阿里巴巴开源的数据库连接池项目 功能强大，性能优秀，是Java语言最好的数据库连接池之一 使用方法：\n在pro.xml中引入依赖\n\u003cdependency\u003e \u003cgroupId\u003ecom.alibaba\u003c/groupId\u003e \u003cartifactId\u003edruid-spring-boot-starter\u003c/artifactId\u003e \u003cversion\u003e1.2.19\u003c/version\u003e \u003c/dependency\u003e 在application.properties中配置数据库连接：\nspring.datasource.type=com.alibaba.druid.pool.DruidDataSource spring.datasource.druid.driver-class-name=com.mysql.cj.jdbc.Driver spring.datasource.druid.url=jdbc:mysql://localhost:3306/web spring.datasource.druid.username=root spring.datasource.druid.password=1234 Delete操作 Mapper接口：\n@Delete(\"delete from user where id = #{id}\") public Integer deleteById(Integer id); DML语句执行完毕的返回值，表示该DML语句执行完毕影响的行数。\n里边的#{id}会用id来替换（名字要一样，并不是根据名字的，而是只有一个正好数目匹配上了）\n#{id}这个会被替换成? 符合预编译SQL的优势\n符号 说明 场景 优缺点 #{…} 占位符。执行时，会将#{…}替换为?，生成预编译SQL 参数值传递 安全、性能高 （推荐） ${…} 拼接符。直接将参数拼接在SQL语句中，存在SQL注入问题 表名、字段名动态设置时使用 不安全、性能低 ${…}用的很少，是拼接的SQL\n@Delete(\"delete from dept where id = #{id}\") @Select(\"select id,name,score from ${tableName} order by ${sortField}\") Insert操作 Mapper接口：\n@Insert(\"insert into user(username,password,name,age) values(#{username},#{password},#{name},#{age})\") public void insert(User user); 用$替换#可能会报错，原因是：将 #{} 改为 ${} 后，MyBatis 不再使用预处理语句，而是直接将参数值拼接到 SQL 语句中，这可能会导致 SQL语法错误\n使用对象的方式插入，里边写的是对象的属性名而不是表中字段名\n主键是自增的，如果之前的号码使用过，即使是删除了（4，5），这些号码（4，5）还是不会重复使用，会从一个没用过的开始自增（6）\nUpdate操作 Mapper接口：\n@Update(\"update user set username=#{username}, password=#{password}, name=#{name}, age=#{age} where id=#{id}\") public void update(User user); Select操作 Mapper接口：\n@Select(\"select * from user where username=#{username} and password=#{password}\") public User findByUsernameAndPassword(@Param(\"username\") String username, @Param(\"password\") String password); 不止一个参数的时候，需要为形参取名字用@Param\n@Param注解的作用是为接口的方法形参起名字的\n#{}里写的是为Param为这个参数起的名字\n基于springboot官方骨架创建出来的项目在pom.xml里边都会有一个父工程，接口编译时会保留方法形参名， @Param注解可以省略\n**查询操作有返回值，一定要把返回值接收 **\nXML映射配置 在Mybatis中，既可以通过注解配置SQL语句，也可以通过XML配置文件配置SQL语句。\n默认规则：\nXML映射文件的名称与Mapper接口名称一致，并且将XML映射文件和Mapper接口放置在相同包下（同包同名）。 XML映射文件的namespace属性为Mapper接口全限定名一致。 XML映射文件中Sq1语句的id与Mapper 接口中的方法名一致，并保持返回类型一致。 xml中的id属性值是这个SQL语句的唯一标识，并且属性值要和方法名保持一致\nresources下的目录不能用.分隔，因为不是包，只是普通的目录需要用/分隔 编写xml文件中的映射文件，xml映射文件中的dtd约束，直接从mybatis官网复制即可; 或者直接AI生成\n\u003c?xml version=\"1.0\" encoding=\"UTF-8\" ?\u003e \u003c!DOCTYPE mapper PUBLIC \"-//mybatis.org//DTD Mapper 3.0//EN\" \"https://mybatis.org/dtd/mybatis-3-mapper.dtd\"\u003e \u003cmapper namespace=\"\"\u003e \u003c/mapper\u003e result type 指的是查询返回的单条语句往哪里进行封装，是单条，不是List集合，而是User对象\n二选一定义，要么基于注解，要么基于xml\n使用Mybatis的注解，主要是来完成一些简单的增删改查功能。如果需要实现复杂的SQL功能，建议使用XML来配置映射语句。\nSpringBoot配置文件 SpringBoot项目提供了多种属性配置方式（properties、yaml、yml）\n一般使用yml格式\nyml配置文件 格式：\n数值前边必须有空格，作为分隔符 使用缩进表示层级关系，缩进时，不允许使用Tab键，只能用空格（idea中会自动将Tab转换为空格） 缩进的空格数目不重要，只要相同层级的元素左侧对齐即可 ＃ 表示注释，从这个字符一直到行尾，都会被解析器忽略 在yml格式的配置文件中，如果配置项的值是以0开头的，值需要使用’‘引起来，因为以0开头在yml中表示8进制的数据。\n定义对象/Map集合：\nuser: name: 张三 age: 18 password: 123456 定义数组/List/Set集合：\nhobby: - java - game - sport spring: application: name: springboot-mybatis-quickstar datasource: type: com.alibaba.druid.pool.DruidDataSource url: jdbc:mysql://localhost:3306/web01 username: root password: wsnbb1234 mybatis: configuration: log-impl: org.apache.ibatis.logging.stdout.StdOutImpl ","wordCount":"3896","inLanguage":"zh","image":"https://wqnm1gb.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E","datePublished":"2025-03-06T10:04:18+08:00","dateModified":"2025-03-06T10:04:18+08:00","author":{"@type":"Person","name":"冷漠三狗子丶"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://wqnm1gb.github.io/posts/day06java%E6%93%8D%E4%BD%9C%E6%95%B0%E6%8D%AE%E5%BA%93/"},"publisher":{"@type":"Organization","name":"三狗子的博客","logo":{"@type":"ImageObject","url":"https://wqnm1gb.github.io/images/favicon.png"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://wqnm1gb.github.io/ accesskey=h title="主页 (Alt + H)"><img src=https://wqnm1gb.github.io/apple-touch-icon.png alt aria-label=logo height=35>主页</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://wqnm1gb.github.io/ title=三狗子的博客><span>首页</span></a></li><li><a href=https://wqnm1gb.github.io/archives/ title=归档><span>归档</span></a></li><li><a href=https://wqnm1gb.github.io/categories/ title=Categories><span>分类</span></a></li><li><a href=https://wqnm1gb.github.io/tags/ title=Tags><span>标签</span></a></li><li><a href=https://wqnm1gb.github.io/search/ title=搜索><span>搜索</span></a></li><li><a href=https://wqnm1gb.github.io/about/ title=关于><span>关于</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://wqnm1gb.github.io/>主页</a>&nbsp;»&nbsp;<a href=https://wqnm1gb.github.io/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Day06 Java操作数据库</h1><div class=post-meta><span title='2025-03-06 10:04:18 +0800 +0800'>三月 6, 2025</span>&nbsp;·&nbsp;8 分钟&nbsp;·&nbsp;3896 字&nbsp;·&nbsp;冷漠三狗子丶</div></header><div class=post-content><p><img loading=lazy src=/images/Day06Java%e6%93%8d%e4%bd%9c%e6%95%b0%e6%8d%ae%e5%ba%93.assets/1732677227599-0381eba1-2488-49b4-bc90-da0c210c5184-20250224204816892.png alt></p><h1 id=jdbc介绍>JDBC介绍<a hidden class=anchor aria-hidden=true href=#jdbc介绍>#</a></h1><p>JDBC：（Java DataBase Connectivity），就是使用Java语言操作关系型数据库的一套API。</p><p><img loading=lazy src=/images/Day06Java%e6%93%8d%e4%bd%9c%e6%95%b0%e6%8d%ae%e5%ba%93.assets/1732677291127-ec2b62db-0dd9-4bc3-975b-d5ecede913a0-20250224204828000.png alt></p><p><img loading=lazy src=/images/Day06Java%e6%93%8d%e4%bd%9c%e6%95%b0%e6%8d%ae%e5%ba%93.assets/1732677303807-db1a055a-36a9-4140-a5d5-fa7476415b9a-20250224204830135.png alt></p><p>本质：</p><p>• sun公司官方定义的一套操作所有关系型数据库的规范，即接口。</p><p>• 各个数据库厂商去实现这套接口，提供数据库驱动jar包。</p><p>• 我们可以使用这套接口（JDBC）编程，真正执行的代码是驱动jar包中的实现类。</p><h2 id=jdbc入门程序>JDBC入门程序<a hidden class=anchor aria-hidden=true href=#jdbc入门程序>#</a></h2><p><strong>例子：更新数据库中的内容</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=w>  </span><span class=o>@</span><span class=n>Test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>public</span><span class=w> </span><span class=n>void</span><span class=w> </span><span class=n>testJdbc</span><span class=p>()</span><span class=w> </span><span class=n>throws</span><span class=w> </span><span class=k>Exception</span><span class=w> </span><span class=err>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=o>//</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=err>注册驱动</span><span class=w> </span><span class=err>这个是固定的</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>Class</span><span class=p>.</span><span class=n>forName</span><span class=p>(</span><span class=s2>&#34;com.mysql.cj.jdbc.Driver&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=o>//</span><span class=w> </span><span class=mi>2</span><span class=w> </span><span class=err>获取连接</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>url</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&#34;jdbc:mysql://localhost:3306/web01&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&#34;root&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>password</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&#34;wsnbb1234&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>Connection</span><span class=w> </span><span class=k>connection</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>DriverManager</span><span class=p>.</span><span class=n>getConnection</span><span class=p>(</span><span class=n>url</span><span class=p>,</span><span class=w> </span><span class=k>user</span><span class=p>,</span><span class=w> </span><span class=n>password</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=o>//</span><span class=w> </span><span class=mi>3</span><span class=w> </span><span class=err>获取</span><span class=n>SQL语句执行对象</span><span class=w> </span><span class=n>statement对象才能执行SQL语句</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>Statement</span><span class=w> </span><span class=k>statement</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>connection</span><span class=p>.</span><span class=n>createStatement</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=o>//</span><span class=w> </span><span class=mi>4</span><span class=w> </span><span class=err>执行</span><span class=n>SQL语句</span><span class=w> </span><span class=err>这里边的</span><span class=n>i是用来收取影响的行数</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nb>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=k>statement</span><span class=p>.</span><span class=n>executeUpdate</span><span class=p>(</span><span class=s2>&#34;update user set age = 25 where id = 1&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=o>//</span><span class=w> </span><span class=mi>5</span><span class=w> </span><span class=err>释放资源</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>statement</span><span class=p>.</span><span class=k>close</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>connection</span><span class=p>.</span><span class=k>close</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=err>}</span><span class=w>
</span></span></span></code></pre></div><p>注册驱动相当于告知应用程序是那一套jdbc的实现</p><h2 id=jdbc查询数据>JDBC查询数据<a hidden class=anchor aria-hidden=true href=#jdbc查询数据>#</a></h2><p>需求：基于JDBC执行如下select语句，将查询结果封装到User对象中。</p><p>SQL:select * from user where username = &lsquo;daqiao&rsquo;and password = &lsquo;123456&rsquo;</p><p>执行查询语句之后会返回一个结果集对象：</p><p>ResultSet（结果集对象）：ResultSet rs = statement.executeQuery（）</p><ul><li>next（）：将光标从当前位置向前移动一行，并判断当前行是否为有效行，返回值为boolean。<ul><li>true：有效行，当前行有数据</li><li>false：无效行，当前行没有数据</li></ul></li><li>getXxx（..）：获取数据，可以根据列的编号获取，也可以根据列名获取（推荐）。</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=n>resultSet</span><span class=p>.</span><span class=na>next</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>resultSet</span><span class=p>.</span><span class=na>getInt</span><span class=p>(</span><span class=s>&#34;id&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>//...省略</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>prepareStatement可以为占位符赋值的SQL语句执行对象</p><p>占位符的起始是从1开始的</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>@</span><span class=n>Test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>public</span><span class=w> </span><span class=n>void</span><span class=w> </span><span class=n>testQuery</span><span class=p>()</span><span class=w> </span><span class=n>throws</span><span class=w> </span><span class=k>Exception</span><span class=w> </span><span class=err>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=o>//</span><span class=w> </span><span class=err>获取连接</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>Connection</span><span class=w> </span><span class=n>conn</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>DriverManager</span><span class=p>.</span><span class=n>getConnection</span><span class=p>(</span><span class=s2>&#34;jdbc:mysql://localhost:3306/web01&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;root&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;wsnbb1234&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=o>//</span><span class=w> </span><span class=err>创建预编译的</span><span class=n>PreparedStatement对象</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>PreparedStatement</span><span class=w> </span><span class=n>pstmt</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>conn</span><span class=p>.</span><span class=n>prepareStatement</span><span class=p>(</span><span class=s2>&#34;SELECT * FROM user WHERE username = ? AND password = ?&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=o>//</span><span class=w> </span><span class=err>设置参数</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>pstmt</span><span class=p>.</span><span class=n>setString</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;daqiao&#34;</span><span class=p>);</span><span class=w> </span><span class=o>//</span><span class=w> </span><span class=err>第一个问号对应的参数</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>pstmt</span><span class=p>.</span><span class=n>setString</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;123456&#34;</span><span class=p>);</span><span class=w> </span><span class=o>//</span><span class=w> </span><span class=err>第二个问号对应的参数</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=o>//</span><span class=w> </span><span class=err>执行查询</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>ResultSet</span><span class=w> </span><span class=n>rs</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>pstmt</span><span class=p>.</span><span class=n>executeQuery</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=o>//</span><span class=w> </span><span class=err>处理结果集</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>while</span><span class=w> </span><span class=p>(</span><span class=n>rs</span><span class=p>.</span><span class=k>next</span><span class=p>())</span><span class=w> </span><span class=err>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nb>int</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>rs</span><span class=p>.</span><span class=n>getInt</span><span class=p>(</span><span class=s2>&#34;id&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>String</span><span class=w> </span><span class=n>uName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>rs</span><span class=p>.</span><span class=n>getString</span><span class=p>(</span><span class=s2>&#34;username&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>String</span><span class=w> </span><span class=n>pwd</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>rs</span><span class=p>.</span><span class=n>getString</span><span class=p>(</span><span class=s2>&#34;password&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>String</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>rs</span><span class=p>.</span><span class=n>getString</span><span class=p>(</span><span class=s2>&#34;name&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nb>int</span><span class=w> </span><span class=n>age</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>rs</span><span class=p>.</span><span class=n>getInt</span><span class=p>(</span><span class=s2>&#34;age&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>System</span><span class=p>.</span><span class=k>out</span><span class=p>.</span><span class=n>println</span><span class=p>(</span><span class=s2>&#34;ID: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s2>&#34;, Username: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>uName</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s2>&#34;, Password: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>pwd</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s2>&#34;, Name: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s2>&#34;, Age: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>age</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=err>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=o>//</span><span class=w> </span><span class=err>关闭资源</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>rs</span><span class=p>.</span><span class=k>close</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>pstmt</span><span class=p>.</span><span class=k>close</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>conn</span><span class=p>.</span><span class=k>close</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=err>}</span><span class=w>
</span></span></span></code></pre></div><h2 id=预编译sql>预编译SQL<a hidden class=anchor aria-hidden=true href=#预编译sql>#</a></h2><p>静态SQL（参数预编码）</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>Statement</span><span class=w> </span><span class=n>statement</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>connection</span><span class=p>.</span><span class=na>createStatement</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>statement</span><span class=p>.</span><span class=na>executeUpdate</span><span class=p>(</span><span class=s>&#34;update user set age = 25 where id = 1&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;SQL执行完毕, 影响的记录数为: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>i</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></div><p>预编译SQL（参数动态传递）</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>PreparedStatement</span><span class=w> </span><span class=n>pstmt</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>conn</span><span class=p>.</span><span class=na>prepareStatement</span><span class=p>(</span><span class=s>&#34;SELECT * FROM user WHERE username = ? AND password = ?&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>pstmt</span><span class=p>.</span><span class=na>setString</span><span class=p>(</span><span class=n>1</span><span class=p>,</span><span class=w> </span><span class=s>&#34;daqiao&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>pstmt</span><span class=p>.</span><span class=na>setString</span><span class=p>(</span><span class=n>2</span><span class=p>,</span><span class=w> </span><span class=s>&#34;123456&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>ResultSet</span><span class=w> </span><span class=n>resultSet</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>pstmt</span><span class=p>.</span><span class=na>executeQuery</span><span class=p>();</span><span class=w>
</span></span></span></code></pre></div><h3 id=优势>优势<a hidden class=anchor aria-hidden=true href=#优势>#</a></h3><p>1、可以防止SQL注入，更安全</p><p>SQL注入：通过控制输入来修改事先定义好的SQL语句，以达到执行代码对服务器进行攻击的方法。</p><p>2、性能高</p><p><img loading=lazy src=/images/Day06Java%e6%93%8d%e4%bd%9c%e6%95%b0%e6%8d%ae%e5%ba%93.assets/1732757223210-75979dc5-55c0-4caa-b258-b24206136703-20250224204848059.png alt></p><h1 id=mybatis>Mybatis<a hidden class=anchor aria-hidden=true href=#mybatis>#</a></h1><h2 id=mybatis入门程序>Mybatis入门程序<a hidden class=anchor aria-hidden=true href=#mybatis入门程序>#</a></h2><p><strong>配置连接信息</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=err>#</span><span class=n>数据库访问的url地址</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>spring</span><span class=p>.</span><span class=na>datasource</span><span class=p>.</span><span class=na>url</span><span class=o>=</span><span class=n>jdbc</span><span class=p>:</span><span class=n>mysql</span><span class=p>:</span><span class=c1>//localhost:3306/web01</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>#</span><span class=n>数据库驱动类类名</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>spring</span><span class=p>.</span><span class=na>datasource</span><span class=p>.</span><span class=na>driver</span><span class=o>-</span><span class=kd>class</span><span class=err>-</span><span class=nc>name</span><span class=o>=</span><span class=n>com</span><span class=p>.</span><span class=na>mysql</span><span class=p>.</span><span class=na>cj</span><span class=p>.</span><span class=na>jdbc</span><span class=p>.</span><span class=na>Driver</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>#</span><span class=n>访问数据库</span><span class=o>-</span><span class=n>用户名</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>spring</span><span class=p>.</span><span class=na>datasource</span><span class=p>.</span><span class=na>username</span><span class=o>=</span><span class=n>root</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>#</span><span class=n>访问数据库</span><span class=o>-</span><span class=n>密码</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>spring</span><span class=p>.</span><span class=na>datasource</span><span class=p>.</span><span class=na>password</span><span class=o>=</span><span class=n>wsnbb1234</span><span class=w>
</span></span></span></code></pre></div><p><strong>编写Mybatis程序：编写Mybatis的持久层接口，定义SQL语句（注解）</strong></p><p>在创建出来的springboot工程中，在引导类所在包下，在创建一个包 mapper。</p><p>UserMapper，这是一个持久层接口（Mybatis的持久层接口规范一般都叫 XxxMapper）。</p><p>UserMapper接口的内容如下： 包下创建一个接口</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>import</span><span class=w> </span><span class=nn>com.itheima.pojo.User</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.apache.ibatis.annotations.Mapper</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.apache.ibatis.annotations.Select</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.util.List</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Mapper</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>interface</span> <span class=nc>UserMapper</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 查询全部
</span></span></span><span class=line><span class=cl><span class=cm>     */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Select</span><span class=p>(</span><span class=s>&#34;select * from user&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>List</span><span class=o>&lt;</span><span class=n>User</span><span class=o>&gt;</span><span class=w> </span><span class=nf>findAll</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>注解说明：</p><ul><li>@Mapper注解：表示是mybatis中的Mapper接口</li></ul><p>程序运行时，框架会自动生成接口的实现类对象（代理对象），并给交Spring的IOC容器管理</p><ul><li>@Select注解：代表的就是select查询，用于书写select查询语句</li></ul><p><strong>单元测试</strong></p><p>在创建出来的SpringBoot工程中，在src下的test目录下，已经自动帮我们创建好了测试类，并且在测试类上已经添加了注解 @SpringBootTest，代表该测试类已经与SpringBoot整合。</p><p>该测试类在运行时，会自动通过引导类加载Spring的环境（IOC容器）。我们要测试那个bean对象，就可以直接通过@Autowired 注解直接将其注入进行，然后就可以测试了。</p><p><strong>这里一定要注意IOC容器的生效的地方，要想生效，还需要被组件扫描注解@ComponentScan扫描。</strong></p><p><strong>该注解虽然没有显式配置，但是实际上已经包含在了启动类声明注解@SpringBootAppljcatjon 中，默认扫描的范围是启动类所在包及其子包。</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@SpringBootTest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>class</span> <span class=nc>SpringbootMybatisQuickstartApplicationTests</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Autowired</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>UserMapper</span><span class=w> </span><span class=n>userMapper</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>testFindAll</span><span class=p>(){</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>List</span><span class=o>&lt;</span><span class=n>User</span><span class=o>&gt;</span><span class=w> </span><span class=n>userList</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>userMapper</span><span class=p>.</span><span class=na>findAll</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=n>User</span><span class=w> </span><span class=n>user</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>userList</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>user</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p><strong></strong></p><h2 id=辅助配置-配置mybatis的日志输出>辅助配置-配置Mybatis的日志输出<a hidden class=anchor aria-hidden=true href=#辅助配置-配置mybatis的日志输出>#</a></h2><p>默认情况下，在Mybatis中，SQL语句执行时，我们并看不到SQL语句的执行日志。加入如下配置，即可查看日志：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=err>#</span><span class=n>mybatis的配置mybatis</span><span class=p>.</span><span class=na>configuration</span><span class=p>.</span><span class=na>log</span><span class=o>-</span><span class=n>impl</span><span class=o>=</span><span class=n>org</span><span class=p>.</span><span class=na>apache</span><span class=p>.</span><span class=na>ibatis</span><span class=p>.</span><span class=na>logging</span><span class=p>.</span><span class=na>stdout</span><span class=p>.</span><span class=na>StdOutImpl</span><span class=w>
</span></span></span></code></pre></div><h2 id=jdbc-vs-mybatis>JDBC vs Mybatis<a hidden class=anchor aria-hidden=true href=#jdbc-vs-mybatis>#</a></h2><p><img loading=lazy src=/images/Day06Java%e6%93%8d%e4%bd%9c%e6%95%b0%e6%8d%ae%e5%ba%93.assets/1732841446177-7ca42e21-ed2f-4a4e-9589-88812e46e40d-20250224204855112.png alt></p><p>Mybatis解决硬编码：把连接数据库的信息放置在单独的配置文件中，不用改java代码，改java代码需要重新编译，改配置文件不需要</p><p>Mybatis解决获取资源繁琐：自动会解析数据到对象中</p><p>Mybatis解决频繁连接，释放连接，资源浪费性能降低：用到了数据库连接池</p><h2 id=数据库连接池>数据库连接池<a hidden class=anchor aria-hidden=true href=#数据库连接池>#</a></h2><ul><li>数据库连接池是个容器，负责分配、管理数据库连接（Connection）。</li><li>它允许应用程序重复使用一个现有的数据库连接，而不是再重新建立一个。</li><li>释放空闲时间超过最大空闲时间的连接，来避免因为没有释放连接而引起的数据库连接遗漏。（数据库连接池会检测客户端连接的空闲时间，如果空闲时间超过了规定的最大空闲时间，会让连接归还给数据库连接池，解决数据库连接遗漏的问题）</li></ul><p>优势：</p><ol><li>资源重用</li><li>提升系统响应速度</li><li>避免数据库连接遗漏</li></ol><p><img loading=lazy src=/images/Day06Java%e6%93%8d%e4%bd%9c%e6%95%b0%e6%8d%ae%e5%ba%93.assets/1732843347805-8267c11a-4bd3-4f65-ab99-99658ff12b48-20250224204858435.png alt>
<img loading=lazy src=/images/Day06Java%e6%93%8d%e4%bd%9c%e6%95%b0%e6%8d%ae%e5%ba%93.assets/1732843364275-f9437458-33e4-4a19-81df-accbf68adb69-20250224204917525.png alt></p><p>标准接口：DataSource</p><ul><li>官方（sun）提供的数据库连接池接口，由第三方组织实现此接口（一定要实现）</li><li>功能：获取连接 Connection getConnection（） throws SQLException；</li></ul><p><img loading=lazy src=/images/Day06Java%e6%93%8d%e4%bd%9c%e6%95%b0%e6%8d%ae%e5%ba%93.assets/1732843501162-668384f1-3c64-4920-b832-b0aec3de3ee6-20250224204921050.png alt></p><p>后两个是比较常用的</p><p>Druid（德鲁伊）</p><ul><li>Druid连接池是阿里巴巴开源的数据库连接池项目</li><li>功能强大，性能优秀，是Java语言最好的数据库连接池之一</li></ul><p>使用方法：</p><p>在pro.xml中引入依赖</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=o>&lt;</span><span class=n>dependency</span><span class=o>&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>&lt;!--</span><span class=w> </span><span class=n>Druid连接池依赖</span><span class=w> </span><span class=o>--&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>&lt;</span><span class=n>groupId</span><span class=o>&gt;</span><span class=n>com</span><span class=p>.</span><span class=na>alibaba</span><span class=o>&lt;/</span><span class=n>groupId</span><span class=o>&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>&lt;</span><span class=n>artifactId</span><span class=o>&gt;</span><span class=n>druid</span><span class=o>-</span><span class=n>spring</span><span class=o>-</span><span class=n>boot</span><span class=o>-</span><span class=n>starter</span><span class=o>&lt;/</span><span class=n>artifactId</span><span class=o>&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>&lt;</span><span class=n>version</span><span class=o>&gt;</span><span class=n>1</span><span class=p>.</span><span class=na>2</span><span class=p>.</span><span class=na>19</span><span class=o>&lt;/</span><span class=n>version</span><span class=o>&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>&lt;/</span><span class=n>dependency</span><span class=o>&gt;</span><span class=w>
</span></span></span></code></pre></div><p>在<code>application.properties</code>中配置数据库连接：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>spring</span><span class=p>.</span><span class=na>datasource</span><span class=p>.</span><span class=na>type</span><span class=o>=</span><span class=n>com</span><span class=p>.</span><span class=na>alibaba</span><span class=p>.</span><span class=na>druid</span><span class=p>.</span><span class=na>pool</span><span class=p>.</span><span class=na>DruidDataSource</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>spring</span><span class=p>.</span><span class=na>datasource</span><span class=p>.</span><span class=na>druid</span><span class=p>.</span><span class=na>driver</span><span class=o>-</span><span class=kd>class</span><span class=err>-</span><span class=nc>name</span><span class=o>=</span><span class=n>com</span><span class=p>.</span><span class=na>mysql</span><span class=p>.</span><span class=na>cj</span><span class=p>.</span><span class=na>jdbc</span><span class=p>.</span><span class=na>Driver</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>spring</span><span class=p>.</span><span class=na>datasource</span><span class=p>.</span><span class=na>druid</span><span class=p>.</span><span class=na>url</span><span class=o>=</span><span class=n>jdbc</span><span class=p>:</span><span class=n>mysql</span><span class=p>:</span><span class=c1>//localhost:3306/web</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>spring</span><span class=p>.</span><span class=na>datasource</span><span class=p>.</span><span class=na>druid</span><span class=p>.</span><span class=na>username</span><span class=o>=</span><span class=n>root</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>spring</span><span class=p>.</span><span class=na>datasource</span><span class=p>.</span><span class=na>druid</span><span class=p>.</span><span class=na>password</span><span class=o>=</span><span class=n>1234</span><span class=w>
</span></span></span></code></pre></div><h2 id=delete操作>Delete操作<a hidden class=anchor aria-hidden=true href=#delete操作>#</a></h2><p>Mapper接口：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Delete</span><span class=p>(</span><span class=s>&#34;delete from user where id = #{id}&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=n>Integer</span><span class=w> </span><span class=nf>deleteById</span><span class=p>(</span><span class=n>Integer</span><span class=w> </span><span class=n>id</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></div><p>DML语句执行完毕的返回值，表示该DML语句执行完毕影响的行数。</p><p>里边的#{id}会用id来替换（<del>名字要一样</del>，并不是根据名字的，而是只有一个正好数目匹配上了）</p><p>#{id}这个会被替换成? 符合预编译SQL的优势</p><table><thead><tr><th style=text-align:center><strong>符号</strong></th><th style=text-align:center><strong>说明</strong></th><th style=text-align:center><strong>场景</strong></th><th style=text-align:center><strong>优缺点</strong></th></tr></thead><tbody><tr><td style=text-align:center>#{…}</td><td style=text-align:center>占位符。执行时，会将#{…}替换为?，生成预编译SQL</td><td style=text-align:center>参数值传递</td><td style=text-align:center>安全、性能高 （推荐）</td></tr><tr><td style=text-align:center>${…}</td><td style=text-align:center>拼接符。直接将参数拼接在SQL语句中，存在SQL注入问题</td><td style=text-align:center>表名、字段名动态设置时使用</td><td style=text-align:center>不安全、性能低</td></tr></tbody></table><p>${&mldr;}用的很少，是拼接的SQL</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Delete</span><span class=p>(</span><span class=s>&#34;delete from dept where id = #{id}&#34;</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Select</span><span class=p>(</span><span class=s>&#34;select id,name,score from ${tableName} order by ${sortField}&#34;</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></div><h2 id=insert操作>Insert操作<a hidden class=anchor aria-hidden=true href=#insert操作>#</a></h2><p>Mapper接口：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Insert</span><span class=p>(</span><span class=s>&#34;insert into user(username,password,name,age) values(#{username},#{password},#{name},#{age})&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>insert</span><span class=p>(</span><span class=n>User</span><span class=w> </span><span class=n>user</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></div><p>用$替换#可能会报错，原因是：将 <code>&lt;font style="color:rgb(6, 6, 7);">#{}&lt;/font></code> 改为 <code>&lt;font style="color:rgb(6, 6, 7);">${}&lt;/font></code> 后，MyBatis 不再使用预处理语句，而是直接将参数值拼接到 SQL 语句中，这可能会导致 SQL语法错误</p><p></p><p>使用对象的方式插入，里边写的是对象的属性名而不是表中字段名</p><p>主键是自增的，如果之前的号码使用过，即使是删除了（4，5），这些号码（4，5）还是不会重复使用，会从一个没用过的开始自增（6）</p><h2 id=update操作>Update操作<a hidden class=anchor aria-hidden=true href=#update操作>#</a></h2><p>Mapper接口：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Update</span><span class=p>(</span><span class=s>&#34;update user set username=#{username}, password=#{password}, name=#{name}, age=#{age} where id=#{id}&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>update</span><span class=p>(</span><span class=n>User</span><span class=w> </span><span class=n>user</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></div><h2 id=select操作>Select操作<a hidden class=anchor aria-hidden=true href=#select操作>#</a></h2><p>Mapper接口：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Select</span><span class=p>(</span><span class=s>&#34;select * from user where username=#{username} and password=#{password}&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=n>User</span><span class=w> </span><span class=nf>findByUsernameAndPassword</span><span class=p>(</span><span class=nd>@Param</span><span class=p>(</span><span class=s>&#34;username&#34;</span><span class=p>)</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>username</span><span class=p>,</span><span class=w> </span><span class=nd>@Param</span><span class=p>(</span><span class=s>&#34;password&#34;</span><span class=p>)</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>password</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></div><p>不止一个参数的时候，需要为形参取名字用@Param</p><p>@Param注解的作用是为接口的方法形参起名字的</p><p>#{}里写的是为Param为这个参数起的名字</p><p>基于springboot官方骨架创建出来的项目在pom.xml里边都会有一个父工程，接口编译时会保留方法形参名， @Param注解可以省略</p><p>**查询操作有返回值，一定要把返回值接收 **</p><hr><h2 id=xml映射配置>XML映射配置<a hidden class=anchor aria-hidden=true href=#xml映射配置>#</a></h2><p>在Mybatis中，既可以通过注解配置SQL语句，也可以通过XML配置文件配置SQL语句。</p><p>默认规则：</p><ol><li>XML映射文件的名称与Mapper接口名称一致，并且将XML映射文件和Mapper接口放置在相同包下（同包同名）。</li><li>XML映射文件的namespace属性为Mapper接口全限定名一致。</li><li>XML映射文件中Sq1语句的id与Mapper 接口中的方法名一致，并保持返回类型一致。</li></ol><p><img loading=lazy src=/images/Day06Java%e6%93%8d%e4%bd%9c%e6%95%b0%e6%8d%ae%e5%ba%93.assets/1733100300040-60f8f3ac-a404-4a09-b1f2-5b9ac4377303-20250224204932158.png alt>
<img loading=lazy src=/images/Day06Java%e6%93%8d%e4%bd%9c%e6%95%b0%e6%8d%ae%e5%ba%93.assets/1733100491981-0d071354-9a8d-4809-b599-300d5d616aae-20250224204937474.png alt></p><p>xml中的id属性值是这个SQL语句的唯一标识，并且属性值要和方法名保持一致</p><p>resources下的目录不能用.分隔，因为不是包，只是普通的目录需要用/分隔</p><p></p><p>编写xml文件中的映射文件，xml映射文件中的dtd约束，直接从mybatis官网复制即可; 或者直接AI生成</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=o>&lt;?</span><span class=n>xml</span><span class=w> </span><span class=n>version</span><span class=o>=</span><span class=s>&#34;1.0&#34;</span><span class=w> </span><span class=n>encoding</span><span class=o>=</span><span class=s>&#34;UTF-8&#34;</span><span class=w> </span><span class=o>?&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>&lt;!</span><span class=n>DOCTYPE</span><span class=w> </span><span class=n>mapper</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>PUBLIC</span><span class=w> </span><span class=s>&#34;-//mybatis.org//DTD Mapper 3.0//EN&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=s>&#34;https://mybatis.org/dtd/mybatis-3-mapper.dtd&#34;</span><span class=o>&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>&lt;</span><span class=n>mapper</span><span class=w> </span><span class=n>namespace</span><span class=o>=</span><span class=s>&#34;&#34;</span><span class=o>&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>&lt;/</span><span class=n>mapper</span><span class=o>&gt;</span><span class=w>
</span></span></span></code></pre></div><p>result type 指的是查询返回的单条语句往哪里进行封装，是单条，不是List集合，而是User对象</p><p>二选一定义，要么基于注解，要么基于xml</p><p>使用Mybatis的注解，主要是来完成一些<strong>简单的</strong>增删改查功能。如果需要实现<strong>复杂的SQL功能</strong>，建议使用XML来配置映射语句。</p><h1 id=springboot配置文件>SpringBoot配置文件<a hidden class=anchor aria-hidden=true href=#springboot配置文件>#</a></h1><p>SpringBoot项目提供了多种属性配置方式（properties、yaml、yml）</p><p><img loading=lazy src=/images/Day06Java%e6%93%8d%e4%bd%9c%e6%95%b0%e6%8d%ae%e5%ba%93.assets/1733101274503-88c11b89-3279-4ac1-ae26-77fcef871700-20250224204943522.png alt></p><p>一般使用yml格式</p><h2 id=yml配置文件>yml配置文件<a hidden class=anchor aria-hidden=true href=#yml配置文件>#</a></h2><p>格式：</p><ul><li><strong>数值前边</strong>必须有<strong>空格</strong>，作为分隔符</li><li>使用<strong>缩进表示</strong>层级关系，缩进时，不允许使用Tab键，只能用空格（idea中会自动将Tab转换为空格）</li><li>缩进的空格数目不重要，只要<strong>相同层级的元素</strong>左侧对齐即可</li><li>＃ 表示注释，从这个字符一直到行尾，都会被解析器忽略</li></ul><p>在yml格式的配置文件中，如果配置项的值是<strong>以0开头的</strong>，值需要使用&rsquo;&lsquo;引起来，因为以0开头在yml中表示8进制的数据。</p><p>定义对象/Map集合：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nl>user</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>name</span><span class=p>:</span><span class=w> </span><span class=n>张三</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>age</span><span class=p>:</span><span class=w> </span><span class=n>18</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>password</span><span class=p>:</span><span class=w> </span><span class=n>123456</span><span class=w>
</span></span></span></code></pre></div><p>定义数组/List/Set集合：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nl>hobby</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>-</span><span class=w> </span><span class=n>java</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>-</span><span class=w> </span><span class=n>game</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>-</span><span class=w> </span><span class=n>sport</span><span class=w>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nl>spring</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>application</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>name</span><span class=p>:</span><span class=w> </span><span class=n>springboot</span><span class=o>-</span><span class=n>mybatis</span><span class=o>-</span><span class=n>quickstar</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>datasource</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>type</span><span class=p>:</span><span class=w> </span><span class=n>com</span><span class=p>.</span><span class=na>alibaba</span><span class=p>.</span><span class=na>druid</span><span class=p>.</span><span class=na>pool</span><span class=p>.</span><span class=na>DruidDataSource</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>url</span><span class=p>:</span><span class=w> </span><span class=n>jdbc</span><span class=p>:</span><span class=n>mysql</span><span class=p>:</span><span class=c1>//localhost:3306/web01</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>username</span><span class=p>:</span><span class=w> </span><span class=n>root</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>password</span><span class=p>:</span><span class=w> </span><span class=n>wsnbb1234</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nl>mybatis</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>configuration</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>log</span><span class=o>-</span><span class=n>impl</span><span class=p>:</span><span class=w> </span><span class=n>org</span><span class=p>.</span><span class=na>apache</span><span class=p>.</span><span class=na>ibatis</span><span class=p>.</span><span class=na>logging</span><span class=p>.</span><span class=na>stdout</span><span class=p>.</span><span class=na>StdOutImpl</span><span class=w>
</span></span></span></code></pre></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://wqnm1gb.github.io/tags/java-web/>Java Web</a></li></ul><nav class=paginav><a class=prev href=https://wqnm1gb.github.io/posts/day07%E5%90%8E%E7%AB%AFweb%E5%AE%9E%E6%88%98%E9%83%A8%E9%97%A8%E7%AE%A1%E7%90%86/><span class=title>« 上一页</span><br><span>Day07 后端Web实战（部门管理）</span>
</a><a class=next href=https://wqnm1gb.github.io/posts/day05mysql%E6%95%B0%E6%8D%AE%E5%BA%93/><span class=title>下一页 »</span><br><span>Day05 MySQL数据库</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://wqnm1gb.github.io/>三狗子的博客</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="复制";function s(){t.innerHTML="已复制！",setTimeout(()=>{t.innerHTML="复制"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>