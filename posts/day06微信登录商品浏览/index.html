<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Day06 微信登录、商品浏览 | 三狗子的博客</title>
<meta name=keywords content="苍穹外卖"><meta name=description content='HttpClient
阿里云里边会包括httpclient这个依赖
发送GET请求


1、创建httpclient对象
CloseableHttpClient httpClient = HttpClients.createDefault();
2、创建请求对象
CloseableHttpResponse response = httpClient.execute(httpGet);
3、发送请求，接收响应结果
  @Test
    public void testGet() throws IOException {
        // 创建httpclient对象
        CloseableHttpClient httpClient = HttpClients.createDefault();

        // 创建请求对象GET
        HttpGet httpGet = new HttpGet("http://localhost:8080/user/shop/status");
        
        // 发送请求
        CloseableHttpResponse response = httpClient.execute(httpGet);

        // 获取http响应码
        int statusCode = response.getStatusLine().getStatusCode();
        log.info("获取的响应码是{}",statusCode);
        
        // 获取http响应体
        HttpEntity entity = response.getEntity();
        // 将响应体转换为字符串，用到的是实体工具包
        String body = EntityUtils.toString(entity);
        log.info("获取的响应实体{}",body);

        // 关闭资源
        response.close();
        httpClient.close();


    }
发送POST请求
    @Test
    public void testPOST() throws Exception {
        // 创建httpclient对象
        CloseableHttpClient httpClient = HttpClients.createDefault();

        // 创建POST请求
        HttpPost httpPost = new HttpPost("http://localhost:8080/admin/employee/login");

        // 发送请求
        // 构造Json数据
        JSONObject jsonObject = new JSONObject();
        jsonObject.put("username","admin");
        jsonObject.put("password","123456");

        // 构造请求体
        StringEntity stringEntity = new StringEntity(jsonObject.toString());
        // 设置请求编码
        stringEntity.setContentEncoding("utf-8");
        // 设置数据类型
        stringEntity.setContentType("application/json");
        // 设置请求体。最后发送的是httpPost
        httpPost.setEntity(stringEntity);

        // 发送请求
        CloseableHttpResponse response = httpClient.execute(httpPost);
        // 获取响应码
        int statusCode = response.getStatusLine().getStatusCode();
        System.out.println(statusCode);
        // 获取响应体
        HttpEntity entity = response.getEntity();
        String string = EntityUtils.toString(entity);
        System.out.println(string);
        // 关闭资源
        response.close();
        httpClient.close();
    }
项目封装好了工具类
这个httpclient的作用是，给微信官方发去授权码，看是否能获得微信用户的唯一openid，来让小程序端能够正常的登录'><meta name=author content="冷漠三狗子丶"><link rel=canonical href=https://wqnm1gb.github.io/posts/day06%E5%BE%AE%E4%BF%A1%E7%99%BB%E5%BD%95%E5%95%86%E5%93%81%E6%B5%8F%E8%A7%88/><link crossorigin=anonymous href=/assets/css/stylesheet.3d688279d829dc24da48acd11f9e33ebea2f39c035e899e1bf4297d8b7aa89b9.css integrity="sha256-PWiCedgp3CTaSKzRH54z6+ovOcA16Jnhv0KX2Leqibk=" rel="preload stylesheet" as=style><link rel=icon href=https://wqnm1gb.github.io/images/favicon.png><link rel=icon type=image/png sizes=16x16 href=https://wqnm1gb.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://wqnm1gb.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://wqnm1gb.github.io/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://wqnm1gb.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh href=https://wqnm1gb.github.io/posts/day06%E5%BE%AE%E4%BF%A1%E7%99%BB%E5%BD%95%E5%95%86%E5%93%81%E6%B5%8F%E8%A7%88/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&display=swap" rel=stylesheet><script type=text/javascript async src="https://cdn.bootcss.com/mathjax/2.7.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML">MathJax.Hub.Config({tex2jax:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["[[","]]"]],processEscapes:!0,processEnvironments:!0,skipTags:["script","noscript","style","textarea","pre"],TeX:{equationNumbers:{autoNumber:"AMS"},extensions:["AMSmath.js","AMSsymbols.js"]}}}),MathJax.Hub.Queue(function(){var e,t=MathJax.Hub.getAllJax();for(e=0;e<t.length;e+=1)t[e].SourceElement().parentNode.className+=" has-jax"})</script><style>code.has-jax{font:inherit;font-size:100%;background:inherit;border:inherit;color:#515151}</style><meta property="og:title" content="Day06 微信登录、商品浏览"><meta property="og:description" content='HttpClient
阿里云里边会包括httpclient这个依赖
发送GET请求


1、创建httpclient对象
CloseableHttpClient httpClient = HttpClients.createDefault();
2、创建请求对象
CloseableHttpResponse response = httpClient.execute(httpGet);
3、发送请求，接收响应结果
  @Test
    public void testGet() throws IOException {
        // 创建httpclient对象
        CloseableHttpClient httpClient = HttpClients.createDefault();

        // 创建请求对象GET
        HttpGet httpGet = new HttpGet("http://localhost:8080/user/shop/status");
        
        // 发送请求
        CloseableHttpResponse response = httpClient.execute(httpGet);

        // 获取http响应码
        int statusCode = response.getStatusLine().getStatusCode();
        log.info("获取的响应码是{}",statusCode);
        
        // 获取http响应体
        HttpEntity entity = response.getEntity();
        // 将响应体转换为字符串，用到的是实体工具包
        String body = EntityUtils.toString(entity);
        log.info("获取的响应实体{}",body);

        // 关闭资源
        response.close();
        httpClient.close();


    }
发送POST请求
    @Test
    public void testPOST() throws Exception {
        // 创建httpclient对象
        CloseableHttpClient httpClient = HttpClients.createDefault();

        // 创建POST请求
        HttpPost httpPost = new HttpPost("http://localhost:8080/admin/employee/login");

        // 发送请求
        // 构造Json数据
        JSONObject jsonObject = new JSONObject();
        jsonObject.put("username","admin");
        jsonObject.put("password","123456");

        // 构造请求体
        StringEntity stringEntity = new StringEntity(jsonObject.toString());
        // 设置请求编码
        stringEntity.setContentEncoding("utf-8");
        // 设置数据类型
        stringEntity.setContentType("application/json");
        // 设置请求体。最后发送的是httpPost
        httpPost.setEntity(stringEntity);

        // 发送请求
        CloseableHttpResponse response = httpClient.execute(httpPost);
        // 获取响应码
        int statusCode = response.getStatusLine().getStatusCode();
        System.out.println(statusCode);
        // 获取响应体
        HttpEntity entity = response.getEntity();
        String string = EntityUtils.toString(entity);
        System.out.println(string);
        // 关闭资源
        response.close();
        httpClient.close();
    }
项目封装好了工具类
这个httpclient的作用是，给微信官方发去授权码，看是否能获得微信用户的唯一openid，来让小程序端能够正常的登录'><meta property="og:type" content="article"><meta property="og:url" content="https://wqnm1gb.github.io/posts/day06%E5%BE%AE%E4%BF%A1%E7%99%BB%E5%BD%95%E5%95%86%E5%93%81%E6%B5%8F%E8%A7%88/"><meta property="og:image" content="https://wqnm1gb.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-03-20T11:07:28+08:00"><meta property="article:modified_time" content="2025-03-20T11:07:28+08:00"><meta property="og:site_name" content="三狗子的博客"><meta property="fb:admins" content="your-facebook-admin-id"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://wqnm1gb.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Day06 微信登录、商品浏览","item":"https://wqnm1gb.github.io/posts/day06%E5%BE%AE%E4%BF%A1%E7%99%BB%E5%BD%95%E5%95%86%E5%93%81%E6%B5%8F%E8%A7%88/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Day06 微信登录、商品浏览","name":"Day06 微信登录、商品浏览","description":"HttpClient 阿里云里边会包括httpclient这个依赖\n发送GET请求 1、创建httpclient对象\nCloseableHttpClient httpClient = HttpClients.createDefault(); 2、创建请求对象\nCloseableHttpResponse response = httpClient.execute(httpGet); 3、发送请求，接收响应结果\n@Test public void testGet() throws IOException { // 创建httpclient对象 CloseableHttpClient httpClient = HttpClients.createDefault(); // 创建请求对象GET HttpGet httpGet = new HttpGet(\u0026#34;http://localhost:8080/user/shop/status\u0026#34;); // 发送请求 CloseableHttpResponse response = httpClient.execute(httpGet); // 获取http响应码 int statusCode = response.getStatusLine().getStatusCode(); log.info(\u0026#34;获取的响应码是{}\u0026#34;,statusCode); // 获取http响应体 HttpEntity entity = response.getEntity(); // 将响应体转换为字符串，用到的是实体工具包 String body = EntityUtils.toString(entity); log.info(\u0026#34;获取的响应实体{}\u0026#34;,body); // 关闭资源 response.close(); httpClient.close(); } 发送POST请求 @Test public void testPOST() throws Exception { // 创建httpclient对象 CloseableHttpClient httpClient = HttpClients.createDefault(); // 创建POST请求 HttpPost httpPost = new HttpPost(\u0026#34;http://localhost:8080/admin/employee/login\u0026#34;); // 发送请求 // 构造Json数据 JSONObject jsonObject = new JSONObject(); jsonObject.put(\u0026#34;username\u0026#34;,\u0026#34;admin\u0026#34;); jsonObject.put(\u0026#34;password\u0026#34;,\u0026#34;123456\u0026#34;); // 构造请求体 StringEntity stringEntity = new StringEntity(jsonObject.toString()); // 设置请求编码 stringEntity.setContentEncoding(\u0026#34;utf-8\u0026#34;); // 设置数据类型 stringEntity.setContentType(\u0026#34;application/json\u0026#34;); // 设置请求体。最后发送的是httpPost httpPost.setEntity(stringEntity); // 发送请求 CloseableHttpResponse response = httpClient.execute(httpPost); // 获取响应码 int statusCode = response.getStatusLine().getStatusCode(); System.out.println(statusCode); // 获取响应体 HttpEntity entity = response.getEntity(); String string = EntityUtils.toString(entity); System.out.println(string); // 关闭资源 response.close(); httpClient.close(); } 项目封装好了工具类\n这个httpclient的作用是，给微信官方发去授权码，看是否能获得微信用户的唯一openid，来让小程序端能够正常的登录\n","keywords":["苍穹外卖"],"articleBody":"HttpClient 阿里云里边会包括httpclient这个依赖\n发送GET请求 1、创建httpclient对象\nCloseableHttpClient httpClient = HttpClients.createDefault(); 2、创建请求对象\nCloseableHttpResponse response = httpClient.execute(httpGet); 3、发送请求，接收响应结果\n@Test public void testGet() throws IOException { // 创建httpclient对象 CloseableHttpClient httpClient = HttpClients.createDefault(); // 创建请求对象GET HttpGet httpGet = new HttpGet(\"http://localhost:8080/user/shop/status\"); // 发送请求 CloseableHttpResponse response = httpClient.execute(httpGet); // 获取http响应码 int statusCode = response.getStatusLine().getStatusCode(); log.info(\"获取的响应码是{}\",statusCode); // 获取http响应体 HttpEntity entity = response.getEntity(); // 将响应体转换为字符串，用到的是实体工具包 String body = EntityUtils.toString(entity); log.info(\"获取的响应实体{}\",body); // 关闭资源 response.close(); httpClient.close(); } 发送POST请求 @Test public void testPOST() throws Exception { // 创建httpclient对象 CloseableHttpClient httpClient = HttpClients.createDefault(); // 创建POST请求 HttpPost httpPost = new HttpPost(\"http://localhost:8080/admin/employee/login\"); // 发送请求 // 构造Json数据 JSONObject jsonObject = new JSONObject(); jsonObject.put(\"username\",\"admin\"); jsonObject.put(\"password\",\"123456\"); // 构造请求体 StringEntity stringEntity = new StringEntity(jsonObject.toString()); // 设置请求编码 stringEntity.setContentEncoding(\"utf-8\"); // 设置数据类型 stringEntity.setContentType(\"application/json\"); // 设置请求体。最后发送的是httpPost httpPost.setEntity(stringEntity); // 发送请求 CloseableHttpResponse response = httpClient.execute(httpPost); // 获取响应码 int statusCode = response.getStatusLine().getStatusCode(); System.out.println(statusCode); // 获取响应体 HttpEntity entity = response.getEntity(); String string = EntityUtils.toString(entity); System.out.println(string); // 关闭资源 response.close(); httpClient.close(); } 项目封装好了工具类\n这个httpclient的作用是，给微信官方发去授权码，看是否能获得微信用户的唯一openid，来让小程序端能够正常的登录\n微信小程序 需要把不校验合法域名打开，这样才可以在本地做测试\n小程序目录结构 小程序包含一个描述整体程序的 app 和多个描述各自页面的 page。一个小程序主体部分由三个文件组成，必须放在项目的根目录，如下：\n小程序页面由四个文件组成\n小程序的版本不同，用到的语法很不同\n入门案例 wxml文件，类似于html\n\u003cnavigation-bar title=\"获取用户信息\" back=\"{{false}}\" color=\"black\" background=\"#FFF\"\u003e\u003c/navigation-bar\u003e \u003cscroll-view class=\"scrollarea\" scroll-y type=\"list\"\u003e ","wordCount":"2258","inLanguage":"zh","image":"https://wqnm1gb.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E","datePublished":"2025-03-20T11:07:28+08:00","dateModified":"2025-03-20T11:07:28+08:00","author":{"@type":"Person","name":"冷漠三狗子丶"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://wqnm1gb.github.io/posts/day06%E5%BE%AE%E4%BF%A1%E7%99%BB%E5%BD%95%E5%95%86%E5%93%81%E6%B5%8F%E8%A7%88/"},"publisher":{"@type":"Organization","name":"三狗子的博客","logo":{"@type":"ImageObject","url":"https://wqnm1gb.github.io/images/favicon.png"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://wqnm1gb.github.io/ accesskey=h title="主页 (Alt + H)"><img src=https://wqnm1gb.github.io/apple-touch-icon.png alt aria-label=logo height=35>主页</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://wqnm1gb.github.io/ title=三狗子的博客><span>首页</span></a></li><li><a href=https://wqnm1gb.github.io/archives/ title=归档><span>归档</span></a></li><li><a href=https://wqnm1gb.github.io/categories/ title=Categories><span>分类</span></a></li><li><a href=https://wqnm1gb.github.io/tags/ title=Tags><span>标签</span></a></li><li><a href=https://wqnm1gb.github.io/search/ title=搜索><span>搜索</span></a></li><li><a href=https://wqnm1gb.github.io/about/ title=关于><span>关于</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://wqnm1gb.github.io/>主页</a>&nbsp;»&nbsp;<a href=https://wqnm1gb.github.io/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Day06 微信登录、商品浏览</h1><div class=post-meta><span title='2025-03-20 11:07:28 +0800 +0800'>三月 20, 2025</span>&nbsp;·&nbsp;5 分钟&nbsp;·&nbsp;2258 字&nbsp;·&nbsp;冷漠三狗子丶</div></header><div class=post-content><h1 id=httpclient>HttpClient<a hidden class=anchor aria-hidden=true href=#httpclient>#</a></h1><p>阿里云里边会包括httpclient这个依赖</p><h2 id=发送get请求>发送GET请求<a hidden class=anchor aria-hidden=true href=#发送get请求>#</a></h2><p><img loading=lazy src=/images/Day06%e5%be%ae%e4%bf%a1%e7%99%bb%e5%bd%95%e3%80%81%e5%95%86%e5%93%81%e6%b5%8f%e8%a7%88.assets/1740194477780-77796a0a-0cd8-4e57-9432-e35a4e1df056.png alt></p><p>1、创建httpclient对象</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>CloseableHttpClient</span><span class=w> </span><span class=n>httpClient</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>HttpClients</span><span class=p>.</span><span class=na>createDefault</span><span class=p>();</span><span class=w>
</span></span></span></code></pre></div><p>2、创建请求对象</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>CloseableHttpResponse</span><span class=w> </span><span class=n>response</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>httpClient</span><span class=p>.</span><span class=na>execute</span><span class=p>(</span><span class=n>httpGet</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></div><p>3、发送请求，接收响应结果</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=w>  </span><span class=nd>@Test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>testGet</span><span class=p>()</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>IOException</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 创建httpclient对象</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>CloseableHttpClient</span><span class=w> </span><span class=n>httpClient</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>HttpClients</span><span class=p>.</span><span class=na>createDefault</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 创建请求对象GET</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>HttpGet</span><span class=w> </span><span class=n>httpGet</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>HttpGet</span><span class=p>(</span><span class=s>&#34;http://localhost:8080/user/shop/status&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 发送请求</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>CloseableHttpResponse</span><span class=w> </span><span class=n>response</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>httpClient</span><span class=p>.</span><span class=na>execute</span><span class=p>(</span><span class=n>httpGet</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 获取http响应码</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kt>int</span><span class=w> </span><span class=n>statusCode</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>response</span><span class=p>.</span><span class=na>getStatusLine</span><span class=p>().</span><span class=na>getStatusCode</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>log</span><span class=p>.</span><span class=na>info</span><span class=p>(</span><span class=s>&#34;获取的响应码是{}&#34;</span><span class=p>,</span><span class=n>statusCode</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 获取http响应体</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>HttpEntity</span><span class=w> </span><span class=n>entity</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>response</span><span class=p>.</span><span class=na>getEntity</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 将响应体转换为字符串，用到的是实体工具包</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>body</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>EntityUtils</span><span class=p>.</span><span class=na>toString</span><span class=p>(</span><span class=n>entity</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>log</span><span class=p>.</span><span class=na>info</span><span class=p>(</span><span class=s>&#34;获取的响应实体{}&#34;</span><span class=p>,</span><span class=n>body</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 关闭资源</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>response</span><span class=p>.</span><span class=na>close</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>httpClient</span><span class=p>.</span><span class=na>close</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><h2 id=发送post请求>发送POST请求<a hidden class=anchor aria-hidden=true href=#发送post请求>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=w>    </span><span class=nd>@Test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>testPOST</span><span class=p>()</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Exception</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 创建httpclient对象</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>CloseableHttpClient</span><span class=w> </span><span class=n>httpClient</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>HttpClients</span><span class=p>.</span><span class=na>createDefault</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 创建POST请求</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>HttpPost</span><span class=w> </span><span class=n>httpPost</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>HttpPost</span><span class=p>(</span><span class=s>&#34;http://localhost:8080/admin/employee/login&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 发送请求</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 构造Json数据</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>JSONObject</span><span class=w> </span><span class=n>jsonObject</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>JSONObject</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>jsonObject</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&#34;username&#34;</span><span class=p>,</span><span class=s>&#34;admin&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>jsonObject</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&#34;password&#34;</span><span class=p>,</span><span class=s>&#34;123456&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 构造请求体</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>StringEntity</span><span class=w> </span><span class=n>stringEntity</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>StringEntity</span><span class=p>(</span><span class=n>jsonObject</span><span class=p>.</span><span class=na>toString</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 设置请求编码</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>stringEntity</span><span class=p>.</span><span class=na>setContentEncoding</span><span class=p>(</span><span class=s>&#34;utf-8&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 设置数据类型</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>stringEntity</span><span class=p>.</span><span class=na>setContentType</span><span class=p>(</span><span class=s>&#34;application/json&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 设置请求体。最后发送的是httpPost</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>httpPost</span><span class=p>.</span><span class=na>setEntity</span><span class=p>(</span><span class=n>stringEntity</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 发送请求</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>CloseableHttpResponse</span><span class=w> </span><span class=n>response</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>httpClient</span><span class=p>.</span><span class=na>execute</span><span class=p>(</span><span class=n>httpPost</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 获取响应码</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kt>int</span><span class=w> </span><span class=n>statusCode</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>response</span><span class=p>.</span><span class=na>getStatusLine</span><span class=p>().</span><span class=na>getStatusCode</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>statusCode</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 获取响应体</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>HttpEntity</span><span class=w> </span><span class=n>entity</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>response</span><span class=p>.</span><span class=na>getEntity</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>string</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>EntityUtils</span><span class=p>.</span><span class=na>toString</span><span class=p>(</span><span class=n>entity</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>string</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 关闭资源</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>response</span><span class=p>.</span><span class=na>close</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>httpClient</span><span class=p>.</span><span class=na>close</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>项目封装好了工具类<br>这个httpclient的作用是，给微信官方发去授权码，看是否能获得微信用户的唯一openid，来让小程序端能够正常的登录</p><h1 id=微信小程序>微信小程序<a hidden class=anchor aria-hidden=true href=#微信小程序>#</a></h1><p>需要把不校验合法域名打开，这样才可以在本地做测试</p><p><img loading=lazy src=/images/Day06%e5%be%ae%e4%bf%a1%e7%99%bb%e5%bd%95%e3%80%81%e5%95%86%e5%93%81%e6%b5%8f%e8%a7%88.assets/1740272772084-2fcb4c3f-8352-4fd4-ba68-b82728343117.png alt></p><h2 id=小程序目录结构>小程序目录结构<a hidden class=anchor aria-hidden=true href=#小程序目录结构>#</a></h2><p>小程序包含一个<strong>描述整体程序的 app</strong> 和<strong>多个描述各自页面的 page</strong>。一个小程序主体部分由三个文件组成，必须<strong>放在项目的根目录</strong>，如下：</p><p><img loading=lazy src=/images/Day06%e5%be%ae%e4%bf%a1%e7%99%bb%e5%bd%95%e3%80%81%e5%95%86%e5%93%81%e6%b5%8f%e8%a7%88.assets/1740272843181-5860e6ee-37bd-40e9-bb56-6e7b5b19ad38.png alt></p><p><img loading=lazy src=/images/Day06%e5%be%ae%e4%bf%a1%e7%99%bb%e5%bd%95%e3%80%81%e5%95%86%e5%93%81%e6%b5%8f%e8%a7%88.assets/1740272916325-ebdd4ce3-7552-4ba5-999f-10f14d6fc4eb.png alt></p><p>小程序<strong>页面</strong>由四个文件组成</p><p><img loading=lazy src=/images/Day06%e5%be%ae%e4%bf%a1%e7%99%bb%e5%bd%95%e3%80%81%e5%95%86%e5%93%81%e6%b5%8f%e8%a7%88.assets/1740272948267-1b03b961-805e-4ea5-b23c-90349c49c46a.png alt></p><p><img loading=lazy src=/images/Day06%e5%be%ae%e4%bf%a1%e7%99%bb%e5%bd%95%e3%80%81%e5%95%86%e5%93%81%e6%b5%8f%e8%a7%88.assets/1740272984908-3389eb97-889e-460c-9929-dec92dedc266.png alt></p><p>小程序的版本不同，用到的语法很不同</p><h2 id=入门案例>入门案例<a hidden class=anchor aria-hidden=true href=#入门案例>#</a></h2><p>wxml文件，类似于html</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=o>&lt;!--</span><span class=n>index</span><span class=p>.</span><span class=na>wxml</span><span class=o>--&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>&lt;</span><span class=n>navigation</span><span class=o>-</span><span class=n>bar</span><span class=w> </span><span class=n>title</span><span class=o>=</span><span class=s>&#34;获取用户信息&#34;</span><span class=w> </span><span class=n>back</span><span class=o>=</span><span class=s>&#34;{{false}}&#34;</span><span class=w> </span><span class=n>color</span><span class=o>=</span><span class=s>&#34;black&#34;</span><span class=w> </span><span class=n>background</span><span class=o>=</span><span class=s>&#34;#FFF&#34;</span><span class=o>&gt;&lt;/</span><span class=n>navigation</span><span class=o>-</span><span class=n>bar</span><span class=o>&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>&lt;</span><span class=n>scroll</span><span class=o>-</span><span class=n>view</span><span class=w> </span><span class=kd>class</span><span class=err>=&#34;</span><span class=nc>scrollarea</span><span class=s>&#34; scroll-y type=&#34;</span><span class=n>list</span><span class=s>&#34;&gt;
</span></span></span><span class=line><span class=cl><span class=s>  &lt;view class=&#34;</span><span class=n>container</span><span class=s>&#34;&gt;
</span></span></span><span class=line><span class=cl><span class=s>    &lt;view&gt;
</span></span></span><span class=line><span class=cl><span class=s>        {{msg}}
</span></span></span><span class=line><span class=cl><span class=s>    &lt;/view&gt;
</span></span></span><span class=line><span class=cl><span class=s>    &lt;view&gt;
</span></span></span><span class=line><span class=cl><span class=s>        昵称:{{nickName}}
</span></span></span><span class=line><span class=cl><span class=s>        &lt;image style=&#34;</span><span class=n>height</span><span class=p>:</span><span class=w> </span><span class=n>100px</span><span class=w> </span><span class=p>;</span><span class=w> </span><span class=n>width</span><span class=p>:</span><span class=w> </span><span class=n>100px</span><span class=p>;</span><span class=s>&#34; src =&#39;{{avaterUrl}}&#39;&gt;&lt;/image&gt;
</span></span></span><span class=line><span class=cl><span class=s>        &lt;button type=&#34;</span><span class=n>primary</span><span class=s>&#34; bindtap=&#34;</span><span class=n>getUserInfo</span><span class=s>&#34; &gt;获取用户信息&lt;/button&gt;
</span></span></span><span class=line><span class=cl><span class=s>    &lt;/view&gt;  
</span></span></span><span class=line><span class=cl><span class=s>    &lt;view&gt;
</span></span></span><span class=line><span class=cl><span class=s>        code:{{code}}
</span></span></span><span class=line><span class=cl><span class=s>        &lt;button type=&#34;</span><span class=n>warn</span><span class=s>&#34; bindtap=&#34;</span><span class=n>wxLogin</span><span class=s>&#34;&gt;用户登录&lt;/button&gt;
</span></span></span><span class=line><span class=cl><span class=s>    &lt;/view&gt;
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>    &lt;view&gt;
</span></span></span><span class=line><span class=cl><span class=s>        status:{{status}}
</span></span></span><span class=line><span class=cl><span class=s>        &lt;button type=&#34;</span><span class=k>default</span><span class=s>&#34; bindtap=&#34;</span><span class=n>sendRequest</span><span class=s>&#34;&gt;发送请求&lt;/button&gt;
</span></span></span><span class=line><span class=cl><span class=s>    &lt;/view&gt;
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>  &lt;/view&gt;
</span></span></span><span class=line><span class=cl><span class=s>&lt;/scroll-view&gt;
</span></span></span></code></pre></div><p>index.js用来出来逻辑</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// index.js</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Page</span><span class=p>({</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nl>data</span><span class=p>:{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>msg</span><span class=p>:</span><span class=err>&#39;</span><span class=n>hello</span><span class=p>,</span><span class=n>world</span><span class=o>!</span><span class=err>&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>avaterUrl</span><span class=p>:</span><span class=err>&#39;&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>nickName</span><span class=p>:</span><span class=err>&#39;&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>code</span><span class=p>:</span><span class=err>&#39;&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>status</span><span class=p>:</span><span class=err>&#39;&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>},</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 定义函数获取用户的头像和昵称</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>getUserInfo</span><span class=p>(){</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>wx</span><span class=p>.</span><span class=na>getUserProfile</span><span class=p>({</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// desc是描述信息</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>desc</span><span class=p>:</span><span class=w> </span><span class=err>&#39;</span><span class=n>获取用户信息</span><span class=err>&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>success</span><span class=p>:(</span><span class=n>res</span><span class=p>)</span><span class=o>=&gt;</span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>console</span><span class=p>.</span><span class=na>log</span><span class=w> </span><span class=p>(</span><span class=n>res</span><span class=p>.</span><span class=na>userInfo</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>setData</span><span class=p>({</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>avaterUrl</span><span class=p>:</span><span class=n>res</span><span class=p>.</span><span class=na>userInfo</span><span class=p>.</span><span class=na>avatarUrl</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>nickName</span><span class=p>:</span><span class=n>res</span><span class=p>.</span><span class=na>userInfo</span><span class=p>.</span><span class=na>nickName</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>})</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>})</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>},</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 定义函数获取用户的授权码</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>wxLogin</span><span class=p>(){</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>wx</span><span class=p>.</span><span class=na>login</span><span class=p>({</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>success</span><span class=p>:</span><span class=w> </span><span class=p>(</span><span class=n>res</span><span class=p>)</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=n>console</span><span class=p>.</span><span class=na>log</span><span class=p>(</span><span class=n>res</span><span class=p>.</span><span class=na>code</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=k>this</span><span class=p>.</span><span class=na>setData</span><span class=p>({</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=n>code</span><span class=p>:</span><span class=n>res</span><span class=p>.</span><span class=na>code</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=p>})</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=p>},</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>})</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>},</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 定义函数发送请求</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>sendRequest</span><span class=p>(){</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>wx</span><span class=p>.</span><span class=na>request</span><span class=p>({</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>url</span><span class=p>:</span><span class=w> </span><span class=err>&#39;</span><span class=n>http</span><span class=p>:</span><span class=c1>//localhost:8080/user/shop/status&#39;,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>method</span><span class=p>:</span><span class=err>&#39;</span><span class=n>GET</span><span class=err>&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>success</span><span class=w> </span><span class=p>:(</span><span class=n>res</span><span class=p>)</span><span class=o>=&gt;</span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=n>console</span><span class=p>.</span><span class=na>log</span><span class=p>(</span><span class=n>res</span><span class=p>.</span><span class=na>data</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=k>this</span><span class=p>.</span><span class=na>setData</span><span class=p>({</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=n>status</span><span class=p>:</span><span class=n>res</span><span class=p>.</span><span class=na>data</span><span class=p>.</span><span class=na>data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=p>})</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>})</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>})</span><span class=w>
</span></span></span></code></pre></div><h1 id=微信登录>微信登录<a hidden class=anchor aria-hidden=true href=#微信登录>#</a></h1><h2 id=登录的整体过程>登录的整体过程<a hidden class=anchor aria-hidden=true href=#登录的整体过程>#</a></h2><p><img loading=lazy src=/images/Day06%e5%be%ae%e4%bf%a1%e7%99%bb%e5%bd%95%e3%80%81%e5%95%86%e5%93%81%e6%b5%8f%e8%a7%88.assets/1740361830858-7968b047-c46c-4a07-8a20-91dbef55da75.png alt></p><ol><li>调用 <a href=https://developers.weixin.qq.com/miniprogram/dev/api/open-api/login/wx.login.html>wx.login()</a> 获取 <strong>临时登录凭证code</strong> ，并回传到开发者服务器。</li><li>调用 <a href=https://developers.weixin.qq.com/miniprogram/dev/OpenApiDoc/user-login/code2Session.html>auth.code2Session</a> 接口，换取 <strong>用户唯一标识 OpenID</strong> 、 用户在微信开放平台账号下的<strong>唯一标识UnionID</strong>（若当前小程序已绑定到微信开放平台账号） 和 <strong>会话密钥 session_key</strong></li></ol><p><strong>使用PostMan测试</strong></p><p><img loading=lazy src=/images/Day06%e5%be%ae%e4%bf%a1%e7%99%bb%e5%bd%95%e3%80%81%e5%95%86%e5%93%81%e6%b5%8f%e8%a7%88.assets/1740362092064-0a0d5901-921c-4dff-a19e-21ba1be4a2d1.png alt></p><p><strong>唯一标识是Openkey</strong></p><p><strong>DeepSeek给出的返回openid给前端的原因</strong></p><p><strong>1. 前端业务需求</strong></p><ul><li><strong>客户端缓存用户标识</strong>：如果小程序前端需要直接使用 <code>&lt;font style="color:rgb(64, 64, 64);">openid&lt;/font></code> 进行本地逻辑处理（如展示用户唯一标识、本地缓存用户状态等）。</li><li><strong>调用某些微信接口</strong>：部分微信接口（如支付、订阅消息）需要前端传递 <code>&lt;font style="color:rgb(64, 64, 64);">openid&lt;/font></code> 作为参数。</li></ul><p><strong>2. 简化开发逻辑</strong></p><ul><li><strong>无状态设计</strong>：如果服务端未设计会话管理（如 <code>&lt;font style="color:rgb(64, 64, 64);">token&lt;/font></code> 机制），直接将 <code>&lt;font style="color:rgb(64, 64, 64);">openid&lt;/font></code> 返回给前端，后续请求由前端携带 <code>&lt;font style="color:rgb(64, 64, 64);">openid&lt;/font></code> 来标识用户。</li></ul><hr><h3 id=配置文件>配置文件<a hidden class=anchor aria-hidden=true href=#配置文件>#</a></h3><p>配置为微信用户生成jwt令牌时使用的配置项：</p><p><img loading=lazy src=/images/Day06%e5%be%ae%e4%bf%a1%e7%99%bb%e5%bd%95%e3%80%81%e5%95%86%e5%93%81%e6%b5%8f%e8%a7%88.assets/1740364665282-3bc2ce35-18a4-4918-b87d-a92b60543b92.png alt></p><p><img loading=lazy src=/images/Day06%e5%be%ae%e4%bf%a1%e7%99%bb%e5%bd%95%e3%80%81%e5%95%86%e5%93%81%e6%b5%8f%e8%a7%88.assets/1740364776772-dacef6c7-3399-460e-b9ea-15f8d571155d.png alt></p><p>注解的作用解释：</p><p><code>&lt;font style="color:rgb(64, 64, 64);">@ConfigurationProperties(prefix = "sky.jwt")&lt;/font></code> 是 Spring Boot 中用于 <strong>将配置文件中的属性绑定到 Java 对象</strong> 的核心注解。以下是详细解释：</p><p>prefix：指定配置文件中属性的前缀，如 <code>&lt;font style="color:rgb(64, 64, 64);">prefix = "sky.jwt"&lt;/font></code>对应 <code>&lt;font style="color:rgb(64, 64, 64);">sky.jwt.*&lt;/font></code>的配置</p><h2 id=代码实现>代码实现<a hidden class=anchor aria-hidden=true href=#代码实现>#</a></h2><p>Service代码实现：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>UserLoginVO</span><span class=w> </span><span class=nf>login</span><span class=p>(</span><span class=n>UserLoginDTO</span><span class=w> </span><span class=n>userLoginDTO</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 获得微信的openId</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>openId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>getOpenId</span><span class=p>(</span><span class=n>userLoginDTO</span><span class=p>.</span><span class=na>getCode</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 判断openid是否存在</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=p>(</span><span class=n>openId</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=p>){</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 传递登入失败</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>LoginFailedException</span><span class=p>(</span><span class=n>MessageConstant</span><span class=p>.</span><span class=na>LOGIN_FAILED</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 根据openid查询这个用户是否之前登录过</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>User</span><span class=w> </span><span class=n>user</span><span class=o>=</span><span class=w> </span><span class=n>userMapper</span><span class=p>.</span><span class=na>getByOpenID</span><span class=p>(</span><span class=n>openId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 如果用户不存在，那么创建一个新的用户</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=p>(</span><span class=n>user</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=p>){</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>//            注意builder是如何使用的</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>user</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>User</span><span class=p>.</span><span class=na>builder</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>.</span><span class=na>openid</span><span class=p>(</span><span class=n>openId</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>.</span><span class=na>createTime</span><span class=p>(</span><span class=n>LocalDateTime</span><span class=p>.</span><span class=na>now</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>.</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>userMapper</span><span class=p>.</span><span class=na>insert</span><span class=p>(</span><span class=n>user</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 构建jwt令牌</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Map</span><span class=w> </span><span class=n>claims</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>HashMap</span><span class=o>&lt;&gt;</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>claims</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=n>JwtClaimsConstant</span><span class=p>.</span><span class=na>USER_ID</span><span class=p>,</span><span class=n>user</span><span class=p>.</span><span class=na>getId</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 信息数据从jwtProperties里边获得</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>token</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>JwtUtil</span><span class=p>.</span><span class=na>createJWT</span><span class=p>(</span><span class=n>jwtProperties</span><span class=p>.</span><span class=na>getUserSecretKey</span><span class=p>(),</span><span class=w> </span><span class=n>jwtProperties</span><span class=p>.</span><span class=na>getUserTtl</span><span class=p>(),</span><span class=w> </span><span class=n>claims</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>UserLoginVO</span><span class=w> </span><span class=n>userLoginVO</span><span class=w> </span><span class=o>=</span><span class=k>new</span><span class=w> </span><span class=n>UserLoginVO</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>userLoginVO</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>UserLoginVO</span><span class=p>.</span><span class=na>builder</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>openid</span><span class=p>(</span><span class=n>openId</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>id</span><span class=p>(</span><span class=n>user</span><span class=p>.</span><span class=na>getId</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>token</span><span class=p>(</span><span class=n>token</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>userLoginVO</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>//    获取微信openId</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>getOpenId</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>code</span><span class=p>){</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Map</span><span class=w> </span><span class=n>request</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>HashMap</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>request</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&#34;appid&#34;</span><span class=p>,</span><span class=n>weChatProperties</span><span class=p>.</span><span class=na>getAppid</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>request</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&#34;secret&#34;</span><span class=p>,</span><span class=n>weChatProperties</span><span class=p>.</span><span class=na>getSecret</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>request</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&#34;js_code&#34;</span><span class=p>,</span><span class=n>code</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>request</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&#34;grant_type&#34;</span><span class=p>,</span><span class=s>&#34;authorization_code&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 工具类不需要创建对象</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>json</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>HttpClientUtil</span><span class=p>.</span><span class=na>doGet</span><span class=p>(</span><span class=n>REQUEST_URL</span><span class=p>,</span><span class=w> </span><span class=n>request</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>JSONObject</span><span class=w> </span><span class=n>jsonObject</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>JSON</span><span class=p>.</span><span class=na>parseObject</span><span class=p>(</span><span class=n>json</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>openid</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>jsonObject</span><span class=p>.</span><span class=na>getString</span><span class=p>(</span><span class=s>&#34;openid&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>openid</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>	
</span></span></span></code></pre></div><p>用户拦截器需要排除拦截的有：</p><p>1、登录请求</p><p>2、获取店铺状态的请求</p><p>完善登入代码后，还需要完善拦截器</p><p><img loading=lazy src=/images/Day06%e5%be%ae%e4%bf%a1%e7%99%bb%e5%bd%95%e3%80%81%e5%95%86%e5%93%81%e6%b5%8f%e8%a7%88.assets/1740372602802-ec6ae36b-2480-48e1-b08b-f98419457934.png alt></p><p>同时需要配置拦截器的生效和排除路径</p><p><img loading=lazy src=/images/Day06%e5%be%ae%e4%bf%a1%e7%99%bb%e5%bd%95%e3%80%81%e5%95%86%e5%93%81%e6%b5%8f%e8%a7%88.assets/1740372629993-8afebe50-27e1-42db-8bfd-bc82b5ffd7a7.png alt></p><p>Controller层</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>//    用户登录</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@PostMapping</span><span class=p>(</span><span class=s>&#34;/login&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@ApiOperation</span><span class=p>(</span><span class=s>&#34;用户登录接口&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>Result</span><span class=o>&lt;</span><span class=n>UserLoginVO</span><span class=o>&gt;</span><span class=w> </span><span class=nf>login</span><span class=p>(</span><span class=nd>@RequestBody</span><span class=w> </span><span class=n>UserLoginDTO</span><span class=w> </span><span class=n>userLoginDTO</span><span class=p>){</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>log</span><span class=p>.</span><span class=na>info</span><span class=p>(</span><span class=s>&#34;用户登录{}&#34;</span><span class=p>,</span><span class=n>userLoginDTO</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>UserLoginVO</span><span class=w> </span><span class=n>login</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>userService</span><span class=p>.</span><span class=na>login</span><span class=p>(</span><span class=n>userLoginDTO</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>Result</span><span class=p>.</span><span class=na>success</span><span class=p>(</span><span class=n>login</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>需要返回一个UserLoginVo对象</p><p>这里边有微信的openid，如果通过授权码获得的openid是空，那么报错，如果不为空，那么与数据库中有的数据判断，没有对应的数据，那么在数据库中添加，有对应的数据，那么返回出来。同时还需要构建jwt令牌</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>UserLoginVO</span><span class=w> </span><span class=nf>login</span><span class=p>(</span><span class=n>UserLoginDTO</span><span class=w> </span><span class=n>userLoginDTO</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 获得微信的openId</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>openId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>getOpenId</span><span class=p>(</span><span class=n>userLoginDTO</span><span class=p>.</span><span class=na>getCode</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 判断openid是否存在</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=p>(</span><span class=n>openId</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=p>){</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 传递登入失败</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>LoginFailedException</span><span class=p>(</span><span class=n>MessageConstant</span><span class=p>.</span><span class=na>LOGIN_FAILED</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 根据openid查询这个用户是否之前登录过</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>User</span><span class=w> </span><span class=n>user</span><span class=o>=</span><span class=w> </span><span class=n>userMapper</span><span class=p>.</span><span class=na>getByOpenID</span><span class=p>(</span><span class=n>openId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 如果用户不存在，那么创建一个新的用户</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=p>(</span><span class=n>user</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=p>){</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>//            注意builder是如何使用的</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>user</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>User</span><span class=p>.</span><span class=na>builder</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>.</span><span class=na>openid</span><span class=p>(</span><span class=n>openId</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>.</span><span class=na>createTime</span><span class=p>(</span><span class=n>LocalDateTime</span><span class=p>.</span><span class=na>now</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>.</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>userMapper</span><span class=p>.</span><span class=na>insert</span><span class=p>(</span><span class=n>user</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 构建jwt令牌</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Map</span><span class=w> </span><span class=n>claims</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>HashMap</span><span class=o>&lt;&gt;</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>claims</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=n>JwtClaimsConstant</span><span class=p>.</span><span class=na>USER_ID</span><span class=p>,</span><span class=n>user</span><span class=p>.</span><span class=na>getId</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 信息数据从jwtProperties里边获得</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>token</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>JwtUtil</span><span class=p>.</span><span class=na>createJWT</span><span class=p>(</span><span class=n>jwtProperties</span><span class=p>.</span><span class=na>getUserSecretKey</span><span class=p>(),</span><span class=w> </span><span class=n>jwtProperties</span><span class=p>.</span><span class=na>getUserTtl</span><span class=p>(),</span><span class=w> </span><span class=n>claims</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>UserLoginVO</span><span class=w> </span><span class=n>userLoginVO</span><span class=w> </span><span class=o>=</span><span class=k>new</span><span class=w> </span><span class=n>UserLoginVO</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>userLoginVO</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>UserLoginVO</span><span class=p>.</span><span class=na>builder</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>openid</span><span class=p>(</span><span class=n>openId</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>id</span><span class=p>(</span><span class=n>user</span><span class=p>.</span><span class=na>getId</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>token</span><span class=p>(</span><span class=n>token</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>userLoginVO</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>//    获取微信openId</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>getOpenId</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>code</span><span class=p>){</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Map</span><span class=w> </span><span class=n>request</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>HashMap</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>request</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&#34;appid&#34;</span><span class=p>,</span><span class=n>weChatProperties</span><span class=p>.</span><span class=na>getAppid</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>request</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&#34;secret&#34;</span><span class=p>,</span><span class=n>weChatProperties</span><span class=p>.</span><span class=na>getSecret</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>request</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&#34;js_code&#34;</span><span class=p>,</span><span class=n>code</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>request</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&#34;grant_type&#34;</span><span class=p>,</span><span class=s>&#34;authorization_code&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 工具类不需要创建对象</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>json</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>HttpClientUtil</span><span class=p>.</span><span class=na>doGet</span><span class=p>(</span><span class=n>REQUEST_URL</span><span class=p>,</span><span class=w> </span><span class=n>request</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>JSONObject</span><span class=w> </span><span class=n>jsonObject</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>JSON</span><span class=p>.</span><span class=na>parseObject</span><span class=p>(</span><span class=n>json</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>openid</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>jsonObject</span><span class=p>.</span><span class=na>getString</span><span class=p>(</span><span class=s>&#34;openid&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>openid</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>Mapper层比较简单，就是判断是否有这个用户，有就读取，没有就添加</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://wqnm1gb.github.io/tags/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96/>苍穹外卖</a></li></ul><nav class=paginav><a class=prev href=https://wqnm1gb.github.io/posts/day07%E7%BC%93%E5%AD%98%E8%8F%9C%E5%93%81%E5%92%8C%E8%B4%AD%E7%89%A9%E8%BD%A6/><span class=title>« 上一页</span><br><span>Day07 缓存菜品和购物车</span>
</a><a class=next href=https://wqnm1gb.github.io/posts/day05redis/><span class=title>下一页 »</span><br><span>Day05 Redis</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://wqnm1gb.github.io/>三狗子的博客</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="复制";function s(){t.innerHTML="已复制！",setTimeout(()=>{t.innerHTML="复制"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>